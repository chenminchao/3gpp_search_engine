
                                            3GPP TS 23.214 V15.3.0 (2018-06)
                                                     Technical Specification
                                         3rd Generation Partnership Project;
                  Technical Specification Group Services and System Aspects;
                                   Architecture enhancements for control and
                                         user plane separation of EPC nodes;
                                                                     Stage 2
                                                                (Release 15)

[pic]  [pic]

The present document has been developed within the 3rd Generation
Partnership Project (3GPP TM) and may be further elaborated for the
purposes of 3GPP..
The present document has not been subject to any approval process by the
3GPP Organizational Partners and shall not be implemented.
This Specification is provided for future development work within 3GPP
only. The Organizational Partners accept no liability for any use of this
Specification.
Specifications and Reports for implementation of the 3GPP TM system should
be obtained via the 3GPP Organizational Partners' Publications Offices.








                                  Keywords
             3GPP, Architecture, EPC, Control plane, User plane,
                                 Separation


                                    3GPP

                               Postal address



                         3GPP support office address
                  650 Route des Lucioles - Sophia Antipolis
                              Valbonne - FRANCE
               Tel.: +33 4 92 94 42 00 Fax: +33 4 93 65 47 16

                                  Internet
                             http://www.3gpp.org


                           Copyright Notification

    No part may be reproduced except as authorized by written permission.
  The copyright and the foregoing restriction extend to reproduction in all
                                   media.

  © 2018, 3GPP Organizational Partners (ARIB, ATIS, CCSA, ETSI, TSDSI, TTA,
                                    TTC).
                            All rights reserved.

UMTS™ is a Trade Mark of ETSI registered for the benefit of its members
3GPP™ is a Trade Mark of ETSI registered for the benefit of its Members and
of the 3GPP Organizational Partners
LTE™ is a Trade Mark of ETSI registered for the benefit of its Members and
of the 3GPP Organizational Partners
GSM® and the GSM logo are registered and owned by the GSM Association




         Contents


Foreword 6

1  Scope 7

2  References 7

3  Definitions and abbreviations  7
3.1  Definitions  7
3.2  Abbreviations  8

4  Architecture model and concepts  8
4.1  General concepts  8
4.2  Architecture reference model 8
4.2.1  Non-roaming and roaming architectures 8
4.2.2  Combined SGW/PGW architecture  9
4.2.3  Reference points  10
4.3  High level functions  10
4.3.1  General  10
4.3.2  Functional split of SGW, PGW and TDF  12
4.3.2.1  Functional split of SGW  12
4.3.2.2  Functional split of PGW  14
4.3.2.3  Functional split of TDF  16
4.3.3  User Plane Function selection  18
4.3.4  SGW-C Partitioning  18
4.4  Network elements  19
4.4.1  General  19
4.4.2  SGW control plane function 19
4.4.3  SGW user plane function  19
4.4.4  PGW control plane function 19
4.4.5  PGW user plane function  19
4.4.6  TDF control plane function 20
4.4.7  TDF user plane function  20

5  Functional description  20
5.1  General  20
5.2  Traffic detection 20
5.2.1  General  20
5.2.2  Traffic detection information  20
5.3  Charging and usage monitoring handling  21
5.3.1  General  21
5.3.2  Activation of usage reporting in UP function 22
5.3.3  Reporting of usage information towards CP function 22
5.3.4  PGW Pause of Charging 23
5.4  GTP-U IP address and TEIDu allocation 23
5.4.1  General  23
5.4.2  F-TEIDu allocation / release in the CP function  23
5.4.3  F-TEIDu allocation / release in the UP function  24
5.5  UE IP address management (allocation, renewal and release)  24
5.6  Control of user plane forwarding 25
5.6.1  General  25
5.6.2  Control of user plane forwarding 25
5.6.3  Format of forwarded user plane data 26
5.7  UE's permanent identifier usage  26
5.8  Functionality of sending of "end marker"  26
5.8.1  UP function constructing the "end marker" packets  26
5.8.2  CP function constructing the "end marker" packets  27
5.9  Idle state packet SGW buffering function  27
5.9.1  General  27
5.9.2  Buffering in CP function 27
5.9.3  Buffering in UP function 27
5.9.3.1  General  27
5.9.3.2  Delay Downlink Packet Notification  28
5.9.3.3  Extended buffering  28
5.9.3.4  Throttling 28
5.10 Bearer and APN policing 29
5.11 PCC/ADC related functions  29
5.11.1 Activation/Deactivation of predefined PCC/ADC rules  29
5.11.2 Enforcement of dynamic PCC/ADC rules  30
5.11.3 Redirection  30
5.11.4 Support of SDCI 30
5.12 User Plane function selection  31
5.12.1 General  31
5.12.2 Selection of PGW-U  31
5.12.3 Selection of SGW-U  31
5.12.4 Selection of a combined SGW/PGW-U   32
5.12.5 Selection of TDF-U  32
5.12.5.1 Solicited application reporting mode  32
5.12.5.2 Unsolicited application reporting mode  32

6  Information flows   33
6.1  General  33
6.2  Sx Session Management Procedures 33
6.2.1  General  33
6.2.2  Sx Session Establishment Procedure  33
6.2.3  Sx Session Modification Procedure   34
6.2.4  Sx Session Termination Procedure 35
6.3  Updates to procedures in other specifications  35
6.3.1  Updates to procedures specified in TS 23.401 35
6.3.1.2  Procedures with SGW change 39
6.3.1.2.1   General 39
6.3.1.2.2   Type 1  39
6.3.1.2.3   Type 2  41
6.3.1.3  Procedures with eNB F-TEIDu update  43
6.3.1.4  Procedures with release of eNB F-TEIDu  44
6.3.1.5  Procedures when downlink data is buffered in the UP function  45
6.3.1.6  Procedures with release of PDN connection  46
6.3.1.7  Procedures with modification of bearer  48
6.3.2  Updates to procedures specified in TS 23.203 50
6.3.2.1  IP-CAN session establishment 50
6.3.2.2  IP-CAN session termination 51
6.3.2.3  IP-CAN session modification  51
6.3.2.4  Management of PFDs  52
6.3.3  Updates to procedures specified in TS 23.402 53
6.3.3.1  Procedures with GTP based S2b establishment  53
6.3.3.2  Procedures with GTP based S2a establishment  54
6.3.3.3  Procedures with GTP based S2b release 55
6.3.3.4  Procedures with GTP based S2a release 55
6.3.3.5  Procedures with dedicated bearer activation by PGW 56
6.3.3.6  Procedures with bearer deactivation by PGW 57
6.3.3.7  Procedures with bearer modification 57
6.3.3.8  Procedures with handover from non-3GPP access  58
6.3.3.9  Procedures with handover from 3GPP access  60
6.3.4  Updates to procedures specified in TS 23.060 61
6.3.4.1  Procedures with PDN connection deactivation  61
6.3.4.1.1   Procedures with SGSN terminating S4 interface 61
6.3.4.1.2   Procedures with SGSN terminating Gn/Gp interface   64
6.3.4.2  Procedures with PDN connection modification  66
6.3.4.2.1   Procedures with SGSN terminating S4 interface 66
6.3.4.2.2   Procedures with SGSN terminating Gn/Gp interface   74
6.3.4.3  Procedures with PDN connection establishment 78
6.4  Sx Reporting Procedures 79
6.4.1  General  79
6.4.2  Sx Session Level Reporting Procedure  79
6.5  Sx Management Procedures   80
6.5.1  General  80
6.5.2  Sx PFD management Procedure  80
6.5.3  Sx Association Setup Procedure 81
6.5.4  Sx Association Update Procedure  81
6.5.5  Sx Association Release Procedure 81

7  Parameters 81
7.1  Parameters for Sx session management  81
7.2  Session context   82
7.3  Packet Detection Rule 82
7.4  Usage Reporting Rule  85
7.5  Forwarding Action Rule  87
7.6  QoS Enforcement Rule  88
7.7  Usage Report generated by UP function 89
7.8  Functional description  90
7.8.1  General  90
7.8.2  PDN connection and TDF session level context 90
7.8.3  Bearer related context   90
7.8.4  Measurement key related context  91
7.9  Parameters for Sx management 91
7.9.1  Parameters for PFD management  91

Annex A (informative): Change history 92




         Foreword

This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).

The contents of the present document are subject to continuing work within
the TSG and may change following formal TSG approval. Should the TSG modify
the contents of the present document, it will be re-released by the TSG
with an identifying change of release date and an increase in version
number as follows:

  Version x.y.z

  where:

    x  the first digit:

       1  presented to TSG for information;

       2  presented to TSG for approval;

       3  or greater indicates TSG approved document under change control.

    y  the second digit is incremented for all changes of substance, i.e.
       technical enhancements, corrections, updates, etc.

    z  the third digit is incremented when editorial only changes have been
       incorporated in the document.



         1  Scope

The present document specifies the overall stage 2 level functionality for
control and user plane separation of EPC's SGW, PGW and TDF. This enables a
flexible placement of the separated control plane and user plane functions
for supporting diverse deployment scenarios (e.g. central or distributed
user plane function) without affecting the overall functionality provided
by these EPC entities.


2  References

The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.

  -  References are either specific (identified by date of publication,
    edition number, version number, etc.) or non-specific.

  -  For a specific reference, subsequent revisions do not apply.

  -  For a non-specific reference, the latest version applies. In the case
    of a reference to a 3GPP document (including a GSM document), a non-
    specific reference implicitly refers to the latest version of that
    document in the same Release as the present document.

  [1]  3GPP TR 21.905: "Vocabulary for 3GPP Specifications".

  [2]  3GPP TS 23.401: "General Packet Radio Service (GPRS) enhancements
             for Evolved Universal Terrestrial Radio Access Network (E-
             UTRAN) access".

  [3]  3GPP TS 23.203: "Policy and charging control architecture".

  [4]  3GPP TS 23.402: "Architecture enhancements for non-3GPP accesses".

  [5]  3GPP TS 23.060: "General Packet Radio Service (GPRS); Service
             description; Stage 2".

  [6]  3GPP TS 29.060: "GPRS Tunnelling Protocol (GTP) across the Gn and Gp
             interface".

  [7]  3GPP TS 29.274: "3GPP Evolved Packet System (EPS); Evolved General
             Packet Radio Service (GPRS) Tunnelling Protocol for Control
             plane (GTPv2-C); Stage 3".

  [8]  3GPP TS 32.251: "Telecommunication management; Charging management;
             Packet Switched (PS) domain charging".

  [9]  3GPP TS 32.240: "Charging architecture and principles".

  [10] 3GPP TS 33.107: "3G security; Lawful interception architecture and
             functions".

  [11] 3GPP TS 29.212: "Policy and Charging Control (PCC); Reference
             points".

  [12] 3GPP TS 29.244: "Interface between the Control Plane and the User
             Plane of EPC Nodes; Stage 3".


3  Definitions and abbreviations


3.1  Definitions

For the purposes of the present document, the terms and definitions given
in TR 21.905 [1], TS 23.401 [2], TS 23.203 [3] and the following apply. A
term defined in the present document takes precedence over the definition
of the same term, if any, in TR 21.905 [1].

F-TEID: as defined in clause 8.22 of TS 29.274 [7].

F-TEIDu: The F-TEID of a GTP-u tunnel.


3.2  Abbreviations

For the purposes of the present document, the abbreviations given in
TR 21.905 [1], TS 23.401 [2], TS 23.203 [3] and the following apply. An
abbreviation defined in the present document takes precedence over the
definition of the same abbreviation, if any, in TR 21.905 [1].

  CP function Control Plane function
  PGW  PDN Gateway
  PGW-C  PDN Gateway Control plane function
  PGW-U  PDN Gateway User plane function
  SGW  Serving Gateway
  SGW-C  Serving Gateway Control plane function
  SGW-U  Serving Gateway User plane function
  TDF  Traffic Detection Function
  TDF-C  Traffic Detection Function Control plane function
  TDF-U  Traffic Detection Function User plane function
  UP function User Plane function



4  Architecture model and concepts


4.1  General concepts

The architecture and functionality for control and user plane separation of
SGW, PGW and TDF is based on the following concepts:

  -  Interworking with networks not applying control and user plane
    separation is possible (i.e. in case of roaming scenarios);

  -  Split network entities can interwork with network entities that are
    not split within the same network;

  -  Split network entities have no requirement to update UE, and Radio
    Access Network;

  -  The SGW/PGW selection function of the MME/ePDG/TWAN described in
    TS 23.401 [2] and TS 23.402 [4] is used for the selection of the
    respective CP function;

  -  The configuration based mechanism (in PGW or PCRF) described in
    TS 23.203 [3] is used for the selection of the CP function of the TDF;

  -  A CP function can interface with one or more UP functions (e.g. to
    enable independent scalability of CP functions and UP functions).


4.2  Architecture reference model


4.2.1  Non-roaming and roaming architectures

This clause defines the complementary aspects of the architecture reference
models specified in TS 23.401 [2] clause 4.2 and TS 23.402 [4] clauses
4.2.2 and 4.2.3 for GTP-based interfaces when SGW, PGW and TDF control and
user planes are separated.

For S2a, S2b, S5 and S8 reference points, this architecture reference model
is only supported with GTP-based interfaces. PMIP-based interfaces and S2c
interface are not supported.

Figure 4.2.1-1 shows the architecture reference model in the case of
separation between control plane and user plane. This architecture
reference model covers non-roaming as well as home routed and local
breakout roaming scenarios.

                                    [pic]

 Figure 4.2.1-1: Architecture reference model with separation of user plane
           and control plane for non-roaming and roaming scenarios

  NOTE 1:  The -C or -U suffix appended to S2a, S2b, S5 and S8 existing
         reference points only indicate the control plane and user plane
         components of those interfaces.

  NOTE 2:  The architecture in figure 4.2.1-1 only depicts the case when
         the CP and UP functions of all SGW, PGW and TDF nodes are split.
         However, the other cases when the CP and UP function of only one of
         these nodes is split while the CP and UP function of the other
         interfacing node is not split, e.g. PGW's control plane and user
         plane is split while SGW's control plane and user plane is not
         split, are also supported. The split architecture of a node does
         not put any architectural requirements on the peer nodes with which
         it interfaces.

  NOTE 3:  TDF is an optional functional entity.

  NOTE 4:  Additional interfaces/reference points are documented in
         TS 23.401 [2], TS 23.402 [4], TS 23.060 [5] and TS 23.203 [3].

  NOTE 5:  For a roaming architecture with local breakout, the Gx interface
         is defined between the PGW-C and PCRF in the visited network.

  NOTE 6:  S11-U is the interface between MME and SGW-U, supporting CP CIoT
         EPS Optimisation (see TS 23.401 [2]).


4.2.2  Combined SGW/PGW architecture

The usage of a combined SGW/PGW documented in TS 23.401 [2] remains
possible in a deployment with separated control and user planes. This is
enabled by supporting an Sx interface with a common parameter structure for
non-combined and combined cases. Figure 4.2.2-1 shows the architecture
reference model for a combined SGW/PGW in the case of separation between
control plane and user plane.

                                    [pic]

 Figure 4.2.2-1: Architecture reference model with separation of user plane
                  and control plane for a combined SGW/PGW

  NOTE 1:  The combined Sxa/Sxb shown in figure 4.2.2-1 only covers the
         functionality of Sxa and Sxb.

  NOTE 2:  S11-U is the interface between MME and combined SGW/PGW-U,
         supporting CP CIoT EPS Optimisation (see TS 23.401 [2]).


4.2.3  Reference points

This clause defines the complementary reference points of the architecture
reference models specified in TS 23.401 [2] clause 4.2 and TS 23.402 [4]
clauses 4.2.2 and 4.2.3 for GTP-based interfaces when SGW, PGW and TDF
control and user planes are separated.

The reference points added to the reference points defined in
TS 23.401 [2], TS 23.402 [4] and TS 23.203 [3] are the following ones:

  Sxa: Reference point between SGW-C and SGW-U.

  Sxb: Reference point between PGW-C and PGW-U.

  Sxc: Reference point between TDF-C and TDF-U.


4.3  High level functions


4.3.1  General

This clause documents the existing functionality of SGW, PGW and TDF as
described in TS 23.401 [2], TS 23.402 [4] and TS 23.203 [3].

          Table 4.3.1-1: Existing functionality of SGW, PGW and TDF

|Main          |Sub-functionality         |SGW       |PGW       |TDF      |
|functionality |                          |          |          |         |
|A. Session    |1. Resource management for|X         |X         |         |
|management    |bearer resources          |          |          |         |
|(default &    |                          |          |          |         |
|dedicated     |                          |          |          |         |
|bearer        |                          |          |          |         |
|establishment,|                          |          |          |         |
|bearer        |                          |          |          |         |
|modification, |                          |          |          |         |
|bearer        |                          |          |          |         |
|deactivation) |                          |          |          |         |
|              |2. IP address and TEID    |X         |X         |         |
|              |assignment for GTP-U      |          |          |         |
|              |3. Packet forwarding      |X         |X         |         |
|              |4. Transport level packet |X         |X         |         |
|              |marking                   |          |          |         |
|B. UE IP      |1. IP address allocation  |          |X         |         |
|address       |from local pool           |          |          |         |
|management    |                          |          |          |         |
|              |2. DHCPv4 / DHCPv6 client |          |X         |         |
|              |3. DHCPv4 / DHCPv6 server |          |X         |         |
|              |4. Router advertisement,  |          |X         |         |
|              |router solicitation,      |          |          |         |
|              |neighbour advertisement,  |          |          |         |
|              |neighbour solicitation (as|          |          |         |
|              |in RFC 4861)              |          |          |         |
|C. Support for|1. Forwarding of "end     |X         |          |         |
|UE mobility   |marker" (as long as user  |          |          |         |
|              |plane to source eNB       |          |          |         |
|              |exists)                   |          |          |         |
|              |2. Sending of "end marker"|X         |X         |         |
|              |after switching the path  |          |          |         |
|              |to target node            |          |          |         |
|              |3. Forwarding of buffered |X         |          |         |
|              |packet                    |          |          |         |
|              |4. Change of target GTP-U |X         |X         |         |
|              |endpoint within 3GPP      |          |          |         |
|              |accesses                  |          |          |         |
|              |5. Change of target GTP-U |          |X         |         |
|              |endpoint between 3GPP and |          |          |         |
|              |non-3GPP access           |          |          |         |
|D. S1-Release |1. ECM-IDLE mode DL packet|X         |          |         |
|/ Buffering / |buffering; Triggering of  |          |          |         |
|Downlink Data |Downlink Data Notification|          |          |         |
|Notification  |message generation per    |          |          |         |
|              |bearer (multiple, if DL   |          |          |         |
|              |packet received on higher |          |          |         |
|              |ARP than previous DDN);   |          |          |         |
|              |Inclusion of DSCP of      |          |          |         |
|              |packet in DDN message for |          |          |         |
|              |Paging Policy             |          |          |         |
|              |Differentiation           |          |          |         |
|              |2. Delay Downlink Data    |X         |          |         |
|              |Notification Request (if  |          |          |         |
|              |terminating side replies  |          |          |         |
|              |to uplink data after UE   |          |          |         |
|              |service request before SGW|          |          |         |
|              |gets updated)             |          |          |         |
|              |3. Extended buffering of  |X         |          |         |
|              |downlink data when the UE |          |          |         |
|              |is in a power saving state|          |          |         |
|              |and not reachable (high   |          |          |         |
|              |latency communication);   |          |          |         |
|              |dropping of downlink data |          |          |         |
|              |(if MME has requested SGW |          |          |         |
|              |to throttle downlink low  |          |          |         |
|              |priority traffic and if   |          |          |         |
|              |the downlink data packet  |          |          |         |
|              |is received on such a     |          |          |         |
|              |bearer (see               |          |          |         |
|              |clause 4.3.7.4.1a).       |          |          |         |
|              |4. PGW pause of charging  |X         |X         |         |
|              |procedure based on        |          |          |         |
|              |operator                  |          |          |         |
|              |policy/configuration the  |          |          |         |
|              |SGW (failed paging,       |          |          |         |
|              |abnormal radio link       |          |          |         |
|              |release, number/fraction  |          |          |         |
|              |of packets/bytes dropped  |          |          |         |
|              |at SGW)                   |          |          |         |
|E. Bearer/APN |1. UL/DL APN-AMBR         |          |X         |X        |
|policing      |enforcement               |          |          |         |
|              |2. UL/DL bearer MBR       |          |X         |         |
|              |enforcement (for GBR      |          |          |         |
|              |bearer)                   |          |          |         |
|              |3. UL/DL bearer MBR       |          |X         |         |
|              |enforcement (for nonGBR   |          |          |         |
|              |bearer on Gn/Gp interface)|          |          |         |
|F. PCC related|1. Service detection (DPI,|          |X         |X        |
|functions     |IP-5-tuple)               |          |          |         |
|              |2. Bearer binding (bearer |          |X         |         |
|              |QoS & TFT)                |          |          |         |
|              |3. UL bearer binding      |          |X         |         |
|              |verification and mapping  |          |          |         |
|              |of DL traffic to bearers  |          |          |         |
|              |4. UL and DL service level|          |X         |X        |
|              |gating                    |          |          |         |
|              |5. UL and DL service level|          |X         |X        |
|              |MBR enforcement           |          |          |         |
|              |6. UL and DL service level|          |X         |X        |
|              |charging (online &        |          |          |         |
|              |offline, per charging key)|          |          |         |
|              |7. Usage monitoring       |          |X         |X        |
|              |8. Event reporting        |          |X         |X        |
|              |(including application    |          |          |         |
|              |detection)                |          |          |         |
|              |9. Request for forwarding |          |          |X        |
|              |of event reporting        |          |          |         |
|              |10. Redirection           |          |X         |X        |
|              |11. FMSS handling         |          |X         |X        |
|              |12. PCC support for NBIFOM|          |X         |         |
|              |13. DL DSCP marking for   |          |          |X        |
|              |application indication    |          |          |         |
|              |14. Predefined PCC/ADC    |          |X         |X        |
|              |rules activation and      |          |          |         |
|              |deactivation              |          |          |         |
|              |15. PCC support for SDCI  |          |X         |X        |
|G. NBIFOM     |Non-PCC aspects of NBIFOM |X         |X         |         |
|H.            |1. Accounting per UE and  |X         |X         |         |
|Inter-operator|bearer                    |          |          |         |
|accounting    |                          |          |          |         |
|(counting of  |                          |          |          |         |
|volume and    |                          |          |          |         |
|time)         |                          |          |          |         |
|              |2. Interfacing OFCS       |X         |X         |X        |
|              |through reference points  |          |          |         |
|              |specified in TS 32.240 [9]|          |          |         |
|I.            |Exchange of load/overload |X         |X         |         |
|Load/overload |control information and   |          |          |         |
|control       |actions during peer node  |          |          |         |
|functions     |overload                  |          |          |         |
|J. Lawful     |Interfacing LI functions  |X         |X         |         |
|interception  |through reference points  |          |          |         |
|              |specified in              |          |          |         |
|              |TS 33.107 [10] and        |          |          |         |
|              |performing LI             |          |          |         |
|              |functionality             |          |          |         |
|K. Packet     |                          |          |X         |         |
|screening     |                          |          |          |         |
|function      |                          |          |          |         |
|L. Restoration|                          |X         |X         |X        |
|and recovery  |                          |          |          |         |
|M. RADIUS /   |                          |          |X         |         |
|Diameter on   |                          |          |          |         |
|SGi           |                          |          |          |         |
|N. OAM        |                          |X         |X         |X        |
|interfaces    |                          |          |          |         |
|O. GTP bearer |Generation of echo        |X         |X         |         |
|and path      |request, handling of echo |          |          |         |
|management    |response, echo request    |          |          |         |
|              |timeout and Error         |          |          |         |
|              |Indication message        |          |          |         |



4.3.2  Functional split of SGW, PGW and TDF


4.3.2.1  Functional split of SGW

The following table describes the functionality of the SGW-C and the SGW-U.

All functionality performed by the SGW-U is controlled from the SGW-C and
thus even if it is marked below as a SGW-U functionality only, there will
be corresponding control functionality in the SGW-C.

  NOTE:  Functionality not marked for SGW-U is either only provided by SGW-
         C or does not require any specific SGW-U behaviour.

For interfaces not listed in the table below, Figure 4.2.1-1 describes
whether they are terminated in SGW- C or SGW-U.

                   Table 4.3.2-1: Functional split of SGW

|Main          |Sub-functionality         |SGW-C |SGW-U |Comments           |
|functionality |                          |      |      |                   |
|A. Session    |1. Resource management for|X     |X     |See clause 5.10    |
|management    |bearer resources          |      |      |                   |
|(default &    |                          |      |      |                   |
|dedicated     |                          |      |      |                   |
|bearer        |                          |      |      |                   |
|establishment,|                          |      |      |                   |
|bearer        |                          |      |      |                   |
|modification, |                          |      |      |                   |
|bearer        |                          |      |      |                   |
|deactivation) |                          |      |      |                   |
|              |2. IP address and TEID    |X     |X     |See clause 5.4     |
|              |assignment for GTP-U      |      |      |                   |
|              |3. Packet forwarding      |      |X     |                   |
|              |4. Transport level packet |      |X     |                   |
|              |marking                   |      |      |                   |
|C. Support for|1. Forwarding of "end     |      |X     |                   |
|UE mobility   |marker" (as long as user  |      |      |                   |
|              |plane to source eNB       |      |      |                   |
|              |exists)                   |      |      |                   |
|              |2. Sending of "end marker"|X     |X     |See clause 5.8     |
|              |after switching the path  |      |      |                   |
|              |to target node            |      |      |                   |
|              |3. Forwarding of buffered |X     |X     |See clause 5.9     |
|              |packet                    |      |      |                   |
|              |4. Change of target GTP-U |X     |      |                   |
|              |endpoint within 3GPP      |      |      |                   |
|              |accesses                  |      |      |                   |
|              |5. Change of target GTP-U |      |      |N/A                |
|              |endpoint between 3GPP and |      |      |                   |
|              |non-3GPP access           |      |      |                   |
|D. S1-Release |1. ECM-IDLE mode DL packet|X     |X     |See clause 5.9     |
|/ Buffering / |buffering; Triggering of  |      |      |                   |
|Downlink Data |Downlink Data Notification|      |      |                   |
|Notification  |message generation per    |      |      |                   |
|              |bearer (multiple, if DL   |      |      |                   |
|              |packet received on higher |      |      |                   |
|              |ARP than previous DDN);   |      |      |                   |
|              |Inclusion of DSCP of      |      |      |                   |
|              |packet in DDN message for |      |      |                   |
|              |Paging Policy             |      |      |                   |
|              |Differentiation           |      |      |                   |
|              |2. Delay Downlink Data    |X     |      |                   |
|              |Notification Request (if  |      |      |                   |
|              |terminating side replies  |      |      |                   |
|              |to uplink data after UE   |      |      |                   |
|              |service request before SGW|      |      |                   |
|              |gets updated)             |      |      |                   |
|              |3. Extended buffering of  |X     |X     |See clause 5.9     |
|              |downlink data when the UE |      |      |                   |
|              |is in a power saving state|      |      |                   |
|              |and not reachable (high   |      |      |                   |
|              |latency communication);   |      |      |                   |
|              |dropping of downlink data |      |      |                   |
|              |(if MME has requested SGW |      |      |                   |
|              |to throttle downlink low  |      |      |                   |
|              |priority traffic and if   |      |      |                   |
|              |the downlink data packet  |      |      |                   |
|              |is received on such a     |      |      |                   |
|              |bearer (see               |      |      |                   |
|              |clause 4.3.7.4.1a).       |      |      |                   |
|              |4. PGW pause of charging  |X     |      |See clause 5.3.4   |
|              |procedure based on        |      |      |                   |
|              |operator                  |      |      |                   |
|              |policy/configuration the  |      |      |                   |
|              |SGW (failed paging,       |      |      |                   |
|              |abnormal radio link       |      |      |                   |
|              |release, number/fraction  |      |      |                   |
|              |of packets/bytes dropped  |      |      |                   |
|              |at SGW)                   |      |      |                   |
|G. NBIFOM     |Non-PCC aspects of NBIFOM |X     |      |                   |
|H.            |1. Accounting per UE and  |      |X     |See clause 5.3     |
|Inter-operator|bearer                    |      |      |                   |
|accounting    |                          |      |      |                   |
|(counting of  |                          |      |      |                   |
|volume and    |                          |      |      |                   |
|time)         |                          |      |      |                   |
|              |2. Interfacing OFCS       |X     |      |See clause 5.3     |
|              |through reference points  |      |      |                   |
|              |specified in TS 32.240 [9]|      |      |                   |
|I.            |Exchange of load/overload |      |      |As defined in      |
|Load/overload |control information and   |      |      |CT WG4             |
|control       |actions during peer node  |      |      |TS 29.244 [12]     |
|functions     |overload                  |      |      |                   |
|J. Lawful     |Interfacing LI functions  |X     |X     |As defined in      |
|interception  |through reference points  |      |      |SA WG3-LI          |
|              |specified in              |      |      |TS 33.107 [10]     |
|              |TS 33.107 [10] and        |      |      |                   |
|              |performing LI             |      |      |                   |
|              |functionality             |      |      |                   |
|L. Restoration|                          |      |      |As defined in      |
|and recovery  |                          |      |      |CT WG4             |
|              |                          |      |      |TS 29.244 [12]     |
|N. OAM        |                          |      |      |As defined in      |
|interfaces    |                          |      |      |SA WG5 TS xx.xxx   |
|O. GTP bearer |Generation of echo        |      |      |As defined in      |
|and path      |request, handling of echo |      |      |CT WG4             |
|management    |response, echo request    |      |      |TS 29.244 [12]     |
|              |timeout and Error         |      |      |                   |
|              |Indication message        |      |      |                   |



4.3.2.2  Functional split of PGW

The following table describes the functionality of the PGW-C and the PGW-U.

All functionality performed by the PGW-U is controlled from the PGW-C and
thus even if it is marked below as a PGW-U functionality only there will be
corresponding control functionality in the PGW-C.

  NOTE:  Functionality not marked for PGW-U is either only provided by PGW-
         C or does not require any specific PGW-U behaviour.

For interfaces not listed in the table below, Figure 4.2.1-1 describes
whether they are terminated in the PGW-C or the PGW-U.

                   Table 4.3.2-2: Functional split of PGW

|Main          |Sub-functionality         |PGW-C  |PGW-U  |Comments         |
|functionality |                          |       |       |                 |
|A. Session    |1. Resource management for|X      |X      |See clause 5.10  |
|management    |bearer resources          |       |       |                 |
|(default &    |                          |       |       |                 |
|dedicated     |                          |       |       |                 |
|bearer        |                          |       |       |                 |
|establishment,|                          |       |       |                 |
|bearer        |                          |       |       |                 |
|modification, |                          |       |       |                 |
|bearer        |                          |       |       |                 |
|deactivation) |                          |       |       |                 |
|              |2. IP address and TEID    |X      |X      |See clause 5.4   |
|              |assignment for GTP-U      |       |       |                 |
|              |3. Packet forwarding      |       |X      |                 |
|              |4. Transport level packet |       |X      |                 |
|              |marking                   |       |       |                 |
|B. UE IP      |1. IP address allocation  |X      |       |See clause 5.5   |
|address       |from local pool           |       |       |                 |
|management    |                          |       |       |                 |
|              |2. DHCPv4 / DHCPv6 client |X      |       |See clause 5.5   |
|              |3. DHCPv4 / DHCPv6 server |X      |       |See clause 5.5   |
|              |4. Router advertisement,  |X      |       |See clause 5.5   |
|              |router solicitation,      |       |       |                 |
|              |neighbour advertisement,  |       |       |                 |
|              |neighbour solicitation (as|       |       |                 |
|              |in RFC 4861)              |       |       |                 |
|C. Support for|1. Forwarding of "end     |       |       |N/A              |
|UE mobility   |marker" (as long as user  |       |       |                 |
|              |plane to source eNB       |       |       |                 |
|              |exists)                   |       |       |                 |
|              |2. Sending of "end marker"|X      |X      |See clause 5.8   |
|              |after switching the path  |       |       |                 |
|              |to target node            |       |       |                 |
|              |3. Forwarding of buffered |       |       |N/A              |
|              |packet                    |       |       |                 |
|              |4. Change of target GTP-U |X      |       |                 |
|              |endpoint within 3GPP      |       |       |                 |
|              |accesses                  |       |       |                 |
|              |5. Change of target GTP-U |X      |       |                 |
|              |endpoint between 3GPP and |       |       |                 |
|              |non-3GPP access           |       |       |                 |
|D. S1-Release |1. ECM-IDLE mode DL packet|       |       |N/A              |
|/ Buffering / |buffering; Triggering of  |       |       |                 |
|Downlink Data |Downlink Data Notification|       |       |                 |
|Notification  |message generation per    |       |       |                 |
|              |bearer (multiple, if DL   |       |       |                 |
|              |packet received on higher |       |       |                 |
|              |ARP than previous DDN);   |       |       |                 |
|              |Inclusion of DSCP of      |       |       |                 |
|              |packet in DDN message for |       |       |                 |
|              |Paging Policy             |       |       |                 |
|              |Differentiation           |       |       |                 |
|              |2. Delay Downlink Data    |       |       |N/A              |
|              |Notification Request (if  |       |       |                 |
|              |terminating side replies  |       |       |                 |
|              |to uplink data after UE   |       |       |                 |
|              |service request before SGW|       |       |                 |
|              |gets updated)             |       |       |                 |
|              |3. Extended buffering of  |       |       |N/A              |
|              |downlink data when the UE |       |       |                 |
|              |is in a power saving state|       |       |                 |
|              |and not reachable (high   |       |       |                 |
|              |latency communication);   |       |       |                 |
|              |dropping of downlink data |       |       |                 |
|              |(if MME has requested SGW |       |       |                 |
|              |to throttle downlink low  |       |       |                 |
|              |priority traffic and if   |       |       |                 |
|              |the downlink data packet  |       |       |                 |
|              |is received on such a     |       |       |                 |
|              |bearer (see 4.3.7.4.1a).  |       |       |                 |
|              |4. PGW pause of charging  |X      |       |See clause 5.3.4 |
|              |procedure based on        |       |       |                 |
|              |operator                  |       |       |                 |
|              |policy/configuration the  |       |       |                 |
|              |SGW (failed paging,       |       |       |                 |
|              |abnormal radio link       |       |       |                 |
|              |release, number/fraction  |       |       |                 |
|              |of packets/bytes dropped  |       |       |                 |
|              |at SGW)                   |       |       |                 |
|E. Bearer/APN |1. UL/DL APN-AMBR         |       |X      |                 |
|policing      |enforcement               |       |       |                 |
|              |2. UL/DL bearer MBR       |       |X      |                 |
|              |enforcement (for GBR      |       |       |                 |
|              |bearer)                   |       |       |                 |
|              |3. UL/DL bearer MBR       |       |X      |                 |
|              |enforcement (for nonGBR   |       |       |                 |
|              |bearer on Gn/Gp interface)|       |       |                 |
|F. PCC related|1. Service detection (DPI,|       |X      |                 |
|functions     |IP-5-tuple)               |       |       |                 |
|              |2. Bearer binding (bearer |X      |       |                 |
|              |QoS & TFT)                |       |       |                 |
|              |3. UL bearer binding      |       |X      |See clause 5.2   |
|              |verification and mapping  |       |       |                 |
|              |of DL traffic to bearers  |       |       |                 |
|              |4. UL and DL service level|       |X      |                 |
|              |gating                    |       |       |                 |
|              |5. UL and DL service level|       |X      |                 |
|              |MBR enforcement           |       |       |                 |
|              |6. UL and DL service level|X      |X      |See clause 5.3   |
|              |charging (online &        |       |       |                 |
|              |offline, per charging key)|       |       |                 |
|              |7. Usage monitoring       |X      |X      |See clause 5.3   |
|              |8. Event reporting        |X      |X      |Note: User-plane |
|              |(including application    |       |       |related events   |
|              |detection)                |       |       |such as          |
|              |                          |       |       |application      |
|              |                          |       |       |detection        |
|              |                          |       |       |reporting        |
|              |                          |       |       |supported in UP  |
|              |                          |       |       |function, while  |
|              |                          |       |       |control-plane    |
|              |                          |       |       |related events   |
|              |                          |       |       |such as RAT      |
|              |                          |       |       |change etc.      |
|              |                          |       |       |supported only in|
|              |                          |       |       |CP function.     |
|              |9. Request for forwarding |       |       |N/A              |
|              |of event reporting        |       |       |                 |
|              |10. Redirection           |X      |X      |See clause 5.11.3|
|              |11. FMSS handling         |       |X      |                 |
|              |12. PCC support for NBIFOM|X      |       |                 |
|              |13. DL DSCP marking for   |       |       |N/A              |
|              |application indication    |       |       |                 |
|              |14. Predefined PCC/ADC    |X      |X      |See clause 5.11.1|
|              |rules activation and      |       |       |                 |
|              |deactivation              |       |       |                 |
|              |15. PCC support for SDCI  |X      |X      |See clause 5.11.4|
|G. NBIFOM     |Non-PCC aspects of NBIFOM |X      |       |                 |
|H.            |1. Accounting per UE and  |       |X      |See clause 5.3   |
|Inter-operator|bearer                    |       |       |                 |
|accounting    |                          |       |       |                 |
|(counting of  |                          |       |       |                 |
|volume and    |                          |       |       |                 |
|time)         |                          |       |       |                 |
|              |2. Interfacing OFCS       |X      |       |See clause 5.3   |
|              |through reference points  |       |       |                 |
|              |specified in TS 32.240 [9]|       |       |                 |
|I.            |Exchange of load/overload |       |       |As defined in    |
|Load/overload |control information and   |       |       |CT WG4           |
|control       |actions during peer node  |       |       |TS 29.244 [12]   |
|functions     |overload                  |       |       |                 |
|J. Lawful     |Interfacing LI functions  |X      |X      |As defined in    |
|interception  |through reference points  |       |       |SA WG3-LI        |
|              |specified in              |       |       |TS 33.107 [10]   |
|              |TS 33.107 [10] and        |       |       |                 |
|              |performing LI             |       |       |                 |
|              |functionality             |       |       |                 |
|K. Packet     |                          |       |X      |                 |
|screening     |                          |       |       |                 |
|function      |                          |       |       |                 |
|L. Restoration|                          |       |       |As defined in    |
|and recovery  |                          |       |       |CT WG4           |
|              |                          |       |       |TS 29.244 [12]   |
|M. RADIUS /   |                          |X      |X      |See clause 5.5   |
|Diameter on   |                          |       |       |                 |
|SGi           |                          |       |       |                 |
|N. OAM        |                          |       |       |As defined in    |
|interfaces    |                          |       |       |SA WG5 TS xx.xxx |
|O. GTP bearer |Generation of echo        |       |       |As defined in    |
|and path      |request, handling of echo |       |       |CT WG4           |
|management    |response, echo request    |       |       |TS 29.244 [12]   |
|              |timeout and Error         |       |       |                 |
|              |Indication message        |       |       |                 |



4.3.2.3  Functional split of TDF

The following table describes the functionality of the TDF-C and the TDF-U.

All functionality performed by the TDF-U is controlled from the TDF-C and
thus even if it is marked below as a TDF-U functionality only there will be
corresponding control functionality in the TDF-C.

For interfaces not listed in the table below, Figure 4.2.1-1 describes
whether they are terminated in the TDF-C or TDF-U.

                   Table 4.3.2-3: Functional split of TDF

|Main          |Sub-functionality         |TDF-C |TDF-U  |Comments         |
|functionality |                          |      |       |                 |
|E. Bearer/APN |1. UL/DL APN-AMBR         |      |X      |Not identical to |
|policing      |enforcement               |      |       |APN-AMBR         |
|              |                          |      |       |enforcement as it|
|              |                          |      |       |a) covers every  |
|              |                          |      |       |flow in TDF      |
|              |                          |      |       |session and b)   |
|              |                          |      |       |does not cover   |
|              |                          |      |       |other TDF        |
|              |                          |      |       |sessions of the  |
|              |                          |      |       |UE to the same   |
|              |                          |      |       |APN              |
|              |2. UL/DL bearer MBR       |      |       |N/A              |
|              |enforcement (for GBR      |      |       |                 |
|              |bearer)                   |      |       |                 |
|              |3. UL/DL bearer MBR       |      |       |N/A              |
|              |enforcement (for nonGBR   |      |       |                 |
|              |bearer on Gn/Gp interface)|      |       |                 |
|F. PCC related|1. Service detection (DPI,|      |X      |                 |
|functions     |IP-5-tuple)               |      |       |                 |
|              |2. Bearer binding (bearer |      |       |N/A              |
|              |QoS & TFT)                |      |       |                 |
|              |3. UL bearer binding      |      |       |N/A              |
|              |verification and mapping  |      |       |                 |
|              |of DL traffic to bearers  |      |       |                 |
|              |4. UL and DL service level|      |X      |                 |
|              |gating                    |      |       |                 |
|              |5. UL and DL service level|      |X      |                 |
|              |MBR enforcement           |      |       |                 |
|              |6. UL and DL service level|X     |X      |See clause 5.3   |
|              |charging (online &        |      |       |                 |
|              |offline, per charging key)|      |       |                 |
|              |7. Usage monitoring       |X     |X      |See clause 5.3   |
|              |8. Event reporting        |X     |X      |Note: User-plane |
|              |(including application    |      |       |related events   |
|              |detection)                |      |       |such as          |
|              |                          |      |       |application      |
|              |                          |      |       |detection        |
|              |                          |      |       |reporting        |
|              |                          |      |       |supported in UP  |
|              |                          |      |       |function, while  |
|              |                          |      |       |control-plane    |
|              |                          |      |       |related events   |
|              |                          |      |       |such as RAT      |
|              |                          |      |       |change etc.      |
|              |                          |      |       |supported only in|
|              |                          |      |       |CP function.     |
|              |9. Request for forwarding |X     |       |                 |
|              |of event reporting        |      |       |                 |
|              |10. Redirection           |X     |X      |See clause 5.11.3|
|              |11. FMSS handling         |      |X      |                 |
|              |12. PCC support for NBIFOM|      |       |N/A              |
|              |13. DL DSCP marking for   |      |X      |                 |
|              |application indication    |      |       |                 |
|              |14. Predefined PCC/ADC    |X     |X      |See clause 5.11.1|
|              |rules activation and      |      |       |                 |
|              |deactivation              |      |       |                 |
|              |15. PCC support for SDCI  |X     |X      |See clause 5.11.4|
|H.            |1. Accounting per UE and  |      |       |N/A              |
|Inter-operator|bearer                    |      |       |                 |
|accounting    |                          |      |       |                 |
|(counting of  |                          |      |       |                 |
|volume and    |                          |      |       |                 |
|time)         |                          |      |       |                 |
|              |2. Interfacing OFCS       |X     |       |See clause 5.3   |
|              |through reference points  |      |       |                 |
|              |specified in TS 32.240 [9]|      |       |                 |
|I.            |Exchange of load/overload |      |       |As defined in    |
|Load/overload |control information and   |      |       |CT WG4           |
|control       |actions during peer node  |      |       |TS 29.244 [12]   |
|functions     |overload                  |      |       |                 |
|L. Restoration|                          |      |       |As defined in    |
|and recovery  |                          |      |       |CT WG4           |
|              |                          |      |       |TS 29.244 [12]   |
|N. OAM        |                          |      |       |As defined in    |
|interfaces    |                          |      |       |SA WG5 TS xx.xxx |



4.3.3  User Plane Function selection

The CP function of a functional entity performs selection of its respective
UP function considering parameters such as UE's location information,
capability of the UP function and features required for an UE.
Additionally, the selection of UP function shall consider UP function
deployment scenarios such as centrally located UP function and distributed
UP functions located close to or at the RAN site. The selection of UP
function shall also allow deployment of UP functions with different
capabilities, e.g. UP functions supporting no or a subset of optional
functionalities.

For standalone CP functions:

  -  SGW's CP function shall select SGW's UP function;

  -  PGW's CP function shall select PGW's UP function;

  -  TDF's CP function shall select TDF's UP function.

Combined SGW/PGW's CP function should select either combined SGW/PGW UP
function or standalone SGW UP and PGW UP functions.

For details, refer to clause 5.12.


4.3.4  SGW-C Partitioning

If the SGW-U service area is smaller than the SGW-C service area, the SGW-C
can be partitioned into multiple SGW-C partitions. Each of the SGW-C
partition is aligned with the corresponding SGW-U service area. The MME
treats the SGW-C partition as legacy SGW.

  NOTE 1:  There is only one Sxa reference point between one SGW-C and one
         SGW-U.

  NOTE 2:  This ensures that the TAI List allocated by the MME will only
         contain TAs that have connectivity to the SGW-U function serving
         the UE in case the MME uses the service area of the SGW-C partition
         when constructing the TAI List (and it cannot be assured that there
         is "full mesh" IP connectivity between the eNBs and the SGW-U
         function outside the SGW-U Service Area).

  NOTE 3:  If more than one SGW-U is selected to serve a given UE, these
         SGW-Us need to cover an area including at least the service area of
         the SGW-C.


4.4  Network elements


4.4.1  General

SGW-C and SGW-U jointly provide functionality equivalent to the
functionality provided by SGW as defined by the TS 23.401 [2].

PGW-C and PGW-U jointly provide functionality equivalent to the
functionality provided by PGW as defined by the TS 23.401 [2] and
TS 23.402 [4], and the PCEF as defined by the TS 23.203 [3].

TDF-C and TDF-U jointly provide functionality equivalent to the
functionality provided by TDF as defined by the TS 23.203 [3].

The clause 4.3.2 defines how the functional control and user plane split is
done and which functionality SGW-C, SGW-U, PGW-C, PGW-U, TDF-C, TDF-U
correspondingly support.


4.4.2  SGW control plane function

The SGW control plane function (SGW-C) provides the functionality of the
SGW as defined by TS 23.401 [2] except for the functions that are performed
by the SGW-U as described in table 4.3.2-1.

In addition, the SGW-C is responsible for selecting the SGW-U (as described
in clause 4.3.3) and for controlling the SGW-U with respect to the
functions described in table 4.3.2-1.


4.4.3  SGW user plane function

The SGW user plane function (SGW-U) provides the functionality described in
this TS. The functions that are performed by the SGW-U are listed in table
4.3.2-1 together with a reference to a detailed functional description in
clause 5 for some of them. The control parameters relevant for the SGW-U
are described in clause 7.

  NOTE:  The standard allows certain functionalities to be supported in
         both SGW-C and SGW-U. For details refer to clause 5.


4.4.4  PGW control plane function

The PGW control plane function (PGW-C) provides the functionality of the
PGW as defined by TS 23.401 [2] and TS 23.402 [4], and the PCEF as defined
by the TS 23.203 [3] except for the functions that are performed by the PGW-
U as described in table 4.3.2-2.

In addition, the PGW-C is responsible for selecting the PGW-U (as described
in clause 4.3.3) and for controlling the PGW-U with respect to the
functions described in table 4.3.2-2.


4.4.5  PGW user plane function

The PGW user plane function (PGW-U) provides the functionality described in
this TS. The functions that are performed by the PGW-U are listed in table
4.3.2-2 together with a reference to a detailed functional description in
clause 5 for some of them. The control parameters relevant for the PGW-U
are described in clause 7.

  NOTE:  The standard allows certain functionalities to be supported in
         both PGW-C and PGW-U. For details refer to clause 5.


4.4.6  TDF control plane function

The TDF control plane function (TDF -C) provides the functionality of the
TDF as defined by TS 23.203 [3] except for the functions that are performed
by the TDF -U as described in table 4.3.2-3.

In addition, the TDF -C is responsible for selecting the TDF -U (as
described in clause 4.3.3) and for controlling the TDF -U with respect to
the functions described in table 4.3.2-3.


4.4.7  TDF user plane function

The TDF user plane function (TDF -U) provides the functionality described
in this TS. The functions that are performed by the TDF -U are listed in
table 4.3.2-3 together with a reference to a detailed functional
description in clause 5 for some of them. The control parameters relevant
for the TDF-U are described in clause 7.

  NOTE:  The standard allows certain functionalities to be supported in
         both TDF-C and TDF-U. For details refer to clause 5.


5  Functional description


5.1  General

This clause contains detailed functional descriptions for some of the
functions provided by the UP function of SGW, PGW and TDF (whether a
function has to be supported by a functional entity is defined in
clause 4.3.2). It is documented how the respective CP function instructs
it's corresponding UP function and which control parameters are used.


5.2  Traffic detection


5.2.1  General

This clause describes the detection process at the UP function that
identifies the packets belonging to a bearer, service data flow or IP-
CAN/TDF session.

The CP function is responsible for instructing the UP function about how to
detect user data traffic belonging to a Packet Detection Rule (PDR). The
other parameters provided within a PDR describe how the UP function shall
treat a packet that matches the detection information.


5.2.2  Traffic detection information

The CP function controls the traffic detection at the UP function by
providing detection information for every PDR. Detection information is a
combination of:

  -  UE IP address;

  -  F-TEIDu;

  -  SDF filters as defined in TS 23.203 [3];

  -  Application ID (referring to an application detection filter) as
    defined in TS 23.203 [3].

The following Table 5.2.2-1 lists the possible combinations of the traffic
detection information for the different UP functions and usage scenarios.

   Table 5.2.2-1: Detection information for the different UP functions and
                               usage scenarios

|Usage |UP     |Detection          |Detection          |Description          |
|scenar|functio|information for UL |information for DL |                     |
|io    |n      |                   |                   |                     |
|1     |SGW-U  |Local F-TEIDu      |Local F-TEIDu (core|Detection of traffic |
|      |       |(access side)      |side)              |belonging to a bearer|
|2     |PGW-U  |Local F-TEIDu      |UE IP address as   |Detection of traffic |
|      |       |(access side) +    |destination +      |belonging to a       |
|      |       |uplink SDF         |downlink SDF       |service data flow +  |
|      |       |filter(s)/applicati|filter(s)/applicati|UL bearer binding    |
|      |       |on ID              |on ID              |verification (based  |
|      |       |(NOTE 2)           |                   |on F-TEIDu in UL     |
|      |       |                   |                   |filter)              |
|3     |PGW-U  |Local F-TEID       |UE IP address as   |Usage scenario 2 +   |
|      |       |(access side) + UE |destination +      |Packet screening     |
|      |       |IP address as      |downlink SDF       |(based on UE IP as   |
|      |       |source + uplink SDF|filter(s)/applicati|source in UL filter) |
|      |       |filter(s)/applicati|on ID              |                     |
|      |       |on ID              |                   |                     |
|      |       |(NOTE 2)           |                   |                     |
|4     |PGW-U  |Local F-TEID       |-                  |Detection of         |
|      |       |(access side)      |                   |remaining traffic,   |
|      |       |(NOTE 1)           |                   |e.g. with wrong UE IP|
|      |       |                   |                   |address or on wrong  |
|      |       |                   |                   |bearer, for          |
|      |       |                   |                   |measurement and      |
|      |       |                   |                   |discarding.          |
|5     |PGW-U  |-                  |UE IP address as   |Detection of         |
|      |       |                   |destination        |remaining traffic,   |
|      |       |                   |(NOTE 1)           |e.g. not matching any|
|      |       |                   |                   |other detection      |
|      |       |                   |                   |information, for     |
|      |       |                   |                   |discarding.          |
|6     |PGW-U  |-                  |Downlink SDF       |Detection of RADIUS, |
|      |       |                   |filter(s)/applicati|Diameter and DHCP    |
|      |       |                   |on ID              |signalling traffic on|
|      |       |                   |(NOTE 2)           |SGi.                 |
|7     |TDF-U  |UE IP address as   |UE IP address as   |Detection of traffic |
|      |       |source + uplink SDF|destination +      |belonging to a       |
|      |       |filter(s)/applicati|downlink SDF       |service data flow    |
|      |       |on ID              |filter(s)/applicati|                     |
|      |       |                   |on ID              |                     |
|8     |TDF-U  |UE IP address as   |UE IP address as   |Detecting of         |
|      |       |source             |destination        |remaining traffic    |
|      |       |(NOTE 1)           |(NOTE 1)           |(i.e. not matching   |
|      |       |                   |                   |any other PDR)       |
|      |       |                   |                   |belonging to a TDF   |
|      |       |                   |                   |session              |
|NOTE 1: A PDR with such detection information should have the lowest        |
|precedence amongst all the PDRs installed for this Sx session.              |
|NOTE 2: The detection of traffic related to UE IP address allocation as well|
|as RADIUS, Diameter and DHCP signalling traffic on SGi can be accomplished  |
|using SDF filter(s) or an application ID (referring to an application       |
|detection filter).                                                          |



5.3  Charging and usage monitoring handling


5.3.1  General

If functional split of SGW into SGW-C and SGW-U is supported, the overall
functionality of offline charging support as defined by TS 23.401 [2] and
TS 32.251 [8] shall be preserved.

If functional split of PGW into PGW-C and PGW-U is supported, the overall
functionality of online and offline charging as defined by TS 32.251 [8],
and of usage monitoring control as defined by TS 23.401 [2], TS 23.203 [3]
shall be preserved.

If functional split of TDF into TDF-C and TDF-U is supported, the overall
functionality of online and offline charging as defined by TS 32.251 [8],
and of usage monitoring control as defined by TS 23.203 [3] shall be
preserved.

The following principles shall apply in case of a functional split:

  -  The Gx, Sd, Gy, Gyn, Gz, Gzn interfaces as well as the interface
    between SGW and OFCS shall be terminated in the CP function (SGW-C/PGW-
    C/TDF-C). This implies that the CP function shall support those
    interfaces towards OCS/OFCS and PCRF, based on information received at
    the corresponding CP function as well as gathered user-plane related
    information received from the UP function as further described below.

  -  There is no impact on PCRF, OCS and OFCS compared to non-split
    architecture.

  -  All bearer/traffic flow level, session level and subscriber related
    information remains at the CP function, and only usage information is
    requested from UP function.


5.3.2  Activation of usage reporting in UP function

Triggered by the PCC/ADC rules received from the PCRF or preconfigured
information available at PGW-C/TDF-C/SGW-C, as well as from the OCS for
online charging via Credit-Control session mechanisms, the CP function (PGW-
C/TDF-C/SGW-C) shall provide Usage Reporting Rules to the UP function (PGW-
U/TDF-U/SGW-U) for controlling how usage reporting is performed.

The CP function shall request the report of the relevant usage information
for Usage Monitoring, based on Monitoring Keys and triggers which are
specified in TS 23.203 [3] and TS 29.212 [11]. Each Usage Reporting Rule
requested for usage monitoring control contains a list of "traffic flows"
for PGW-U and TDF-U whose traffic is to be accounted under this rule. The
CP function shall use Monitoring-key either preconfigured or received from
the PCRF within the PCC/ADC Rule in order to generate this list and also
shall keep the mapping between them. This list may overlap across multiple
Usage-Report-Rules, i.e. multiple different Usage Reporting Rules may
contain the same "traffic flows".

The CP function shall request the report of the relevant usage information
for offline and online charging, based on Rating Groups and triggers which
are specified in TS 32.251 [8]. Each Usage Reporting Rule requested for
offline or online charging contains a list of "traffic flows" for PGW-U and
TDF-U whose traffic is to be accounted under this rule. The CP function
shall use Rating Group or Sponsor Identity either preconfigured or provided
by PCRF and/or OCS as defined in TS 32.251 [8] and the PCC/ADC rule in
order to generate this list and also shall keep the mapping between them.
This list may overlap across multiple Usage-Report-Rules, i.e. multiple
different Usage Reporting Rules may contain the same "traffic flows".

The CP function shall also provide reporting trigger events to the UP
function for when to report usage information. The reporting trigger events
(e.g. triggers, threshold information etc.) shall be supported for the
session (IP-CAN/TDF) level reporting as well as on Rule level basis as
determined by the CP function. The triggers may be provided as a volume,
time or event to cater for the different charging/usage monitoring models
supported by the TS 23.203 [3] for usage monitoring and by TS 32.251 [8]
for offline and online charging. The CP function shall decide on the
thresholds value(s) based on allowance received from PCRF, OCS or based on
local configuration.

In some cases, the same Usage Reporting Rule can be used for different
purposes (for both usage monitoring and charging), e.g. in case the same
set of traffic flows, measurement method, trigger event, threshold, etc.
apply. Similarly a reported measurement can be used for different purposes
by the CP function.


5.3.3  Reporting of usage information towards CP function

The UP function shall support reporting of usage information to the CP
function. The UP function shall be capable to support reporting based on
different triggers, including:

  -  Periodic reporting with period defined by the CP function.

  -  Usage thresholds provided by the CP function.

  -  Report on demand received from the CP function.

The CP function shall make sure that the multiple granularity levels
required by the reporting keys in the Usage Reporting rules satisfy the
following aggregation levels without requiring a knowledge of the
granularity levels by the UP function:

  -  Session level reporting (IP-CAN/TDF session);

  -  Bearer (for charging)/traffic flow (for both charging and usage
    monitoring) level reporting as defined by the reporting keys in the
    Usage Reporting Rule (see the description above).

Based on the mapping between Monitoring-key and PCC/ADC rule stored at the
CP function, the CP function shall combine the reported information with
session and subscriber related information which is available at the CP
function, for Usage Monitoring reporting over the corresponding Gx, Sd
interfaces.

Based on the mapping between Rating Group or Sponsor Identity and PCC/ADC
rule stored at the CP function, the CP function shall combine the reported
information with session and subscriber related information which is
available at the CP function, for offline and online charging reporting
over the corresponding Gy, Gyn, Gz, Gzn interfaces.

This functionality is specified in TS 32.240 [9].

The usage information shall be collected in the UP function and reported to
the CP function as defined in 5.3.3, based on Monitoring Keys and triggers
which are specified in TS 23.203 [3] and TS 29.212 [11].


5.3.4  PGW Pause of Charging

When the UE moves to ECM-IDLE state and the SGW-C decides to activate
buffering in SGW-U for the session, it shall also instruct the SGW-U to
measure the number of packets/bytes that are buffered or discarded in SGW-U
and the criteria for reporting within the Usage Reporting Rule.

Once the trigger of reporting is met, the SGW-U shall inform the SGW-C by
reporting usage information.

The SGW-C can then inform the PGW-C as described in TS 23.401 [2].

When the PGW-C determines to stop the charging and usage monitoring actions
for the PDN connection, it shall indicate the PGW-U to stop collecting the
usage information.

PGW-C sends an Sx session modification request message to the PGW-U and
modifies all the Usage Reporting Rules within the PDN connection to
indicate the usage collection shall be stopped. When PGW-C determines to
continue the charging action for the PDN connection, it sends an Sx session
modification request message to the PGW-U and modifies all the Usage
Reporting Rules within the PDN connection to indicate the usage collection
shall be resumed.

  NOTE:  The support for PGW pause of charging is optional as described in
         TS 23.401 [2], and used only if both the SGW-C and the PGW-C
         support this feature.


5.4  GTP-U IP address and TEIDu allocation


5.4.1  General

Allocation and release of F-TEIDu is performed by SGW and PGW when a bearer
needs to be established or released. If functional split into SGW-C/PGW-C
and SGW-U/PGW-U is supported, F-TEIDu allocation and release can either be
done in the CP function or in the UP function, as described in clauses
5.4.2 and 5.4.3 below.

The support of F-TEIDu allocation by the CP function is mandatory, and the
support of F-TEIDu allocation by the UP function is optional. The UP
function shall support F-TEIDu allocation by the CP function. The CP
function optionally supports F-TEIDu allocation by the UP function.

Whether F-TEIDu allocation/release is performed by CP function or UP
function is determined by network configuration of the CP functions. When
both F-TEIDu allocation in CP function and F-TEIDu allocation in UP
function coexist in the same network, the same F-TEIDu allocation option
shall be used by all the CP functions controlling a particular UP function.


5.4.2  F-TEIDu allocation / release in the CP function

If the network is configured to perform allocation/release of F-TEIDu in
the SGW-C, the SGW-C shall manage the SGW F-TEIDu space, including ensuring
that the allocated F-TEIDu(s) are unique as described in TS 29.060 [6]. The
SGW-C shall allocate F-TEIDu(s) for the applicable SGW-U reference points
when a bearer is activated and release the F-TEIDu(s) when a bearer is
deactivated. In case of bearer activation, the SGW-C shall provide the
allocated F-TEIDu(s) to SGW-U. The SGW-C shall also provide the F-TEIDu(s)
to other network entities as described in TS 23.401 [2] in order to
complete the bearer establishment. In case of bearer deactivation, the SGW-
C shall notify the SGW-U about the release of the F-TEIDu(s).

If network is configured to perform allocation/release of F-TEIDu in the
PGW-C, the PGW-C shall manage the PGW F-TEIDu space, including ensuring
that the allocated F-TEIDu(s) are unique as described in TS 29.060 [6]. The
PGW-C shall allocate F-TEIDu(s) for the applicable PGW-U reference points
when a bearer is activated and release the F-TEIDu(s) when a bearer is
deactivated. In case of bearer activation, the PGW-C shall provide the
allocated F-TEIDu(s) to PGW-U. The PGW-C shall also provide the F-TEIDu(s)
to other network entities as described in TS 23.401 [2] and TS 23.402 [4]
in order to complete the bearer establishment. In case of bearer
deactivation, the PGW-C shall notify the PGW-U about the release of the F-
TEIDu(s).


5.4.3  F-TEIDu allocation / release in the UP function

If the network is configured to perform allocation/release of F-TEIDu in
the SGW-U, the SGW-U shall manage the SGW F-TEIDu space, including ensuring
that the allocated F-TEIDu(s) are unique as described in TS 29.060 [6]. In
case of bearer activation, the SGW-C shall request SGW-U to allocate F-
TEIDu(s) for the applicable SGW-U reference points and provide them to the
SGW-C. The SGW-C shall provide the F-TEIDu(s) to other network entities as
described in TS 23.401 [2] in order to complete the bearer establishment.
In case of bearer deactivation, the SGW-C shall request SGW-U to release F-
TEIDu(s) for the bearer.

If the network is configured to perform allocation/release of F-TEIDu in
the PGW-U, the PGW-U shall manage the PGW F-TEIDu space, including ensuring
that the allocated F-TEIDu(s) are unique as described in TS 29.060 [6]. In
case of bearer activation, the PGW-C shall request PGW-U to allocate F-
TEIDu(s) for the applicable PGW-U reference points and provide them to the
PGW-C. The PGW-C shall provide the F-TEIDu(s) to other network entities as
described in TS 23.401 [2] and TS 23.402 [4] in order to complete the
bearer establishment. In case of bearer deactivation, the PGW-C shall
request PGW-U to release F-TEIDu(s) for the bearer.


5.5  UE IP address management (allocation, renewal and release)

The UE IP address management includes allocation and release of the UE IP
address as well as renewal of the allocated IP address, where applicable.

The UE IP address management shall be performed by the PGW-C. As part of
this functionality, various UE IP address management mechanisms as defined
in 3GPP TS 23.401 [2] clause 5.3.1 are supported by the PGW-C. The PGW-C
shall process the UE IP address management related messages, maintain the
corresponding state information and provide the response messages to the
UE. In case the UE IP address is obtained from the external PDN,
additionally, the PGW-C shall also send the allocation, renewal and release
related request messages to the external PDN and maintain the corresponding
state information. The PGW-U shall support forwarding of the UE IP address
management related messages to the PGW-C, when they are received via the
user plane signalling from the UE or from the external PDN.

When PGW-C performs IPv4 address allocation via default bearer activation
and release via PDN connection release (3GPP TS 23.401 [2]
clause 5.3.1.2.1), no special functionality is required from the PGW-U.

For the other UE IP address management mechanisms, the UE sends the IP
address management related request messages via the user plane signalling.
Hence the PGW-U is required to forward these request messages to the PGW-C
for processing. Once these request messages are processed by the PGW-C, the
PGW-C sends response messages to the UE via the user plane signalling.
Hence the PGW-C is required to forward these response messages to the PGW-U
so that it can be relayed it to the UE. Correspondingly, following
functionality is required to be supported by the PGW-C and PGW-U:

  -  For IPv6 default prefix management via IPv6 stateless address
    autoconfiguration (3GPP TS 23.401 [2] clause 5.3.1.2.2): PGW-C shall
    configure PGW-U to forward Router Solicitation and Neighbor
    Solicitation messages from the UE to the PGW-C. The PGW-C shall forward
    Router Advertisement and Neighbor Advertisement messages to the PGW-U
    for relaying them to the UE.

  -  For IPv6 parameter configuration via stateless DHCPv6
    (3GPP TS 23.401 [2] clause 5.3.1.2.3): PGW-C shall configure PGW-U to
    forward all the DHCPv6 messages from the UE to the PGW-C. The PGW-C
    shall forward the DHCPv6 response messages to the PGW-U for relaying
    them to the UE.

  -  For IPv4 address management and parameter configuration DHCPv4
    (3GPP TS 23.401 [2] clause 5.3.1.2.4): PGW-C shall configure PGW-U to
    forward all the DHCPv4 messages from the UE to the PGW-C. The PGW-C
    shall forward the DHCPv4 response messages to PGW-U for relaying them
    to the UE.

  -  For IPv6 prefix management via IPv6 prefix delegation
    (3GPP TS 23.401 [2] clause 5.3.1.2.6): PGW-C shall configure PGW-U to
    forward all the DHCPv6 messages from the UE to the PGW-C. The PGW-C
    shall forward the DHCPv6 response messages to PGW-U for relaying them
    to the UE.

In addition to the above, when the UE IP address is obtained from the
external PDN, following functionality is required to be supported by the
PGW-C and PGW-U:

  -  For UE IP address from AAA server in the external PDN: If the AAA
    server in the external PDN is reachable only via the PGW-U the PGW-C
    shall configure the PGW-U to forward all the Diameter or RADIUS
    messages from the AAA server in the external PDN to the PGW-C. And the
    PGW-C shall forward the Diameter or RADIUS messages to the PGW-U for
    relaying them to the AAA server in the external PDN.

  -  For UE IP address from DHCPv4/v6 server in the external PDN: If the
    DHCPv4/v6 server in the external PDN is reachable only via the PGW-U
    the PGW-C shall configure the PGW-U to forward all the DHCPv4/v6
    messages from the DHCPv4/v6 server in the external PDN to the PGW-C.
    And the PGW-C shall forward the DHCPv4/v6 messages to the PGW-U for
    relaying them to the DHCPv4/v6 server in the external PDN.

  NOTE:  If the AAA server or the DHCPv4/v6 server in the external PDN is
         reachable directly, then the PGW-C communicates with it directly,
         without involving the PGW-U.


5.6  Control of user plane forwarding


5.6.1  General

One of the main tasks of the Sx interface is to enable the CP function to
instruct the UP function about how to forward user data traffic. There are
several different user plane forwarding scenarios supported. Some scenarios
are applicable to SGW only or PGW only, while other scenarios are
applicable to SGW and PGW or PGW and TDF. A non-exhaustive list of
forwarding scenarios is provided in Table 5.6.2-1 below.

The CP function shall be able to provide the UP with instructions for at
least the following behaviors: forward, forward with end marker. The CP
function shall also be able to request multiple sets of forwarding
instructions to be performed in sequence, e.g. forward to the DL side and
forward to the CP function for the purpose of duplication.


5.6.2  Control of user plane forwarding

The CP function controls user-plane packet forwarding for traffic detected
by a PDR by providing FAR(s) with instructions to the UP function,
including:

  -  Forwarding operation information;

  -  Forwarding target information.

The details of the forwarding target and operation will depend on the
scenario and is described in Table 5.6.2-1 below. The following forwarding
functionality is required by the UP function (more than one forwarding
scenario can be active for the same traffic):

  -  Apply GTP-U bearer related handling, i.e. encapsulation, de-
    capsulation or both. (This covers scenario 1 in the table below).

  -  Forward the traffic to the CP function (This covers scenario 2, 3, 4
    in the table below).

  -  Apply locally configured policy for traffic steering. (This covers
    scenario 5 in the table below).

Further details on the forwarding related information are provided in
clause 7.5.

        Table 5.6.2-1: Forwarding information for different scenarios

|   |Scenario description          |Forwarding target and       |Applicable  |
|   |                              |operation                   |to          |
|1  |Forwarding of user-plane      |GTP-U encapsulation         |SGW, PGW    |
|   |between UE and PDN, including |information (F-TEID)        |            |
|   |mapping onto GTP-U tunnels and|                            |            |
|   |mapping between GTP-U tunnels |                            |            |
|2  |Forwarding of user-plane      |Information that the CP     |PGW         |
|   |packets from UE and CP        |function is source/target   |            |
|   |function (e.g. RS/RA,         |(CP function IP address)    |            |
|   |DHCPv4/v6, traffic subject to |                            |            |
|   |HTTP redirect etc)            |                            |            |
|3  |Forwarding of packets from the|Information that the CP     |PGW         |
|   |external PDN / SGi and the CP |function is source/target   |            |
|   |function (e.g. for RADIUS,    |(CP function IP address)    |            |
|   |Diameter and DHCP signalling, |                            |            |
|   |traffic subject to HTTP       |                            |            |
|   |redirect etc)                 |                            |            |
|4  |Forwarding of packets subject |Information that the CP     |SGW         |
|   |to buffering in CP function   |function is source/target   |            |
|   |                              |(CP function IP address)    |            |
|5  |Forwarding of packets between |Reference to a predefined   |PGW, TDF    |
|   |the UP function and the       |traffic steering            |            |
|   |SGi-LAN for Flexible Mobile   |configuration (e.g.         |            |
|   |Service Chaining              |Traffic-Steering Policy     |            |
|   |                              |identifier)                 |            |



5.6.3  Format of forwarded user plane data

For forwarding between the CP function and UP function the user plane
packet is forwarded via an Sx-u tunnel by encapsulating the user-plane
packet using GTP-U protocol that allows the receiving entity to identify
which PDN Connection and which bearer the traffic belongs to. In the
direction from the CP function to UP function for forwarding towards the UE
or PDN, the UP encapsulation protocol also shall contain information that
allows the UP function to identify whether the UE or PDN is targeted.

  NOTE:  The Sx-u tunnel may be established per bearer of a PDN connection,
         or per PDN or per UP function. The details of Sx-u tunnel are
         defined in TS 29.244 [12].


5.7  UE's permanent identifier usage

For the scenarios requiring UE's permanent identity at the UP function,
e.g. UP function performing http header enrichment in a trusted
environment, the UE's permanent identity may be provided from the CP
function to the UP function in a container, instead of in an Sx parameter.

  NOTE:  In an untrusted environment in which the UE's permanent identity
         cannot be provided, due to e.g. to fulfil the privacy requirements,
         the session identifier is used between the CP function and UP
         function for correlating UE's session related events.


5.8  Functionality of sending of "end marker"

Sending of "end marker" is a functionality which involve SGW-C and SGW-U,
and PGW-C and PGW-U. As part of the functionality, constructing of end
marker packets can either be done in the CP function or in the UP function,
as described in clauses 5.8.1 and 5.8.2. Whether constructing of end marker
packets is performed by CP function or UP function is determined by network
configuration.


5.8.1  UP function constructing the "end marker" packets

In case of eNodeB relocation during handover procedure without SGW-U
change, SGW-C shall indicate the SGW-U to switch the S1 path(s) by sending
an Sx session modification request message with the new F-TEID-u of eNodeB
and in addition, provide an indication to the SGW-U to send the end marker
packet(s) on the old path.

On receiving this indication, the SGW-U shall construct end marker
packet(s) and send it for each S1 GTP-U tunnel towards the source eNodeB
after sending the last PDU on the old path.

In case of SGW-U relocation during handover procedure, PGW-C shall indicate
the PGW-U to switch the S5/S8 path(s) by sending an Sx session modification
request message (bearer ID, new F-TEID of SGW-U) and in addition, provide
an indication to the PGW-U to send the end marker packet(s) on the old
path.

On receiving this indication, the PGW-U shall construct end marker
packet(s) and send it for each S5/S8 GTP-U tunnel towards the source SGW-U
after sending the last PDU on the old path.

On receiving the end marker packet(s) on S5/S8 GTP-U tunnel, SGW-U shall
forward the end marker packet(s) and send it for each S1 GTP-U tunnel
towards the source eNodeB.


5.8.2  CP function constructing the "end marker" packets

In case of eNodeB relocation during handover procedure without SGW-U
change, SGW-C shall indicate the SGW-U to switch the S1 path(s) by sending
an Sx session modification request message (bearer ID, new F-TEID of
eNodeB). After sending the last PDU on the old path, SGW-U shall replace
the old F-TEID with the new one and responds with an Sx session
modification response message to acknowledge the success of path switch.

When the path switch is finished, SGW-C constructs the end marker packet(s)
and sends it to the SGW-U. SGW-U then forwards the packet(s) to the source
eNodeB.

In case of SGW-U relocation during handover procedure, PGW-C shall indicate
the PGW-U to switch the S5/S8 path(s) by sending an Sx session modification
request message (bearer ID, new F-TEID of SGW-U). After sending the last
PDU on the old S5/S8 path, PGW-U shall replace the old F-TEID with the new
one and responds with an Sx session modification response message to
acknowledge the success of path switch.

When the path switch is finished, PGW-C constructs the end marker packet(s)
and sends it to PGW-U. PGW-U then forwards the packet(s) to the source SGW-
U.


5.9  Idle state packet SGW buffering function


5.9.1  General

Buffering of the UE's data packets for the UE in idle or power saving mode
can be performed in SGW-U or SGW-C.

The support of buffering in the SGW-U is mandatory and the SGW-C shall
support buffering by the SGW-U.

The support of buffering in the SGW-C is optional and the SGW-U optionally
supports buffering by the SGW-C. An exception is that in a dedicated core
network serving UEs which may enter power saving mode or apply eDRX, e.g.
NB-IoT UEs, the SGW-C shall support buffering capability.

When buffering is supported in both SGW-C and SGW-U, the SGW-C decides on a
per UE session basis (e.g. based on local configuration and other
information such as UE capability) to perform buffering in either the SGW-C
or the SGW-U.


5.9.2  Buffering in CP function

When the UE moves to ECM-IDLE state, if the SGW-C supports buffering
capability and decides to activate buffering, the SGW-C shall inform the
SGW-U to stop sending data packets to eNodeB and start forwarding the
downlink data packets towards the SGW-C.

When the UE transition to the ECM-CONNECTED state, the SGW-C shall update
the SGW-U via Sxa interface with the F-TEIDu of the eNodeB. If there are
buffered packets available and their buffering duration has not expired,
the SGW-C shall forward those packets to the SGW-U outside of the control
plane signalling (see clause 5.6.3 "Format of forwarded user plane data")
to relay them to the UE. These packets are then forwarded by the SGW-U to
the eNodeB.


5.9.3  Buffering in UP function


5.9.3.1  General

The SGW-C shall be able to provide the SGW-U with instructions for at least
the following behaviors: buffer without reporting the arrival of first
downlink packet, buffer with reporting the arrival of first downlink
packet, drop packets.

When the UE moves to ECM-IDLE state, if the SGW-C does not support
buffering capability, or if the SGW-C supports buffering capability and
decides to activate buffering in SGW-U for the session, the SGW-C shall
inform the SGW-U, via an Sx session modification. The SGW-C decides whether
buffering timers are handled by the SGW-U or by the SGW-C. The activation
of buffering implicitly stops sending data to the eNodeB/RNC/SGSN.

After starting the buffering, when the first downlink packet arrives on any
bearer, SGW-U shall inform the SGW-C. SGW-U sends an Sx reporting message
to the SGW-C unless specified otherwise and identifies the S5/S8 bearer on
which the downlink packet was received.

On receiving this reporting message, the SGW-C decides whether to send a
Downlink Data Notification message to the MME as defined in TS 23.401 [2].

At the UE transition to ECM-CONNECTED state, the SGW-C shall update the SGW-
U via Sxa interface with the F-TEIDu of the eNodeB/RNC/SGSN. The buffered
data packets, if any, are then forwarded to the eNodeB/RNC/SGSN by the SGW-
U.

In case of SGW-U relocation, buffered data packets are transferred from the
old SGW-U to the new SGW-U.


5.9.3.2  Delay Downlink Packet Notification

According to clause 5.3.4.2 of TS 23.401 [2], the MME/SGSN may inform the
SGW that for all UEs served by the MME/SGSN, the Downlink Packet Data
Notification shall be delayed for a period D.

If the parameter D is handled by the SGW-U, the SGW-C shall include the
parameter D in the Sx session establishment for new Sx sessions, in the Sx
session modification for Sx sessions which are not in buffering state (when
transitioning these sessions to the buffering state), and in the next Sx
report ack message for Sx sessions already in buffering state. The SGW-U
shall then delay the sending of subsequent Sx reporting upon next DL data
arrival.

If the parameter D is handled by the SGW-C, there is no special handling
compared to clause 5.9.3.1. When the SGW-U reports the arrival of a DL data
packet, the SGW-C shall delay the sending of the Downlink Data Notification
to the MME by parameter D delay.


5.9.3.3  Extended buffering

According to clauses 5.3.4.3 and 5.7.3 of TS 23.401 [2], the MME/SGSN
invoking extended buffering indicates it to the Serving GW in the Downlink
Data Notification Ack message, includes a DL Buffering Duration time and
optionally a DL Buffering Suggested Packet Count.

If the MME/SGSN included the DL Suggested Packet Count, the SGW-C shall
include the DL Suggested Packet Count in the Sx reporting Ack message.

If the DL Data Buffer Expiration Time is handled by the SGW-U, the SGW-C
includes it in the Sx reporting Ack message and requests the SGW-U to
buffer DL data packets. When the SGW-U receives the DL Data Buffer
Expiration Time, the SGW-U buffers the DL data packets without reporting
the arrival of the first DL data packet until the DL Data Buffer Expiration
Time expires. When the DL Data Buffer Expiration Time expires, the SGW-U
shall discard the buffered DL packets and shall restart buffering DL data
packets with reporting the arrival of the first DL data packet.

If the DL Data Buffer Expiration Time is handled by the SGW-C, the SGW-C
requests the SGW-U to buffer the DL data packets without reporting the
arrival of the first DL data packet. When the DL Data Buffer Expiration
Time expires, the SGW-C requests the SGW-U to drop the buffered data
packets and to start buffering the DL data packets with reporting of the
arrival of the first DL data packet, via an Sx Session Modification.

If the DL Suggested Packet Count was included in the request from the SGW-
C, the SGW-U buffers the DL data packets up to the number of packets
indicated by the DL Suggested Packet Count.


5.9.3.4  Throttling

According to clause 4.3.7.4.1a of TS 23.401 [2], the MME/SGSN can request
the SGWs to selectively reduce the number of Downlink Data Notification
requests it sends for downlink non-priority traffic received for UEs in
idle mode according to a throttling factor and for a throttling delay
specified in the Downlink Data Notification Ack message.

Throttling mechanism by which the MME uses Downlink Data Notification
Acknowledgement messages DL low priority traffic Throttling parameters, is
handled by the SGW-C as follows:

  -  On receiving Downlink Data Notification Acknowledgement from the
    MME/SGSN, the SGW-C determines which bearers are subject to the
    throttling of Downlink Data Notification requests on the basis of the
    bearer's ARP priority level and the operator policy.

  -  Upon receipt of an Sx report notifying the arrival of DL data packets
    on those bearers, the SGW-C decides whether or not to send a DDN to MME
    based on the requested throttling factor. The SGW-C may indicate in the
    Sx Report Ack whether SGW-U shall discard the buffered packet and may
    also indicate whether SGW-U shall notify when additional DL packets
    arrive.

  -  The throttling delay timer and throttling factor are handled by the
    SGW-C and not provided to SGW-U.


5.10 Bearer and APN policing

ARP is used for admission control (i.e. retention and pre-emption of the
bearer). The value of ARP is not required to be provided to the UP
function.

For every bearer, SGW-C/PGW-C shall use the QCI and optionally, the ARP
priority level, to determine the transport level packet marking and provide
the transport level packet marking to the SGW-U/PGW-U.

PGW-C shall provide the APN-AMBR value together with a QoS Enforcement Rule
correlation ID (as described in clause 7.6) to PGW-U so that the PGW-U can
enforce the APN-AMBR across all IP-CAN sessions of the UE to the same APN
at the PGW-U.

SGW-C/PGW-C shall provide the GBR and MBR value for each GBR bearer of the
PDN connection to the SGW-U/PGW-U. When the Gn/Gp interface is used by the
PGW-U, PGW-C shall also provide the MBR value to the PGW-U for each non-GBR
bearer of the PDN connection on the Gn/Gp interface.

TDF-C shall provide the TDF session MBR value to TDF-U to be applied to the
TDF session of the UE.


5.11 PCC/ADC related functions


5.11.1 Activation/Deactivation of predefined PCC/ADC rules

A predefined PCC/ADC rule is configured in the CP function.

The traffic detection filters required in the UP function can be configured
either in the CP function and provided to the UP function, as service data
flow filter(s), or be configured in the UP function, as the application
detection filter identified by an application identifier. For the latter
case, the application identifier has to be configured in the CP function
and the UP function.

The traffic steering policy information can be only configured in the UP
function, together with traffic steering policy identifier(s), while the CP
function has to be configured with the traffic steering policy
identifier(s).

Policies for traffic handling in the UP function, which are referred by
some identifiers corresponding to the parameters of a PCC/ADC rule, can be
configured in the UP function. These traffic handling policies are
configured as predefined QER(s), FAR(s) and URR(s).

When a predefined PCC/ADC rule is activated/deactivated by the PCRF, PGW-
C/TDF-C shall decide what information has to be provided to the PGW-U/TDF-U
to enforce the rule based on where the traffic detection filters (i.e.
service data flow filter(s) or application detection filter), traffic
steering policy information and the policies used for the traffic handling
in the UP function are configured and where they are enforced:

  -  If the predefined PCC/ADC rule contains an application identifier for
    which corresponding application detection filters are configured in the
    UP function, the PGW-C/TDF-C shall provide a corresponding application
    identifier to the UP function;

  -  If the predefined PCC/ADC rule contains traffic steering policy
    identifier(s), the PGW-C/TDF-C shall provide a corresponding traffic
    steering policy identifier(s) to the UP function;

  -  If the predefined PCC/ADC rule contains service data flow filter(s),
    the PGW-C/TDF-C shall provide them to the PGW-U/TDF-U;

  -  If the predefined PCC/ADC rule contains some parameters for which
    corresponding policies for traffic handling in the UP function are
    configured in the UP function, the PGW-C/TDF-C shall activate those
    traffic handling policies via their rule ID(s).

The CP function shall maintain the mapping between a PCC/ADC rule received
over Gx/Sd and the flow level PDR rule(s) used on Sx.


5.11.2 Enforcement of dynamic PCC/ADC rules

The application detection filters required in the UP function can be
configured either in the CP function and provided to the UP function as the
service data flow filter, or be configured in the UP function identified by
an application identifier.

When receiving a dynamic PCC/ADC rule from the PCRF which contains an
application identifier and/or parameters for traffic handling in the UP
function:

  -  if the application detection filter is configured in the PGW-C/TDF-C,
    the PGW-C/TDF-C shall provide it in the service data flow filter to the
    UP function, as well as parameters for traffic handling in the UP
    function received from the dynamic PCC/ADC rule;

  -  otherwise, the application detection filters is configured in UP
    function, the PGW-C/TDF-C shall provide to PGW-U/TDF-U with the
    application identifier and the parameters for traffic handling in the
    UP function as required based on the dynamic PCC/ADC rule.

The CP function shall maintain the mapping between a PCC/ADC rule received
over Gx/Sd and the flow level PDR(s) used on Sx.


5.11.3 Redirection

The uplink application's traffic redirection may be enforced either in the
PGW-C/TDF-C (as specified in 5.4.2 Control of user plane forwarding) or
directly in the UP function. The redirect destination may be provided in
the dynamic PCC/ADC rule or be preconfigured, either in the CP function or
in the UP function.

When receiving redirect information (redirection enabled/disabled and
redirect destination) within a dynamic PCC/ADC rule or being
activated/deactivated by the PCRF for the predefined redirection policies,
PGW-C/TDF-C shall decide whether to provide and what information to be
provided to the UP function based on where the redirection is enforced and
where the redirect destination is acquired/preconfigured. When redirection
is enforced in the UP function and the redirect destination is acquired
from the dynamic PCC/ACD rule or is configured in the CP function, CP
function shall provide the redirect destination to the UP function. When
redirection is enforced in the CP function, CP function shall instruct the
UP function to forward applicable user plane traffic to the CP function.


5.11.4 Support of SDCI

PFDF shall provide PFD(s) to the PGW-C/TDF-C on the request of PGW-C/TDF-C
(pull mode) or on the request of PFD management from SCEF (push mode), as
described in TS 23.203 [3]. The PGW-C/TDF-C shall provide the PFD(s) to the
PGW-U/TDF-U, on which the Application ID corresponding to the PFD(s) is
active.

The PGW-C/TDF-C supports the procedures for Gw/Gwn as specified in
TS 23.203 [3], for management of PFDs. PFD(s) is cached in the PGW-C/TDF-C,
and the PGW-C/TDF-C maintains a caching timer associated to the PFD(s).
When the caching timer expires and there's no active PCC/ADC rule that
refers to the corresponding application identifier, the PGW-C/TDF-C informs
the PGW-U/TDF-U to remove the PFD(s) identified by the application
identifier using the PFD management message.

When a PDR is provided for an Application ID corresponding to the PFD(s)
that are not already provided to the PGW-U/TDF-U, the PGW-C/TDF-C shall
provide the PFD(s) to the PGW-U/TDF-U (if there are no PFD(s) cached, the
PGW-C/TDF-C retrieves them from the PFDF as specified in TS 23.203 [3]).
When any update of the PFD(s) is received from PFDF by PGW-C/TDF-C (using
"push" or "pull" mode), and there are still active PDRs in PGW-U/TDF-U for
the Application ID, the PGW-C/TDF-C shall provision the updated PFD set
corresponding to the Application ID to the PGW-U/TDF-U using the PFD
management message.

  NOTE 1:  PGW-C/TDF-C should assure not to overload Sx signalling while
         managing PFD(s) to the UP function, e.g. forwarding the PFD(s) to
         the right UP function where the PFD(s) is enforced.

When the PGW-U/TDF-U receives the updated PFD(s) from either the same or
different PGW-C/TDF-C for the same application identifier, the latest
received PFD(s) shall overwrite any existing PFD(s) stored in the UP
function.

  NOTE 2:  For the case a single UP function is controlled by multiple CP
         functions, the conflict of PFD(s) corresponding to the same
         application identifier provided by different CP functions should be
         avoided by operator enforcing a well-planned PFDF and CP/UP
         function deployment.


5.12 User Plane function selection


5.12.1 General

The selection of the UP function (SGW-U, PGW-U, TDF-U, combined SGW/PGW-U)
is performed by its respective CP function (SGW-C, PGW-C, TDF-C, combined
SGW/PGW-C).

The UP function's capabilities shall be signalled during the initial
connection establishment between the CP function and the UP function.

The CP function shall be made dynamically aware on the UP function load and
relative static capacity for which it has an established Sx session as
specified in the clauses below.

The exact set of parameters used for the selection mechanism is deployment
specific and controlled by the operator configuration, e.g. UE capabilities
such as the UE support for dual connectivity with NR, and, the UE's
location information may be used for selecting UP function in some
deployments while may not be used in other deployments.


5.12.2 Selection of PGW-U

For PGW-U selection, the PGW-C shall be able to consider the following
parameters:

  -  the PGW-U's dynamic load, at the node level (the PGW-C may then derive
    the load at the APN level);

  -  the PGW-U's relative static capacity (among PGW-Us supporting the same
    APN);

  -  the PGW-U location configured in the PGW-C and the UE location
    information provided by the MME/SGSN in order to select the appropriate
    PGW-U, e.g. for SIPTO above RAN service;

  -  the capability of the UP function and the functionality required for
    the particular UE session: An appropriate UP function can be selected
    by matching the functionality and features required for an UE (which
    can be derived from the information received over S11/S4/S5/S8 (e.g.
    APN, mapped UE Usage Type, UE location information, UE capabilities
    (e.g. UE support for dual connectivity with NR)) or from the PCRF (e.g.
    need to perform DPI)) with the capabilities of the UP function so as to
    fulfil the service for the UE, e.g. if L7 based traffic detection is
    needed then an UP function supporting corresponding functionality needs
    to be selected.

  -  to enable APN-AMBR enforcement, whether a PDN connection already
    exists for the same UE and APN, in which case the same PGW-U shall be
    selected;

The criteria for PGW-U selection may include load balancing between PGW-Us.

The PGW-C may support the Sx Load Control feature.

In order to allow the PGW-C to select a PGW-U according to above
parameters:

  -  the SGW-C shall provide the relevant UE's capabilities when available
    (e.g. UE support for dual connectivity with NR) over the S5/S8
    interface.

  -  the SGW-C may provide the mapped UE Usage Type over the S5 interface.


5.12.3 Selection of SGW-U

For SGW-U selection, the SGW-C shall be able to consider the following
parameters:

  -  the SGW-U location (e.g. SGW Service Area) and the UE location
    information, provided by the MME/SGSN in order to select a UP function
    close to the UE's point of attachment;

  -  the SGW-U's dynamic load;

  -  the SGW-U's relative static capacity (versus other SGW-Us);

  -  the capability of the UP function and the functionality required for
    the particular UE session: An appropriate UP function can be selected
    by matching the functionalities and features required for an UE (which
    can be derived from the information received over S11/S4 (e.g.
    individual CIoT capabilities, UE Usage Type, the APN (for selection of
    combined SGW/PGW), UE capabilities (e.g. UE support for dual
    connectivity with NR)) with the capabilities of the UP function so as
    to fulfil the service requirement for the UE then a UP function
    supporting corresponding functionality needs to be selected.

The criteria for SGW-U selection may include load balancing between SGW-Us.

The SGW-C may support the Sx Load Control feature.

In order to allow the SGW-C to select a SGW-U according to the above
parameters:

  -  the MME/SGSN shall provide the location of the UE (i.e. ECGI, eNB or
    TAI for E-UTRAN, and RAI or RNC-ID for UTRAN), the APN (for selection
    of a combined SGW/PGW), relevant UE capabilities when available (e.g.
    UE support for dual connectivity with NR) and may provide the mapped UE
    Usage Type in the Create Session Request over the S11/S4 interface;

  NOTE:  MME sets the UE support for dual connectivity with NR indication
         when the UE indicates support for NR and there is no Access
         Restriction for NR for the UE (see TS 23.401 [2] clause 4.3.2a).


5.12.4 Selection of a combined SGW/PGW-U

A combined SGW/PGW-C selects the SGW-U and PGW-U as defined respectively in
clauses 5.12.3 and 5.12.4, with the following addition:

  -  The SGW-C determines that it is a combined SGW/PGW-C entity the same
    way as in the non-split case;

  -  The combined SGW/PGW-C may optimize UP function selection by selecting
    the best couple of SGW-U and PGW-U for the requested APN, among all
    candidate couples of (SGW-U, PGW-U), instead of selecting independently
    the SGW-U first and then the PGW-U (which may result in selecting non-
    co-located SGW-U and PGW-U).


5.12.5 Selection of TDF-U


5.12.5.1 Solicited application reporting mode

TDF-C shall select TDF-U at PDN connection establishment (TDF session
establishment).

The selection may be based on the following parameters:

  -  the TDF-U's dynamic load;

  -  the TDF-U's relative static capacity;

  -  the capability of the UP function and the functionalities and the
    capabilities required for the particular UE session: An appropriate UP
    function can be selected by matching the functionalities and features
    required for the UE from the PCRF.

The criteria for TDF-U selection includes load balancing between TDF-Us.

The TDF-C may support the Sx Load Control feature.


5.12.5.2 Unsolicited application reporting mode

The selection of TDF-U for the unsolicited application reporting is
performed by TDF-C during the Sx management procedure, using the
information configured in TDF-C.

  NOTE:  TDF-C provides the instructions for application detection and
         reporting to the TDF-U during the Sx session management procedure.
         TDF-U shall communicate with the TDF-C (using the same Sx session)
         when application reporting is necessary, based on instructions
         provided by TDF-C.


6  Information flows

  Editor's note:  This clause will document the Sx information flows and
         their usage for the various existing procedures.


6.1  General

This clause defines the procedures that are used for the interaction
between SGW-C and SGW-U, PGW-C and PGW-U, TDF-C and TDF-U, and documents
how these procedures shall be embedded into existing procedures of
TS 23.401 [2], TS 23.402 [4], TS 23.060 [5] and TS 23.203 [3].

  NOTE:  TS 23.401 [2], TS 23.402 [4], TS 23.060 [5] and TS 23.203 [3] do
         not reflect control and user plane separation of SGW, PGW or TDF
         and thus the procedures in these specifications do not show the
         interaction between the respective CP function and UP function. In
         case of any discrepancies, the procedures defined in TS 23.401 [2],
         TS 23.402 [4], TS 23.060 [5] and TS 23.203 [3] apply.


6.2  Sx Session Management Procedures


6.2.1  General

Sx session management procedures are used to control the functionality of
the UP function, which involve SGW, PGW or TDF. The CP function can create,
update and remove the Sx session context (i.e. the parameters related to a
PDN connection, IP-CAN session, TDF session or TDF in unsolicited reporting
mode) in the UP function.

The following Sx session management procedures exist: Sx session
establishment procedure, Sx session modification procedure and Sx session
termination procedure. All of them are initiated by the CP function.


6.2.2  Sx Session Establishment Procedure

The Sx session establishment procedure is used to create the initial Sx
session context for a PDN connection, IP-CAN session, TDF session or TDF in
unsolicited reporting mode at the UP function. The CP function assigns a
new Session ID and provids it to the UP function. The Session ID is stored
by both entities and used to identify the Sx session context during their
interaction. The CP function stores also the relation between the Session
ID and PDN connection, IP-CAN session, TDF session or TDF in unsolicited
reporting mode and can then correlate events reported by the UP function to
them.

During PDN connection establishment, the Sx session establishment procedure
is executed between SGW-C and SGW-U as well as PGW-C and PGW-U. The Sx
session context comprises the parameters for the default as well as every
dedicated bearer of the PDN connection. In addition, the Sx session context
for the PGW-U comprises IP-CAN session related parameters.

During SGW-U relocation, the Sx session establishment procedure is executed
between SGW-C and the target SGW-U. The Sx session context comprises the
parameters for the default as well as every dedicated bearer of the PDN
connection.

During TDF session establishment, the Sx session establishment procedure is
executed between TDF-C and TDF-U. The Sx session context comprises TDF
session related parameters.

For a TDF in unsolicited reporting mode, the Sx session establishment
procedure is executed between TDF-C and the TDF-U selected during Sx
management procedure. The Sx session context comprises the instructions for
application detection and reporting in unsolicited reporting mode.

                                    [pic]

              Figure 6.2.2-1 Sx session establishment procedure

  NOTE:  In case of a TDF in unsolicited reporting mode, the procedure is
         triggered by TDF configuration and step 1 and 4 do not apply.

  1. CP function receives the trigger to establish a new PDN connection or
    TDF session from a peer CP function, an MME or a PCRF.

  2. The CP function sends an Sx session establishment request message to
    the UP function that contains the structured control information which
    defines how the UP function needs to behave.

  3. The UP function responds with an Sx session establishment response
    message containing any information that the UP function has to provide
    to the CP function in response to the control information received.

  4. The CP function interacts with the network entity which triggered this
    procedure (e.g. a peer CP function, an MME or a PCRF).


6.2.3  Sx Session Modification Procedure

The Sx session modification procedure is used to update the Sx session
context of an existing PDN connection, IP-CAN session, TDF session or TDF
in unsolicited reporting mode at the UP function.

The Sx session modification procedure is executed between SGW-C and SGW-U
whenever PDN connection related parameters have to be modified, as well as
between PGW-C and PGW-U whenever PDN connection or IP-CAN session related
parameters have to be modified.

The Sx session modification procedure is executed between TDF-C and TDF-U
whenever TDF session related parameters have to be modified.

For a TDF in unsolicited reporting mode, the Sx session modification
procedure is executed between TDF-C and TDF-U whenever instructions for
application detection and reporting have to be modified.

                                    [pic]

              Figure 6.2.3-1 Sx session modification procedure

  NOTE:  In case of a TDF in unsolicited reporting mode, the procedure is
         triggered by TDF configuration and step 1 and 4 do not apply.

  1. CP function receives the trigger to modify the existing PDN connection
    or TDF session from a peer CP function, an MME or a PCRF.

  2. The CP function sends an Sx session modification request message to
    the UP function that contains the update for the structured control
    information which defines how the UP function needs to behave.

  3. The UP function identifies the Sx session context to be modified by
    the Session ID. Then, the UP function updates the parameters of this Sx
    session context according to the list of parameters sent by the CP
    function. The UP function responds with an Sx session modification
    response message containing any information that the UP function has to
    provide to the CP function in response to the control information
    received.

  4. The CP function interacts with the network entity which triggered this
    procedure (e.g. a peer CP function, an MME or a PCRF).


6.2.4  Sx Session Termination Procedure

The Sx session termination procedure is used to remove the Sx session
context of an existing PDN connection, IP-CAN session, TDF session or TDF
in unsolicited reporting mode at the UP function.

                                    [pic]

               Figure 6.2.4-1 Sx session termination procedure

  NOTE:  In case of a TDF in unsolicited reporting mode, the procedure is
         triggered by TDF configuration and step 1 and 4 do not apply.

  1. CP function receives the trigger to terminate the existing PDN
    connection or TDF session from a peer CP function, an MME or a PCRF.

  2. The CP function sends an Sx session termination request message to the
    UP function.

  3. The UP function identifies the Sx session context to be terminated by
    the Session ID and removes the whole session context. The UP function
    responds with an Sx session termination response message containing any
    information that the UP function has to provide to the CP function.

  4. The CP function interacts with the network entity which triggered this
    procedure (e.g. a peer CP function, an MME or a PCRF).


6.3  Updates to procedures in other specifications


6.3.1  Updates to procedures specified in TS 23.401


6.3.1.1  Procedures with PDN connection establishment

This clause defines interactions between the CP and UP function during the
following procedures:

  -  E-UTRAN initial attach (TS 23.401 [2] clause 5.3.2.1)

  -  UE requested PDN connectivity (TS 23.401 [2] clause 5.10.2)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The new SGW-C selects a new SGW-U and creates an Sx session.

  -  The new PGW-C selects a new PGW-U and creates an Sx session.

  -  The old SGW-C releases the existing Sx session from the old SGW-U.

  -  The old PGW-C releases the existing Sx session from the old PGW-U.

  -  The SGW-C modifies the SGW-U to update with the F-TEIDu of the eNodeB
    and the PGW-U.

                                    [pic]

     Figure 6.3.1.1-1: Interaction between CP and UP function during PDN
                          connection establishment

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2a.  The SGW-C may send an Sx Session Termination Request to the SGW-U to
    release the Sx session.

  2b.  The SGW-U sends an Sx Session Termination Response to the SGW-C
    confirming the release of the Sx session.

  3a.  The PGW-C may send an Sx Session Termination Request to the PGW-U to
    release the Sx session.

  3b.  The PGW-U sends an Sx Session Termination Response to the PGW-C
    confirming the release of the Sx session.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.

  5a.  The SGW-C may send an Sx Session Termination Request to the SGW-U to
    release the Sx session.

  5b.  The SGW-U sends an Sx Session Termination Response to the SGW-C
    confirming the release of the Sx session.

  6a.  The PGW-C may send an Sx Session Termination Request to the PGW-U to
    release the Sx session.

  6b.  The PGW-U sends an Sx Session Termination Response to the PGW-C
    confirming the release of the Sx session.

  7. The relevant steps of the procedure as specified in the figure above
    are executed.

  8a.  The SGW-C shall select new SGW-U as specified in clause 5.12. If the
    network is configured to perform F-TEIDu allocation in the CP function
    then SGW-C allocates F-TEIDu for the default bearer. Then the SGW-C
    sends an Sx Session Establishment Request to the selected SGW-U for
    creating an Sx session for the UE. The F-TEIDu for the default bearer
    shall be included if the SGW-C has allocated the same.

  8b.  If the network is configured to perform F-TEIDu allocation in the UP
    function, the SGW-U allocates F-TEIDu for the bearer. The SGW-U sends
    an Sx Session Establishment Response to the SGW-C confirming the
    successful creation of the Sx session. It shall include the F-TEIDu for
    the bearer if it has allocated the same.

  9. The relevant steps of the procedure as specified in the figure above
    are executed.

  10a. The PGW-C shall select new PGW-U as specified in clause 5.12. If the
    network is configured to perform F-TEIDu allocation in the CP function
    then PGW-C allocates F-TEIDu for the default bearer. Then the PGW-C
    sends an Sx Session Establishment Request to the selected PGW-U for
    creating an Sx session for the UE. The PGW-C shall include the F-TEIDu
    of the default bearer received from the SGW. The F-TEIDu for the
    default bearer shall be included if the PGW-C has allocated the same.

  10b. If the network is configured to perform F-TEIDu allocation in the UP
    function, the PGW-U allocates F-TEIDu for the bearer. The PGW-U sends
    an Sx Session Establishment Response to the PGW-C confirming the
    successful creation of the Sx session. It shall include the F-TEIDu for
    the bearer if it has allocated the same.

  11.  The relevant steps of the procedure as specified in the figure above
    are executed.

  12a. The SGW-C sends Session Modification Request to the SGW-U. The SGW-C
    shall include the F-TEIDu of the default bearer received from the PGW.

  12b. The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the success of the Sx session modification.

  13.  The relevant steps of the procedure as specified in the figure above
    are executed.

  14a. The SGW-C sends an Sx Session Modification Request to the SGW-U. The
    SGW-C shall include the F-TEIDu of the default bearer received from the
    eNodeB.

  14b. The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the success of the Sx session modification.

  15.  The relevant steps of the procedure as specified in the figure above
    are executed.

  16a. If the Handover Indication is included in step 15, the PGW-C updates
    the old PGW-U session corresponding to the non-3GPP access by sending
    "Sx session modification request" message to the PGW-U (session ID) and
    instructs the PGW-U to start routing the downlink packets to the
    SGW/SGW-U.

  16b. The PGW-U sends "Sx session modification response" message to the
    PGW-C.

  17.  The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.1.2  Procedures with SGW change


6.3.1.2.1   General

This clause covers the following two types of procedures involving SGW
change:

  -  Type 1: Procedures in which only Create Session Request message is
    sent from MME/SGSN to SGW-C during SGW change.

  -  Type 2: Procedures in which Create Session Request message followed by
    Modify Bearer Request message are sent from MME/SGSN to SGW-C during
    SGW change.


6.3.1.2.2   Type 1

This clause defines interactions between the CP and UP function during the
following procedures:

  -  Tracking Area Update procedure with Serving GW change (TS 23.401 [2]
    clause 5.3.3.1)

  -  Routing Area Update with MME interaction and with SGW change
    (TS 23.401 [2] clause 5.3.3.6)

  -  X2-based handover with Serving GW relocation (TS 23.401 [2]
    clause 5.5.1.1.3)

  -  MME triggered Serving GW relocation (TS 23.401 [2] clause 5.10.4)

  Editor's Note: "Tracking Area Update procedure with Serving GW change and
         data forwarding" (TS 23.401 [2] clause 5.3.3.1A) is FFS.

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The new SGW-C selects a new SGW-U and creates an Sx session

  -  The PGW-C modifies the PGW-U to update with the F-TEIDu(s) of the new
    SGW-U

  -  The old SGW-C releases the existing Sx session from the old SGW-U

                                    [pic]

      Figure 6.3.1.2.2-1: Interaction between CP and UP function during
                     procedures with SGW change (Type 1)

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The new SGW-C shall select new SGW-U as specified in clause 5.12. If
    the network is configured to perform F-TEIDu allocation in the CP
    function then SGW-C allocates an F-TEIDu for each and every bearer.
    Then the new SGW-C sends Sx Session Establishment Request to the
    selected SGW-U for creating an Sx session for the UE. Additionally, an
    F-TEIDu for each and every bearer shall be included if the SGW-C has
    allocated the same.

  3. If the network is configured to perform F-TEIDu allocation in the UP
    function, the SGW-U allocates an F-TEIDu for each and every bearer
    received. The new SGW-U sends Sx Session Establishment Response to the
    new SGW-C confirming the successful creation of the Sx session. It
    shall include the F-TEIDu for each and every bearer if it has allocated
    the same.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.

  5. The PGW-C sends an Sx Session Modification Request to the PGW-U. The
    PGW-C shall include the F-TEIDu(s) of the new SGW-U. Additionally,
    based on the interaction with the PCRF, the PGW-C may also update other
    Sx parameters for the PDN connection.

  6. The PGW-U sends Sx Session Modification Response to the PGW-C
    confirming the success of the Sx session modification.

  7. The relevant steps of the procedure as specified in the figure above
    are executed.

  8. The old SGW-C sends Sx Session Release Request to the old SGW-U to
    release the Sx session.

  9. The old SGW-U sends Sx Session Release Response to the old SGW-C
    confirming the release of the Sx session.

  10.  The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.1.2.3   Type 2

This clause defines interactions between the CP and UP function during the
following procedures:

  -  S1-based handover, normal (TS 23.401 [2] clause 5.5.1.2.2)

  -  E-UTRAN to UTRAN Iu mode Inter RAT handover (TS 23.401 [2]
    clause 5.5.2.1)

  -  UTRAN Iu mode to E-UTRAN Inter RAT handover (TS 23.401 [2]
    clause 5.5.2.2)

  -  E-UTRAN to GERAN A/Gb mode Inter RAT handover (TS 23.401 [2]
    clause 5.5.2.3)

  -  GERAN A/Gb mode to E-UTRAN Inter RAT handover (TS 23.401 [2]
    clause 5.5.2.4)

  Editor's Note: Most of the above procedures involve establishment and
         release of indirect data forwarding tunnel at the source and the
         target SGW. It is FFS if this needs to be supported in the CP and
         UP split architecture.

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The new SGW-C selects a new SGW-U and creates an Sx session.

  -  The SGW-C modifies the Sx session at SGW-U to update the F-TEIDu(s) of
    the eNB.

  -  The PGW-C modifies the PGW-U to update with the F-TEIDu(s) of the new
    SGW-U.

  -  The old SGW-C releases the existing Sx session from the old SGW-U.

                                    [pic]

      Figure 6.3.1.2.3-1: Interaction between CP and UP function during
                     procedures with SGW change (Type 2)

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The new SGW-C shall select new SGW-U as specified in clause 5.12. If
    the network is configured to perform F-TEIDu allocation in the CP
    function then SGW-C allocates F-TEIDu for each and every bearer. Then
    the new SGW-C sends an Sx Session Establishment Request to the selected
    SGW-U for creating an Sx session for the UE. Additionally, F-TEIDu for
    each and every bearer shall be included if the SGW-C has allocated the
    same. The Usage Monitoring Rules may also be included in case of home-
    routed roaming scenario and if the inter-operator charging is required.

  3. If the network is configured to perform F-TEIDu allocation in the UP
    function, the SGW-U allocates F-TEIDu for each and every bearer
    received. The new SGW-U sends an Sx Session Establishment Response to
    the new SGW-C confirming the successful creation of the Sx session. It
    shall include the F-TEIDu for each and every bearer if it has allocated
    the same.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.

  5. The SGW-C sends an Sx Session Modification Request to the SGW-U. It
    shall include the F-TEIDu of the eNB.

  6. The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the successful modification of the Sx session.

  7. The relevant steps of the procedure as specified in the figure above
    are executed.

  8. The PGW-C sends an Sx Session Modification Request to the PGW-U. The
    PGW-C shall include the F-TEIDu of the new SGW-U. Additionally, based
    on the interaction with the PCRF, the PGW-C may also update other Sx
    parameters for the PDN connection.

  9. The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the success of the Sx session modification.

  10.  The relevant steps of the procedure as specified in the figure above
    are executed.

  11.  The old SGW-C sends an Sx Session Release Request to the old SGW-U
    to release the Sx session.

  12.  The old SGW-U sends an Sx Session Release Response to the old SGW-C
    confirming the release of the Sx session.

  13.  The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.1.3  Procedures with eNB F-TEIDu update

In this clause, interactions between the CP and UP function during the
following procedures are considered:

  -  UE triggered Service Request (TS 23.401 [2] clause 5.3.4.1).

  -  Connection Resume procedure (TS 23.401 [2] clause 5.3.5A).

  -  E-UTRAN initiated E-RAB modification procedure (TS 23.401 [2]
    clause 5.4.7).

  -  X2-based handover without Serving GW relocation (TS 23.401 [2]
    clause 5.5.1.1.2).

  -  S1-based handover without Serving GW change (TS 23.401 [2]
    clause 5.5.1.2.2).

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The SGW-C modifies the Sx session at SGW-U to update the F-TEIDu(s) of
    the eNB.

  -  Based on the interaction with the PCRF, the PGW-C may modify the PGW-U
    to update other Sx parameters.

                                    [pic]

 Figure 6.3.1.3-1: Interaction between CP and UP function during procedures
                           with eNB F-TEIDu update

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The SGW-C sends an Sx Session Modification Request to the SGW-U. It
    shall include the new F-TEIDu of the eNB. Additionally, for the
    following procedures extra steps may apply:

    -  UE triggered Service Request: If the buffering of the data packets
       in the idle mode is performed in the SGW-C and if those buffered
       packets are still valid (e.g. data packets for which the buffering
       duration hasn't expired yet), then SGW-C shall also provide those
       data packets to the SGW-U (as specified in clause 5.12) so that it
       can be sent to the eNB.

  3. The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the successful modification of the Sx session.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.

  5. Based on the interaction with the PCRF, the PGW-C may update other Sx
    parameters for the PDN connection. Correspondingly, the PGW-C sends an
    Sx Session Modification Request to the PGW-U.

  6. The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the success of the Sx session modification.

  7. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.1.4  Procedures with release of eNB F-TEIDu

This clause defines interactions between the CP and UP function during the
following procedures:

  -  Connection Suspend procedure (TS 23.401 [2] clause 5.3.4A)

  -  S1 release procedure (TS 23.401 [2] clause 5.3.5)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The SGW-C modifies the SGW-U to release the eNB F-TEIDu. Additionally,
    the SGW-C configures the SGW-U so that the downlink data packets can be
    buffered either in the SGW-C or in the SGW-U.

                                    [pic]

 Figure 6.3.1.4-1: Interaction between CP and UP function during procedures
                         with release of eNB F-TEIDu

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The SGW-C sends an Sx Session Modification Request to the SGW-U. It
    shall indicate the SGW-U to release the eNB F-TEIDu. Additionally, the
    SGW-C decides if the buffering of the downlink data packets shall be
    done in CP or the UP function, as specified in clause 5.9) and
    correspondingly informs the SGW-U for as follows:

    -  If the downlink data packets are to be buffered in the SGW-C, the
       SGW-C shall configure the SGW-U to forward the downlink data packets
       for all the bearers of the UE to the SGW-C, as specified in
       clause 5.6.

    -  If the downlink data packets are to be buffered in the SGW-U, the
       SGW-C shall indicate the same to SGW-U. Additionally, the following
       applies:

       -  if the Paging Policy Differentiation feature (as specified in
         3GPP TS 23.401 [2] clause 4.9) is supported by the SGW-C and SGW-U
         and based on operator's policy if it is required to be activated
         for this UE, the SGW-C shall include an indication to provide the
         DSCP in TOS (IPv4) / TC (IPv6) value from the IP header of the
         first downlink data packet of each bearer.

       -  if the PDN GW Pause Charging procedure (as specified in
         3GPP TS 23.401 [2] clause 5.3.6A) is supported by the SGW-C and SGW-
         U and based on operator's policy if it is required to be activated
         for this UE, the SGW-C may provide the number/fraction of
         packets/bytes drop threshold value. When this threshold is reached,
         the SGW-U is required to provide an indication to the SGW-C.

  3. The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the successful modification of the Sx session.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.1.5  Procedures when downlink data is buffered in the UP function

This clause defines interactions between the CP and UP function when then
UE is in idle mode and buffering of the downlink data is performed in the
UP function, during the following procedures:

  -  Network Triggered Service Request (TS 23.401 [2] clause 5.3.4.3)

  -  PDN GW Pause of Charging procedure (TS 23.401 [2] clause 5.3.6A)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The SGW-U notifies the SGW-C that the first downlink data packet was
    received for a bearer.

  NOTE:  A bearer is identified in the SGW-U as a combination of PDR(s) and
         FAR(s).

  -  The SGW-U notifies the SGW-C that the drop threshold was reached.

                                    [pic]

    Figure 6.3.1.5-1: Interaction between CP and UP when downlink data is
                         buffered in the UP function

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. When the downlink data is received, the SGW-U starts buffering it.

     On arrival of the first downlink data packet for a bearer, the SGW-U
    shall send an Sx report message (first packet indication) to the SGW-C.
    If the Paging Policy Differentiation feature (as specified in
    3GPP TS 23.401 [2] clause 4.9) is supported by the SGW-U and if it is
    activated by the SGW-C for this Sx session, the SGW-U shall also
    include the DSCP in TOS (IPv4) / TC (IPv6) value from the IP header of
    the downlink data packet.

     If the SGW-C has provided the number/fraction of packets/bytes drop
    threshold value during the procedure with release of eNB F-TEIDu
    (clause 6.3.1.4), the SGW-U shall monitor that threshold. Once the
    threshold is reached the SGW-U shall send an Sx report message (drop
    threshold reached) to the SGW-C.

  3. The relevant steps of the procedure as specified in the figure above
    are executed.

  4. The SGW-C sends an Sx report Ack message to the SGW-U. Additionally,
    for the following procedures the following applies:

    -  Network Triggered Service Request: If DL Buffering Duration time and
       DL Buffering Suggested Packet Counts were received from the MME/SGSN
       (refer to step no. 2 of TS 23.401 [2] clause 5.3.4.3) by the SGW-C
       then SGW-C shall include the same in the Sx report Ack message.

  5. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.1.6  Procedures with release of PDN connection

This clause defines interactions between the CP and UP function during the
following procedures:

  -  UE-initiated Detach procedure for E-UTRAN (TS 23.401 [2]
    clause 5.3.8.2.1)

  -  UE-initiated Detach procedure for GERAN/UTRAN with ISR activated
    (TS 23.401 [2] clause 5.3.8.2.2)

  -  MME-initiated Detach procedure (TS 23.401 [2] clause 5.3.8.3)

  -  SGSN-initiated Detach procedure with ISR activated (TS 23.401 [2]
    clause 5.3.8.3A)

  -  HSS-initiated Detach procedure (TS 23.401 [2] clause 5.3.8.4)

  -  UE or MME requested PDN disconnection (TS 23.401 [2] clause 5.10.3)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The SGW-C terminates the Sx session at the SGW-U.

  -  The PGW-C terminates the Sx session at the PGW-U.

                                    [pic]

 Figure 6.3.1.6-1: Interaction between CP and UP function during release of
                               PDN connection

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The SGW-C sends an Sx Session Modification Request to the SGW-U. SGW-C
    shall indicate SGW-U to stop counting for the affected bearers. SGW-C
    shall also indicate the SGW-U to discard downlink packets received from
    PGW-U for the affected bearers, and discard uplink packets received
    from eNodeB for the affected bearers.

  3. The SGW-U sends an Sx Session Modification Response to the SGW-C.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.

  5. The PGW-C sends an Sx Session Termination Request to the PGW-U.

  6. The PGW-U sends an Sx Session Termination Response to the PGW-C
    confirming the successful termination of the Sx session. Additionally,
    if the usage reporting is configured by the PGW-C (as specified in
    clause 5.3.2) the PGW-U shall provide the usage report(s) for the PDN
    connection (as specified in clause 5.3.3) to the PGW-C.

  7. The relevant steps of the procedure as specified in the figure above
    are executed.

  8. The SGW-C sends an Sx Session Termination Request to the SGW-U.

  9. The SGW-U sends an Sx Session Termination Response to the SGW-C
    confirming the successful termination of the Sx session. Additionally,
    if the usage reporting is configured by the SGW-C (as specified in
    clause 5.3.2) the SGW-U shall provide the usage report(s) for the PDN
    connection (as specified in clause 5.3.3) to the SGW-C.


6.3.1.7  Procedures with modification of bearer

This clause defines interactions between the CP and UP function during the
following procedures:

  -  Dedicated bearer activation (TS 23.401 [2] clause 5.4.1)

  -  PDN GW initiated bearer modification with bearer QoS update
    (TS 23.401 [2] clause 5.4.2.1)

  -  PDN GW initiated bearer modification without bearer QoS update
    (TS 23.401 [2] clause 5.4.3)

  -  PDN GW initiated bearer deactivation (TS 23.401 [2] clause 5.4.4.1)

  -  HSS Initiated Subscribed QoS Modification (TS 23.401 [2]
    clause 5.4.2.2)

  -  MME Initiated Dedicated Bearer Deactivation (TS 23.401 [2]
    clause 5.4.4.2)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The PGW-C modifies the Sx session at the PGW-U.

  -  The SGW-C modifies the Sx session at the SGW-U.

                                    [pic]

       Figure 6.3.1.7-1: Interaction between CP and UP function during
                           modification of bearer

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The PGW-C sends an Sx Session Modification Request to the PGW-U. For
    "Dedicated bearer activation", PGW-C may indicate PGW-U to allocate F-
    TEID for the dedicate bearer. For "PGW/MME initiated bearer
    deactivation procedure", PGW-C shall indicate PGW-U to stop counting
    and stop fowarding packets for the affected bearers.

  3. The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the successful modification of the Sx session.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.

  5. The SGW-C sends an Sx Session Modification Request to the SGW-U. For
    "Dedicated bearer activation", SGW-C may indicate SGW-U to allocate F-
    TEID for the dedicate bearer. For "PGW/MME initiated bearer
    deactivation procedure", SGW-C shall indicate SGW-U to stop counting
    and stop fowarding packets for the affected bearers.

  6. The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the successful modification of the Sx session.

  7. The relevant steps of the procedure as specified in the figure above
    are executed.

  8. The SGW-C sends an Sx Session Modification Request to the SGW-U. For
    dedicated bearer activation procedure, the SGW-C shall include the F-
    TEIDu of the activated bearer received from the eNodeB. For PDN GW/HSS
    initiated bearer modification with bearer QoS update procedure, SGW-C
    provides updated QoS parameters to SGW-U. For PDN GW/MME initiated
    bearer deactivation procedure, SGW-C shall indicate SGW-U to remove the
    PDR for the affected bearers.

     If the default bearer belonging to a PDN connection is deactivated,
    the SGW-C sends an Sx Session Termination Request to the SGW-U.

  9. The SGW-U sends an Sx Session Modification Response or an Sx Session
    Termination Response to the SGW-C confirming the successful
    modification or termination of the Sx session.

  10.  The relevant steps of the procedure as specified in the figure above
    are executed.

  11.  The PGW-C sends an Sx Session Modification Request to the PGW-U. For
    dedicated bearer activation procedure, the PGW-C shall include the F-
    TEIDu of the activated bearer received from the SGW. For PDN GW/HSS
    initiated bearer modification with bearer QoS update procedure, PGW-C
    provides updated QoS parameters to PGW-U. For "PDN GW initiated bearer
    modification without bearer QoS update" procedure, PGW-C provides
    updated TFT to PGW-U. For PDN GW/MME initiated bearer deactivation
    procedure, PGW-C shall indicate PGW-U to remove the PDR for the
    affected bearers.

     If the default bearer belonging to a PDN connection is deactivated,
    the PGW-C sends an Sx Session Termination Request to the PGW-U.

  12.  The PGW-U sends an Sx Session Modification Response or an Sx Session
    Termination Response to the PGW-C confirming the successful
    modification or termination of the Sx session.

  13.  The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.2  Updates to procedures specified in TS 23.203


6.3.2.1  IP-CAN session establishment

This clause defines interactions between the CP and UP function during the
following procedures:

  -  IP-CAN session establishment (TS 23.203 [3] clause 7.2)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The new TDF-C selects a new TDF-U and creates Sx session.

  -  The TDF-C modifies the TDF-U to update Sx parameters.

                                    [pic]

    Figure 6.3.2.1-1: Interaction between CP and UP function with IP-CAN
                            session establishment

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. For the solicited application reporting, the PCRF requests the TDF to
    establish the relevant session towards PCRF and provides ADC Rules to
    the TDF. The TDF-C selects a new TDF-U as specified in clause 5.12 and
    sends an Sx Session Establishment Request to the TDF-U to establish the
    Sx session.

  3. The TDF-U sends an Sx Session Establishment Response to the TDF-C
    confirming the successful creation of the Sx session.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.2.2  IP-CAN session termination

This clause defines interactions between the CP and UP function during the
following procedures:

  -  IP-CAN session termination (TS 23.203 [3] clause 7.3).

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The TDF-C releases the existing Sx session from the TDF-U

                                    [pic]

    Figure 6.3.2.2-1: Interaction between CP and UP function with IP-CAN
                             session termination

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. If there is an active Sd session between TDF and PCRF, TDF-C sends an
    Sx Session Termination Request to the TDF-U to release the Sx session.

  3. The TDF-U sends an Sx Session Termination Response to the TDF-C
    confirming the release of the Sx session

  4. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.2.3  IP-CAN session modification

This clause defines interactions between the CP and UP function during the
following procedures:

  -  IP-CAN session modification (3GPP TS 23.203 [3] clause 7.4)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The TDF-C modifies the TDF-U to update Sx parameters.

  -  The PGW-C modifies the PGW-U to update Sx parameters.

                                    [pic]

 Figure 6.3.2.3: Interaction between CP and UP function with IP-CAN session
                                modification

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. For the TDF solicited application reporting, and PCRF provides new ADC
    decisions to the TDF, TDF-C sends an Sx Session Modification Request to
    the TDF-U to update Sx parameters.

  3. The TDF-U sends an Sx Session Modification Response to the TDF-C
    confirming update of Sx session

  4. The relevant steps of the procedure as specified in the figure above
    are executed.

  5. PCRF provides the updated PCC rules, and PGW-C may send an Sx Session
    Modification Request to the PGW-U to update Sx parameters.

  6. The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the update of Sx session.

  7. The relevant steps of the procedure as specified in the figure above
    are executed.

  NOTE:  If PCEF determines to trigger the procedures defined in
         TS 23.401 [2], e.g. modify bearer request, steps 5 and 6 are
         combined with the Sx Session Modification in the corresponding call
         flows described in clause 6.3.1.7.


6.3.2.4  Management of PFDs

This clause defines interactions between the CP and UP function during the
following procedures:

  -  Procedures for management of PFDs (TS 23.203 [3] clause 7.12).

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The PGW-C/TDF-C provision/update/remove the PFD (s) to the PGW-U/TDF-
    U.

                                    [pic]

      Figure 6.3.2.4-1: Interaction between CP and UP function with PFD
                                 management

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. When there's any change to the PFD (s) due to pull mode or push mode
    procedure, the PGW-C/TDF-C sends PFD management request to the PGW-
    U/TDF-U to provision/update/remove the PFD (s).

  3. PGW-U/TDF-U acknowledges by responding with PFD management response
    message.


6.3.3  Updates to procedures specified in TS 23.402


6.3.3.1  Procedures with GTP based S2b establishment

This clause defines interactions between the CP and UP function during the
following procedures:

  -  GTP based S2b for roaming, non-roaming and LBO (3GPP TS 23.402 [4]
    clause 7.2.4).

  -  Emergency services over GTP based S2b (3GPP TS 23.402 [4]
    clause 7.2.5).

  -  UE-initiated connectivity to additional PDN from Un-trusted Non-3GPP
    IP Access with GTP (3GPP TS 23.402 [4] clause 7.6.3).

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The new PGW-C selects a new PGW-U and creates an Sx session.

                                    [pic]

 Figure 6.3.3.1-1: Interaction between CP and UP function with GTP based S2b
                                establishment

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The PGW-C shall select new PGW-U as specified in clause 5.12. If the
    network is configured to perform F-TEIDu allocation in the CP function
    then PGW-C allocates F-TEIDu for the default bearer. Then the PGW-C
    sends an Sx Session Establishment Request to the selected PGW-U for
    creating an Sx session for the UE. The F-TEIDu for the default bearer
    shall be included if the PGW-C has allocated the same.

  3. If the network is configured to perform F-TEIDu allocation in the UP
    function, the PGW-U allocates F-TEIDu for the bearer. The PGW-U sends
    an Sx Session Establishment Response to the PGW-C confirming the
    successful creation of the Sx session. It shall include the F-TEIDu for
    the bearer if it has allocated the same.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.3.2  Procedures with GTP based S2a establishment

This clause defines interactions between the CP and UP function during the
following procedures:

  -  UE-Initiated Connectivity to PDN in WLAN on GTP S2a (TS 23.402 [4]
    clause 16.8.1)

  -  WLAN on GTP S2a for roaming, LBO and non-roaming scenarios
    (TS 23.402 [4] clause 16.2.1)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The new PGW-C selects a new PGW-U and creates an Sx session.

                                    [pic]

 Figure 6.3.3.2-1: Interaction between CP and UP function with GTP based S2a
                                establishment

  1-2. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  3. The PGW-C shall select new PGW-U as specified in clause 5.12. If the
    network is configured to perform F-TEIDu allocation in the CP function
    then PGW-C allocates F-TEIDu for the default bearer. Then the PGW-C
    sends an Sx Session Establishment Request to the selected PGW-U for
    creating Sx session for the UE. The F-TEIDu for the default bearer
    shall be included if the PGW-C has allocated the same.

  4. If the network is configured to perform F-TEIDu allocation in the UP
    function, the PGW-U allocates F-TEIDu for the bearer. The PGW-U sends
    an Sx Session Establishment Response to the PGW-C confirming the
    successful creation of the Sx session. It shall include the F-TEIDu for
    the bearer if it has allocated the same.

  5-7. The HSS/AAA is also made aware of the PGW-C identity at this time.
    The relevant steps of the procedure as specified in the figure above
    are then executed.

     The following steps are relevant only for "WLAN on GTP S2a for
    roaming, LBO and non-roaming scenarios" where TWAG using the layer 3
    attach request (i.e. a DHCPv4 message) is sent by the UE as the attach
    trigger. These steps are executed only if steps 3-7 shown in figure
    16.2.1-1 are omitted where TWAP sends the layer 2 attach trigger to the
    TWAG.

  8. The PGW-C shall select new PGW-U as specified in clause 5.12. If the
    network is configured to perform F-TEIDu allocation in the CP function
    then PGW-C allocates F-TEIDu for the default bearer. Then the PGW-C
    sends an Sx Session Establishment Request to the selected PGW-U for
    creating Sx session for the UE. The F-TEIDu for the default bearer
    shall be included if the PGW-C has allocated the same.

  9. If the network is configured to perform F-TEIDu allocation in the UP
    function, the PGW-U allocates F-TEIDu for the bearer. The PGW-U sends
    an Sx Session Establishment Response to the PGW-C confirming the
    successful creation of the Sx session. It shall include the F-TEIDu for
    the bearer if it has allocated the same.

  10-11. The relevant steps of the procedure as specified in the figure
    above are executed.


6.3.3.3  Procedures with GTP based S2b release

This clause defines interactions between the CP and UP function during the
following procedures:

  -  UE/ePDG-initiated detach procedure with GTP on S2b (TS 23.402 [4]
    clause 7.4.3.1)

  -  HSS/AAA-initiated detach procedure with GTP on S2b (TS 23.402 [4]
    clause 7.4.4.1)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The PGW-C releases the existing Sx session from the PGW-U.

                                    [pic]

  Figure 6.3.3.3-1: Interaction between CP and UP function with release of
                                GTP based S2b

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The PGW-C sends an Sx Session Termination Request to the PGW-U to
    release the Sx session.

  3. The PGW-U sends an Sx Session Termination Response to the PGW-C
    confirming the release of the Sx session.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.3.4  Procedures with GTP based S2a release

This clause defines interactions between the CP and UP function during the
following procedures:

  -  UE/TWAN Initiated Detach and UE/TWAN requested PDN Disconnection on
    GTP S2a (TS 23.402 [4] clause 16.3.1.1)

  -  UE/TWAN-Initiated Detach in WLAN on GTP S2a (TS 23.402 [4]
    clause 16.7.1.1)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The PGW-C releases the existing Sx session from the PGW-U.

                                    [pic]

  Figure 6.3.3.4-1: Interaction between CP and UP function with release of
                                GTP based S2a

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The PGW-C sends an Sx Session Termination Request to the PGW-U to
    release the Sx session.

  3. The PGW-U sends an Sx Session Termination Response to the PGW-C
    confirming the release of the Sx session.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.3.5  Procedures with dedicated bearer activation by PGW

This clause defines interactions between the CP and UP function during the
following procedures:

  -  Dedicated S2b Bearer Activation Procedure with GTP on S2b
    (TS 23.402 [4] clause 7.10)

  -  Dedicated S2a Bearer Activation Procedure with GTP on S2a
    (TS 23.402 [4] clause 16.5)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The PGW-C modifies the existing Sx session for activating new
    dedicated bearer.

                                    [pic]

   Figure 6.3.3.5-1: Interaction between CP and UP function with dedicated
                          bearer activation by PGW

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The PGW-C initiates dedicated bearer activation procedure based on the
    PCC decision provision (QoS policy) message received from the PCRF. It
    uses received QoS policy to assign the EPS Bearer QoS, i.e., it assigns
    the values to the bearer level QoS parameters QCI, ARP, GBR and MBR.
    The PGW-C sends an Sx Session Modification Request to the existing PGW-
    U for activating new dedicated bearer for the UE. If the TEIDs
    allocation is done in the CP function then PGW-C shall allocate TEIDs
    for the new bearer(s) and sends them to the PGW-U.

  3. If the F-TEIDu allocation is done in the UP function, the PGW-U shall
    allocate TEIDs for the new bearer(s). The PGW-U sends an Sx Session
    Modification Response to the PGW-C confirming the successful
    modification of the Sx session. It shall include the TEIDs for the new
    bearer(s) if it has allocated the same.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.3.6  Procedures with bearer deactivation by PGW

This clause defines interactions between the CP and UP function during the
following procedures:

  -  PDN GW Initiated Bearer Deactivation with GTP on S2b (TS 23.402 [4]
    clause 7.9.2)

  -  PDN GW Initiated Bearer Deactivation with GTP on S2a (TS 23.402 [4]
    clause 16.4.1)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The PGW-C modifies the existing Sx session for deactivating the
    dedicated bearer.

                                    [pic]

    Figure 6.3.3.6-1: Interaction between CP and UP function with bearer
                            deactivation by PGW-C

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The PGW-C initiates bearer deactivation procedure based on IP-CAN
    modifications encountered by the PCRF when the dynamic PCC is deployed.
    The PGW-C sends an Sx Session Modification Request to the existing PGW-
    U for deactivating the dedicated bearer for the UE. If the TEIDs
    allocation was done in the CP function then PGW-C shall de-allocate
    these TEIDs.

  3. If the TEIDs allocation was done in the UP function then PGW-U shall
    de-allocate these TEIDs once it receives Sx Session Modification
    Request from the PGW-C. The PGW-U sends an Sx Session Modification
    Response to the PGW-C confirming the successful modification of the Sx
    session.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.3.7  Procedures with bearer modification

This clause defines interactions between the CP and UP function during the
following procedures:

  -  S2b Bearer Modification Procedure with GTP on S2b (TS 23.402 [4]
    clause 7.11.1)

  -  HSS Initiated Subscribed QoS Modification (TS 23.402 [4]
    clause 7.11.2)

  -  PDN GW-initiated S2a Bearer Modification Procedure with GTP on S2a
    (TS 23.402 [4] clause 16.6.1)

  -  HSS Initiated Subscribed QoS Modification (TS 23.402 [4]
    clause 16.6.2)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The PGW-C modifies the existing Sx session for modification of the
    existing bearer.

                                    [pic]

    Figure 6.3.3.7-1: Interaction between CP and UP function with bearer
                                modification

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The PGW-C initiates dedicated bearer modification procedure based on
    the PCC decision provision (QoS policy) message received from the PCRF.
    It uses this QoS policy to determine that a service data flow shall be
    aggregated to or removed from an active bearer or that the authorized
    QoS of a service data flow has changed. The PGW-C sends an Sx Session
    Modification Request to the existing PGW-U for modification of the
    existing bearer for the UE.

  3. The PGW-U updates the Sx parameters and sends an Sx Session
    Modification Response to the PGW-C confirming the successful
    modification of the Sx session.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.3.8  Procedures with handover from non-3GPP access

This clause defines interactions between the CP and UP function during the
following procedures:

  -  Handover from Trusted Non-3GPP IP Access to E-UTRAN with GTP on S2a or
    S2b and GTP on S5/S8 interfaces (TS 23.402 [4] clause 8.2.1.1 and
    clause 16.11).

  -  Handover from Trusted Non-3GPP IP Access to UTRAN/GERAN with GTP on
    S2a and GTP based S5/S8 (TS 23.402 [4] clause 8.2.1.3 and
    clause 16.11).

  -  Handover from Untrusted Non-3GPP IP Access to E-UTRAN with GTP on S2b
    and GTP on S5/S8 interfaces (TS 23.402 [4] clause 8.6.1.1).

  -  Handover from Untrusted Non-3GPP IP Access to UTRAN/GERAN with GTP on
    S2b and GTP on S5/S8 interfaces (TS 23.402 [4] clause 8.6.1.2).

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The SGW-C selects a SGW-U and creates an Sx session.

  -  The SGW-C modifies the existing Sx session for modification of the
    bearer.

  -  The PGW-C selects a PGW-U and creates an Sx session.

  -  The PGW-C modifies the existing Sx session for modification of the
    bearer.

                                    [pic]

 Figure 6.3.3.8-1: Interaction between CP and UP function with handover from
                               non-3GPP access

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. The SGW-C shall select SGW-U as specified in clause 5.12 when the
    request with a Handover Indication information. If the network is
    configured to perform F-TEIDu allocation in the CP function then SGW-C
    allocates F-TEIDu for each and every bearer. Then the SGW-C sends Sx
    Session Establishment Request to the selected SGW-U for creating Sx
    session for the UE. The F-TEIDu for each and every bearer shall be
    included if the SGW-C has allocated the same.

  3. If the network is configured to perform F-TEIDu allocation in the UP
    function, the SGW-U allocates F-TEIDu for all received bearers. The SGW-
    U sends Sx Session Establishment Response to the SGW-C confirming the
    successful creation of the Sx session. It shall include the F-TEIDu for
    each and every bearer if it has allocated the same.

  4. The relevant steps of the procedure as specified in the figure above
    are executed. Since Handover Indication is included, the PGW-C may
    execute a PCEF-Initiated IP-CAN Session Modification Procedure with the
    PCRF.

  5. If the network is configured to perform F-TEIDu allocation in the CP
    function then PGW-C allocates F-TEIDu for each and every bearer. Then
    the PGW-C sends an Sx Session Modification Request to the PGW-U for
    modifying the Sx session for the UE. The F-TEIDu for each and every
    bearer shall be included if the PGW-C has allocated the same.

  6. If the network is configured to perform F-TEIDu allocation in the UP
    function, the PGW-U allocates F-TEIDu for all received bearers. The PGW-
    U sends an Sx Session Modification Response to the PGW-C confirming the
    successful modification of the Sx session. It shall include the F-TEIDu
    for each and every bearer if it has allocated the same.

  7. The relevant steps of the procedure as specified in the figure above
    are executed.

  8. The SGW-C sends an Sx Session Modification Request after Radio and
    Access bearers are established at the SGW-C.

  9. The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the successful modification of the Sx session.

  10.  The relevant steps of the procedure as specified in the figure above
    are executed.

  11.  The PGW-C sends an Sx Session Modification Request to prompt the PGW-
    U to tunnel packets from non 3GPP IP access to 3GPP access system and
    immediately start routing packets to the SGW-U for the default and any
    dedicated EPS bearers established.

  12.  The PGW-U sends an Sx Session Modification Response to the PGW-C.

  13.  The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.3.9  Procedures with handover from 3GPP access

This clause defines interactions between the CP and UP function during the
following procedures:

  -  Handover from 3GPP Access to Untrusted Non-3GPP IP Access with GTP on
    S2b (TS 23.402 [4] clause 8.6.2.1)

  -  Handover in single-connection mode from 3GPP access to Trusted WLAN on
    GTP S2a for roaming and non-roaming scenarios (TS 23.402 [4]
    clause 16.10.1.1)

During the above procedures following is the nature of interactions between
the CP and UP function:

  -  The new PGW-C selects a new PGW-U and creates an Sx session.

                                    [pic]

 Figure 6.3.3.9-1: Interaction between CP and UP function with handover from
                                 3GPP access

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2. If the network is configured to perform F-TEIDu allocation in the CP
    function then PGW-C allocates F-TEIDu for each and every bearer. Then
    the PGW-C sends an Sx Session Establishment Request to the selected PGW-
    U for modifying the Sx session for the UE. The F-TEIDu for each and
    every bearer shall be included if the PGW-C has allocated the same.

  3. If the network is configured to perform F-TEIDu allocation in the UP
    function, the PGW-U allocates F-TEIDu for all received bearers. The PGW-
    U sends an Sx Session Establishment Response to the PGW-C confirming
    the successful modification of the Sx session. It shall include the F-
    TEIDu for each and every bearer if it has allocated the same.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.4  Updates to procedures specified in TS 23.060


6.3.4.1  Procedures with PDN connection deactivation


6.3.4.1.1   Procedures with SGSN terminating S4 interface

This clause defines interactions between the CP and UP function during the
following procedures related to the deactivation of a PDN connection:

Group 1:

  -  Combined GPRS / IMSI Attach procedure:

    -  Including steps specific for S4 SGSN: Combined GPRS / IMSI Attach
       procedure, Delete Bearer by the new SGSN, using S4, and Combined GPRS
       / IMSI Attach procedure, Delete Bearer by the old SGSN, using S4.

  -  MS-Initiated Combined GPRS / IMSI Detach Procedure.

  -  SGSN-Initiated GPRS Detach Procedure.

  -  HLR-Initiated GPRS Detach Procedure:

    -  Including steps specific for S4 SGSN: SGSN interaction during Detach
       Procedure when using S4.

  -  MS Initiated Bearer Deactivation Procedure for A/Gb mode (with
    Teardown Ind).

  -  MS Initiated Bearer Deactivation Procedure for Iu mode (with Teardown
    Ind).

  -  SGSN-initiated Bearer Deactivation Procedure (with Teardown Ind):

    -  Including steps specific for S4 SGSN: MS-and SGSN Initiated PDN
       connection Deactivation Procedure using S4.

Group 2:

  -  GGSN-initiated PDP Context Deactivation Procedure (with Teardown Ind):

    -  Including steps specific for S4 SGSN: PDN GW-initiated Bearer
       Deactivation Procedure using S4, part 1 and part 2.

During the above procedures, following is the nature of interactions
between the CP and UP function:

  -  The SGW-C releases the existing Sx session from SGW-U.

  -  The PGW-C releases the existing Sx session from PGW-U.

  -  The SGW-C modifies the existing Sx session for SGW-U.

  -  The PGW-C modifies the existing Sx session for PGW-U.

                                    [pic]

     Figure 6.3.4.1.1-1: Interaction between CP and UP function with PDN
                       connection deactivation Group 1

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2a.  The SGW-C sends an Sx Session Modification Request to the SGW-U to
    modify the Sx session. SGW-C shall request SGW-U to stop counting for
    the affected bearers. SGW-C shall also request the SGW-U to discard
    downlink packets received from PGW-U for the affected bearers, and
    discard uplink packets received from eNodeB for the affected bearers.

  2b.  The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the modification of the Sx session.

  2c.  The relevant steps of the procedure as specified in the figure above
    are executed.

  3a.  The PGW-C may send an Sx Session Termination Request to the PGW-U to
    release the Sx session.

  3b.  The PGW-U sends an Sx Session Termination Response to the PGW-C
    confirming the release of the Sx session.

  3c.  The relevant steps of the procedure as specified in the figure above
    are executed.

  3d.  The SGW-C may send an Sx Session Termination Request to the SGW-U to
    release the Sx session.

  3e.  The SGW-U sends an Sx Session Termination Response to the SGW-C
    confirming the release of the Sx session.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.

  5a.  The SGW-C may send an Sx Session Modification Request to the SGW-U
    in detach and Bearer Deactivation procedures. SGW-C shall indicate SGW-
    U to stop counting for the affected bearers. SGW-C shall also indicate
    the SGW-U to discard downlink packets received from PGW-U for the
    affected bearers, and discard uplink packets received from eNodeB for
    the affected bearers..

  5b.  The SGW-U sends an Sx Session Modification Response to the SGW-C.

  6. The relevant steps of the procedure as specified in the figure above
    are executed.

  7a.  The PGW-C may send an Sx Session Termination Request to the PGW-U to
    release the Sx session.

  7b.  The PGW-U sends an Sx Session Termination Response to the PGW-C
    confirming the release of the Sx session.

  8. The relevant steps of the procedure as specified in the figure above
    are executed.

  9a.  The SGW-C may send an Sx Session Termination Request to the SGW-U to
    release the Sx session.

  9b.  The SGW-U sends an Sx Session Termination Response to the SGW-C
    confirming the release of the Sx session.

  10.  The relevant steps of the procedure as specified in the figure above
    are executed.

                                    [pic]

     Figure 6.3.4.1.1-2: Interaction between CP and UP function with PDN
                       connection deactivation Group 2

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2a.  The PGW-C sends an Sx Session Modification Request to the PGW-U when
    it initiates bearer deactivation procedure. PGW-C shall indicate PGW-U
    to stop counting for the affected bearers. PGW-C shall also indicate
    the PGW-U to discard packets received for the affected bearers.

  2b.  The PGW-U sends an Sx Session Modification Response to the PGW-C.

  3a.  The SGW-C sends an Sx Session Modification Request to the SGW-U. SGW-
    C shall indicate SGW-U to stop counting for the affected bearers. SGW-C
    shall also indicate the SGW-U to discard packets received for the
    affected bearers.

  3b.  The SGW-U sends an Sx Session Modification Response to the SGW-C.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.

  5a.  The SGW-C sends an Sx Session Termination Request to the SGW-U to
    release the Sx session.

  5b.  The SGW-U sends an Sx Session Termination Response to the SGW-C
    confirming the release of the Sx session.

  6. The relevant steps of the procedure as specified in the figure above
    are executed.

  7a.  The PGW-C sends an Sx Session Termination Request to the PGW-U to
    release the Sx session.

  7b.  The PGW-U sends an Sx Session Termination Response to the PGW-C
    confirming the release of the Sx session.

  8. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.4.1.2   Procedures with SGSN terminating Gn/Gp interface

This clause defines interactions between the CP and UP function during the
following procedures related to the deactivation of a PDN connection:

Group 1:

  -  Combined GPRS / IMSI Attach procedure.

  -  MS-Initiated Combined GPRS / IMSI Detach Procedure.

  -  SGSN-Initiated GPRS Detach Procedure.

  -  HLR-Initiated GPRS Detach Procedure.

   - MS Initiated PDP Context Deactivation Procedure for A/Gb mode (with
    Teardown Ind).

  -  MS Initiated PDP Context Deactivation Procedure for Iu mode (with
    Teardown Ind).

  -  SGSN-initiated PDP Context Deactivation Procedure (with Teardown Ind).

Group 2:

  -  GGSN-initiated PDP Context Deactivation Procedure (with Teardown Ind).

During the above procedures, following is the nature of interactions
between the CP and UP function:

  -  The PGW-C releases the existing Sx session from PGW-U.

                                    [pic]

     Figure 6.3.4.1.2-1: Interaction between CP and UP function with PDN
                       connection deactivation Group 1

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2a.  The PGW-C may send an Sx Session Termination Request to the PGW-U to
    release the Sx session.

  2b.  The PGW-U sends an Sx Session Termination Response to the PGW-C
    confirming the release of the Sx session.

  3. The relevant steps of the procedure as specified in the figure above
    are executed.

  4a.  The PGW-C may send an Sx Session Termination Request to the PGW-U to
    release the Sx session.

  4b.  The PGW-U sends an Sx Session Termination Response to the PGW-C
    confirming the release of the Sx session.

  5. The relevant steps of the procedure as specified in the figure above
    are executed.

                                    [pic]

     Figure 6.3.4.1.2-2: Interaction between CP and UP function with PDN
                       connection deactivation Group 2

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2a.  The PGW-C sends an Sx Session Modification Request to the PGW-U when
    it initiates bearer deactivation procedure. PGW-C shall indicate PGW-U
    to stop counting for the affected bearers. PGW-C shall also indicate
    the PGW-U to discard packets received for the affected bearers.

  2b.  The PGW-U sends an Sx Session Modification Response to the PGW-C.

  3. The relevant steps of the procedure as specified in the figure above
    are executed.

  4a.  The PGW-C sends an Sx Session Termination Request to the PGW-U to
    release the Sx session.

  4b.  The PGW-U sends an Sx Session Termination Response to the PGW-C
    confirming the release of the Sx session.

  5. The relevant steps of the procedure as specified in the figure above
    are executed.


6.3.4.2  Procedures with PDN connection modification


6.3.4.2.1   Procedures with SGSN terminating S4 interface

This clause defines interactions between the CP and UP function during the
following procedures related to the modification of a PDN connection.

Group 1 Procedures for Location Management, Handover, Service Request and
Inter-System Change:

  -  Inter SGSN Routeing Area Update Procedure:

    -  Including steps specific for S4 SGSN: Inter SGSN Routeing Area
       Update and Combined Inter SGSN RA / LA Update using S4.

  -  Combined RA / LA Update in the Case of Inter SGSN RA Update Procedure:

    -  Including steps specific for S4 SGSN: Inter SGSN Routeing Area
       Update and Combined Inter SGSN RA / LA Update using S4.

  -  Iu mode RA Update Procedure:

    -  Including steps specific for S4 SGSN: Routeing Area Update Procedure
       using S4.

  -  SRNS Relocation Procedure.

  -  Combined Hard Handover and SRNS Relocation Procedure.

  -  Combined Cell / URA Update and SRNS Relocation Procedure:

    -  Including steps specific for S4 SGSN: Serving RNS Relocation
       Procedure, Combined Hard Handover and SRNS Relocation Procedure, and
       Combined Cell / URA Update and SRNS Relocation Procedure Using S4.

  -  Enhanced Serving RNS Relocation:

    -  Including steps specific for S4 SGSN: Enhanced Serving RNS
       Relocation Procedure using S4.

  -  MS Initiated Service Request Procedure.

  -  Network Initiated Service Request Procedure:

    -  Including steps specific for S4 SGSN: UE Initiated Service Request
       Procedure Using S4.

  -  Iu mode to A/Gb mode Intra SGSN Change:

    -  Including steps specific for S4 SGSN: Iu mode to A/Gb mode Intra
       SGSN Change using S4.

  -  A/Gb mode to Iu mode Intra SGSN Change:

    -  Including steps specific for S4 SGSN: A/Gb mode to Iu mode Intra-
       SGSN Change using S4.

  -  Iu mode to A/Gb mode Inter-SGSN Change:

    -  Including steps specific for S4 SGSN: Iu mode to A/Gb mode Inter-
       SGSN Change using S4.

  -  A/Gb mode to Iu mode Inter SGSN Change:

    -  Including steps specific for S4 SGSN: A/Gb mode to Iu mode Inter-
       SGSN Change using S4.

  -  GPRS Paging Procedure (A/Gb mode):

    -  S4 specific handling in Paging response for GPRS Downlink Transfer
       with no established user plane on S4.

Group 2 UE/SGSN initiated PDN connection modification:

  -  Secondary PDP Context Activation Procedure for A/Gb mode.

  -  Secondary PDP Context Activation Procedure for Iu mode:

    -  Including steps specific for S4 SGSN: Secondary PDP Context
       Activation Procedure, PDP Creation part, using S4.

  -  MS-Initiated PDP Context Modification Procedure, A/Gb mode.

  -  MS-Initiated PDP Context Modification Procedure, Iu mode.

  -  SGSN-Initiated PDP Context Modification Procedure, A/Gb mode.

  -  SGSN-Initiated PDP Context Modification Procedure, Iu mode:

    -  Including steps specific for S4 SGSN: Request part of SGSN-Initiated
       EPS Bearer Modification Procedure using S4, and Update part of SGSN-
       Initiated EPS Bearer Modification Procedure using S4.

  -  MS Initiated PDP Context Deactivation Procedure for A/Gb mode (without
    Teardown Ind).

  -  MS Initiated PDP Context Deactivation Procedure for Iu mode (without
    Teardown Ind).

  -  SGSN-initiated PDP Context Deactivation Procedure (without Teardown
    Ind):

    -  Steps specific for S4 SGSN: MS-and SGSN Initiated Bearer
       Deactivation Procedure.

Group 3 PGW initiated PDN connection modification:

  -  Network Requested Secondary PDP Context Activation Procedure using S4.

  -  GGSN-Initiated PDP Context Modification Procedure:

    -  Including steps specific for S4 SGSN: PGW-Initiated Bearer
       Modification Procedure, A/Gb mode.

  -  GGSN-Initiated PDP Context Modification Procedure:

    -  Including steps specific for S4 SGSN: PGW-Initiated Bearer
       Modification Procedure, Iu mode.

  -  GGSN-initiated PDP Context Deactivation Procedure (without Teardown
    Ind):

    -  Including steps specific for S4 SGSN: PGW-initiated Bearer
       Deactivation Procedure

During the above procedures, following is the nature of interactions
between the CP and UP function:

  -  The SGW-C informs the SGW-U to modify the Sx session.

  -  The PGW-C informs the PGW-U to modify the Sx session.

                                    [pic]

     Figure 6.3.4.2.1-1: Interaction between CP and UP function with PDN
                      connection modification, Group 1

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2a.  The SGW-C may send an Sx Session Modification Request to the SGW-U
    to update the Sx session.

  2b.  The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the update the Sx session.

  2c.  The relevant steps of the procedure as specified in the figure above
    are executed.

  3a.  The PGW-C may send an Sx Session Modification Request to the PGW-U
    to update the Sx session.

  3b.  The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the update the Sx session.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.

  NOTE 1:  Step 2a/2b happens when SGW-C receives request message from S4
         SGSN, and step 3a/3b happens when PGW-C receives request message
         from SGW-C.

                                    [pic]

     Figure 6.3.4.2.1-2: Interaction between CP and UP function with PDN
                      connection modification, Group 2

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2a.  The PGW-C may send an Sx Session Modification Request to the PGW-U
    to update the Sx session. For "Secondary PDP Context Activation
    Procedure", PGW-C may request PGW-U to allocate F-TEID for the
    dedicated bearer. For "MS- or SGSN- Initiated PDP Context Deactivation
    Procedure", PGW-C shall request PGW-U to stop counting and stop
    forwarding packets for the affected bearers.

  2b.  The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the update the Sx session.

  3. The relevant steps of the procedure as specified in the figure above
    are executed.

  4a.  The SGW-C may send an Sx Session Modification Request to the SGW-U
    to update the Sx session. For "Secondary PDP Context Activation
    Procedure", SGW-C may request SGW-U to allocate F-TEID for the dedicate
    bearer. For "MS- or SGSN Initiated PDP Context Deactivation Procedure",
    SGW-C shall request SGW-U to stop counting and stop forwarding packets
    for the affected bearers.

  4b.  The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the update the Sx session.

  5. The relevant steps of the procedure as specified in the figure above
    are executed.

  6a.  The SGW-C may send an Sx Session Modification Request to the SGW-U
    to update the Sx session. For "Secondary PDP Context Activation
    Procedure", the SGW-C shall include the F-TEIDu of the activated bearer
    received from the S4 SGSN or RNC. For "MS- or SGSN- initiated PDP
    Context Modification" with bearer QoS update procedure, SGW-C provides
    updated QoS parameters to SGW-U. For "MS- or SGSN Initiated PDP Context
    Deactivation Procedure", SGW-C shall request SGW-U to remove the PDR
    for the affected bearers.

  6b.  The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the update the Sx session.

  7. The relevant steps of the procedure as specified in the figure above
    are executed.

  8a.  The PGW-C may send an Sx Session Modification Request to the PGW-U
    to update the Sx session. For "Secondary PDP Context Activation
    Procedure", the PGW-C shall include the F-TEIDu of the activated bearer
    received from the SGW. For "MS- or SGSN- Initiated PDP Context
    Deactivation Procedure, the PGW-C shall request PGW-U to remove the PDR
    for the affected bearers.

  8b.  The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the update the Sx session.

  NOTE 2:  Step 2a/2b happens before PGW-C sends request message to SGW-C,
         and step 8a/8b happens when PGW-C receives response message from
         SGW-C.

  NOTE 3:  Step 4a/4b happens when SGW-C receives request message from PGW-
         C, and step 6a/6b happens when SGW-C receives response message from
         S4 SGSN.

                                    [pic]

     Figure 6.3.4.2.1-3: Interaction between CP and UP function with PDN
                      connection modification, Group 3

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2a.  The PGW-C may send an Sx Session Modification Request to the PGW-U
    to update the Sx session. For "Network Requested Secondary PDP Context
    Activation Procedure", PGW-C may request PGW-U to allocate F-TEID for
    the dedicated bearer. For "GGSN Initiated PDP Context Deactivation
    Procedure", PGW-C shall request PGW-U to stop counting and stop
    forwarding packets for the affected bearers.

  2b.  The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the update the Sx session.

  3a.  The SGW-C may send an Sx Session Modification Request to the SGW-U
    to update the Sx session. For "Network Requested Secondary PDP Context
    Activation Procedure", SGW-C may request SGW-U to allocate F-TEID for
    the dedicate bearer. For "GGSN Initiated PDP Context Deactivation
    Procedure", SGW-C shall request SGW-U to stop counting and stop
    forwarding packets for the affected bearers.

  3b.  The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the update the Sx session.

  4. The relevant steps of the procedure as specified in the figure above
    are executed.

  5a.  The SGW-C may send an Sx Session Modification Request to the SGW-U
    to update the Sx session. For "Network Requested Secondary PDP Context
    Activation Procedure", the SGW-C shall include the F-TEIDu of the
    activated bearer received from the S4 SGSN or RNC. For "GGSN initiated
    PDP Context Modification" with bearer QoS update, SGW-C provides
    updated QoS parameters to SGW-U. For "GGSN Initiated PDP Context
    Deactivation Procedure", SGW-C shall request SGW-U to remove the PDR
    for the affected bearers.

  5b.  The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the update the Sx session.

  6. The relevant steps of the procedure as specified in the figure above
    are executed.

  7a.  The PGW-C may send an Sx Session Modification Request to the PGW-U
    to update the Sx session. For "Network Requested Secondary PDP Context
    Activation Procedure", the PGW-C shall include the F-TEIDu of the
    activated bearer received from the SGW. For "GGSN initiated PDP Context
    Modification" with bearer QoS update, PGW-C provides updated QoS
    parameters to PGW-U. For "GGSN Initiated PDP Context Deactivation
    Procedure, the PGW-C shall request PGW-U to remove the PDR for the
    affected bearers.

  7b.  The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the update the Sx session.

  NOTE 4:  Step 2a/2b happens before PGW-C sends request message to SGW-C,
         and step 7a/7b happens when PGW-C receives response message from
         SGW-C.

  NOTE 5:  Step 3a/3b happens when SGW-C receives request message from PGW-
         C, and step 5a/5b happens when SGW-C receives response message from
         S4 SGSN.


6.3.4.2.2   Procedures with SGSN terminating Gn/Gp interface

This clause defines interactions between the CP and UP function during the
following procedures related to the modification of a PDN connection.

Group 1 Procedures for Location Management, Handover, Service Request and
Inter-System Change:

  -  Inter SGSN Routeing Area Update Procedure.

  -  Combined RA / LA Update in the Case of Inter SGSN RA Update Procedure.

  -  Iu mode RA Update Procedure.

  -  SRNS Relocation Procedure.

  -  Combined Hard Handover and SRNS Relocation Procedure.

  -  Combined Cell / URA Update and SRNS Relocation Procedure.

  -  Enhanced Serving RNS Relocation.

  -  MS Initiated Service Request Procedure.

  -  Network Initiated Service Request Procedure.

  -  Iu mode to A/Gb mode Intra SGSN Change.

  -  A/Gb mode to Iu mode Intra SGSN Change.

  -  Iu mode to A/Gb mode Inter-SGSN Change.

  -  A/Gb mode to Iu mode Inter SGSN Change.

  -  GPRS Paging Procedure (A/Gb mode).

Group 2 UE/SGSN initiated PDN connection modification:

  -  Secondary PDP Context Activation Procedure for A/Gb mode.

  -  Secondary PDP Context Activation Procedure for Iu mode.

  -  SGSN-Initiated PDP Context Modification Procedure, A/Gb mode.

  -  SGSN-Initiated PDP Context Modification Procedure, Iu mode.

  -  MS-Initiated PDP Context Modification Procedure, A/Gb mode.

  -  MS-Initiated PDP Context Modification Procedure, Iu mode.

  -  MS Initiated PDP Context Deactivation Procedure for A/Gb mode (without
    Teardown Ind).

  -  MS Initiated PDP Context Deactivation Procedure for Iu mode (without
    Teardown Ind).

  -  SGSN-initiated PDP Context Deactivation Procedure (without Teardown
    Ind).

Group 3 PGW initiated PDN connection modification:

  -  Network Requested Secondary PDP Context Activation Procedure using Gn

  -  GGSN-Initiated PDP Context Modification Procedure for A/Gb mode

  -  GGSN-Initiated PDP Context Modification Procedure for Iu mode

  -  GGSN-initiated PDP Context Deactivation Procedure

During the above procedures, following is the nature of interactions
between the CP and UP function:

  -  The PGW-C informs the PGW-U to modify the Sx session.

                                    [pic]

     Figure 6.3.4.2.2-1: Interaction between CP and UP function with PDN
                      connection modification, Group 1

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2a.  The PGW-C may send an Sx Session Modification Request to the PGW-U
    to update the Sx session.

  2b.  The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the update the Sx session.

  3. The relevant steps of the procedure as specified in the figure above
    are executed.

  NOTE 1:  Step 2a/2b happens when PGW-C receives request message from
         GnSGSN.

                                    [pic]

     Figure 6.3.4.2.2-2: Interaction between CP and UP function with PDN
                      connection modification, Group 2

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2a.  The PGW-C may send an Sx Session Modification Request to the PGW-U
    to update the Sx session. For "Secondary PDP Context Activation
    Procedure", PGW-C may request PGW-U to allocate F-TEID for the
    dedicated bearer. For "MS- and SGSN- Initiated PDP Context Deactivation
    Procedure", the PGW-C shall request PGW-U to remove the PDR for the
    affected bearers.

  2b.  The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the update the Sx session.

  3. The relevant steps of the procedure as specified in the figure above
    are executed.

  4a.  The PGW-C may send an Sx Session Modification Request to the PGW-U
    to update the Sx session.

  4b.  The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the update the Sx session.

  5. The relevant steps of the procedure as specified in the figure above
    are executed.

  NOTE 2:  Step 2a/2b and step 4a/4b happen when PGW-C receives request
         message from GnSGSN.

                                    [pic]

     Figure 6.3.4.2.2-3: Interaction between CP and UP function with PDN
                      connection modification, Group 3

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed.

  2a.  The PGW-C may send an Sx Session Modification Request to the PGW-U
    to update the Sx session. For "GGSN Initiated PDP Context Deactivation
    Procedure", PGW-C shall request PGW-U to stop counting and stop
    forwarding packets for the affected bearers.

  2b.  The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the update the Sx session.

  3. The relevant steps of the procedure as specified in the figure above
    are executed.

  4a.  The PGW-C may send an Sx Session Modification Request to the PGW-U
    to update the Sx session. For "Network Requested Secondary PDP Context
    Activation Procedure", the PGW-C shall include the F-TEIDu of the
    activated bearer received from the GnSGSN. For "GGSN Initiated PDP
    Context Deactivation Procedure, the PGW-C shall request PGW-U to remove
    the PDR for the affected bearers.

  4b.  The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the update the Sx session.

  5. The relevant steps of the procedure as specified in the figure above
    are executed.

  NOTE 3:  Step 2a/2b happens when PGW-C sends request message to GnSGSN,
         and step 4a/4b happens when PGW-C receives response message from
         GnSGSN for GGSN initiated PDP Context Modification/Deactivation
         Procedure, or request message for Network Requested Secondary PDP
         Context Activation.


6.3.4.3  Procedures with PDN connection establishment

This clause defines interactions between the CP and UP function during the
following procedures related to the establishment of a PDN connection:

  -  IPv6 Stateless Address Autoconfiguration Procedure.

  -  PDP Context Activation Procedure for A/Gb mode.

  -  PDP Context Activation Procedure for Iu mode.

During the procedures involving S4 listed above, following is the nature of
interactions between the CP and UP function:

  -  The SGW-C informs the SGW-U to create the Sx session.

  -  The PGW-C informs the PGW-U to create the Sx session.

  -  The SGW-C informs the SGW-U to modify the Sx session.

  -  The PGW-C informs the PGW-U to modify the Sx session.

                                    [pic]

      Figure 6.3.4.3-1: Interaction between CP and UP function with PDN
                          connection establishment

  1. Procedure as listed in this step is initiated as specified in the
    relevant clauses of this specification. The relevant steps of the
    procedure as specified in the figure above are executed. Steps in
    Figure 64a are specific for S4 SGSN.

     For the case that Gn/Gp SGSN interconnects with PGW-C, steps 2a/2b or
    5a/5b are skipped.

  2a.  The SGW-C sends an Sx Session Establishment Request to the SGW-U to
    create the Sx session.

  2b.  The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the Sx session creation.

  3a.  The PGW-C sends an Sx Session Establishment Request to the PGW-U to
    create the Sx session.

  3b.  The PGW-U sends an Sx Session Establishment Response to the PGW-C
    confirming the Sx session creation.

  4. The relevant steps of the procedure as specified in the figure above
    are executed. Steps in Figure 64b are specific for S4 SGSN.

  5a.  The SGW-C may send an Sx Session Modification Request to the SGW-U
    to update the Sx session.

  5b.  The SGW-U sends an Sx Session Modification Response to the SGW-C
    confirming the Sx session update.

  6a.  The PGW-C may send an Sx Session Modification Request to the PGW-U
    to update the Sx session.

  6b.  The PGW-U sends an Sx Session Modification Response to the PGW-C
    confirming the Sx session update.

  7. The relevant steps of the procedure as specified in the figure above
    are executed.

  NOTE 1:  For the case that SGSN interconnects with SGW via S4 reference
         point, steps 2a/2b or 5a/5b happens when SGW-C receives request
         message from SGSN, and steps 3a/3b or 6a/6b happens when PGW-C
         receives request message from SGW.

  NOTE 2:  For the case that Gn/Gp SGSN interconnects with PGW-C, steps
         3a/3b or 6a/6b happens when PGW-C receives request message from
         Gn/Gp SGSN.


6.4  Sx Reporting Procedures


6.4.1  General

The Sx reporting procedure is used by the UP function of SGW, PGW or TDF to
report events to the CP function.

The following Sx reporting procedures exist: Sx session level reporting and
Sx node level reporting. Both are initiated by the CP function.


6.4.2  Sx Session Level Reporting Procedure

This procedure is used by the UP function to report events related to an Sx
session for an individual PDN connection IP-CAN session, TDF session or TDF
in unsolicited reporting mode. The triggers for event reporting were
configured on the UP function during Sx session management procedures by
the CP function (excluding the Sx session termination procedure).

                                    [pic]

            Figure 6.4.2-1: Sx Session Level Reporting procedure

  1. The UP function detects that an event has to be reported. The
    reporting triggers involve the following cases:

    (1)  Usage report (by SGW-U, PGW-U and TDF-U).

     Usage information shall be collected in the UP function and reported
       to the CP function as defined in clause 5.3 and clause 7.4.

    (2)  Start of traffic detection (by PGW-U and TDF-U).

     When traffic detection is requested by PGW-C/TDF-C, and the start of
       traffic is detected for a PDR, the PGW-U/TDF-U shall report the start
       of traffic detection to the PGW-C/TDF-C and indicate the PDR rule ID.

    (3)  Stop of traffic detection (by PGW-U and TDF-U).

     When traffic detection is requested by PGW-C/TDF-C, and the end of
       traffic is detected for a PDR, the PGW-U/TDF-U shall report the stop
       of traffic detection to the PGW-C/TDF-C and indicate the PDR rule ID.

     (4) Detection of 1st Downlink Data for Idle-Mode UE (by SGW-U)

     When SGW-U receives the downlink packet but no S1-bearer for
       transmission and the buffering is performed by SGW-U, it shall report
       the detection of 1st downlink data to SGW-C, for the purpose of
       paging the UE. SGW-U shall also report the DSCP of the packet when
       instructed by SGW-C (e.g. in case the Paging Policy Differentiation
       function as described in TS 23.401 [2] is enabled at the SGW-C).

  2. The UP function sends an Sx report message (Session ID, list of
    [Reporting trigger, Measurement information]) to the CP function.

     The Reporting trigger parameter contains the name of the event which
    triggered the report and the Measurement information parameter contains
    the actual information the CP function requested to be informed about.

  3. The CP function identifies the Sx session context based on the
    received Session ID and applies the reported information for the
    corresponding PDN connection IP-CAN session, TDF session or TDF in
    unsolicited reporting mode. The CP function responds with an Sx report
    ACK message.


6.5  Sx Management Procedures


6.5.1  General

Sx management procedures are used by the CP function to manage the UP
function independent of any Sx session.

  NOTE:  The terminology defined in TS 29.244 [12] is used for the
         procedures and messages related to the Sx management procedures.

  Editor's note:  More procedures may be added after stage 3 finalize the
         work on Sx management procedures.


6.5.2  Sx PFD management Procedure

The Sx PFD management procedure is used by the PGW-C or TDF-C to provision
or remove all PFD(s) belonging to an Application ID in the UP function as
described in clause 5.11.4. PFD sets belonging to different Application IDs
can be managed with the same PFD management request message.

The Sx PFD management procedure is a node level procedure, i.e. independent
of any Sx session.

                                    [pic]

                 Figure 6.5.2-1: Sx PFD Management Procedure

  1. The CP function is triggered to provision or remove the PFD set
    belonging to an Application ID as described in clause 5.11.4.

  2. The CP function sends a PFD management request message to the UP
    function (containing the parameters described in clause 7.9.1) to
    provision/remove the PFD set corresponding to the Application ID.

  3. The UP function acknowledges by responding with a PFD management
    response message.


6.5.3  Sx Association Setup Procedure

The Sx Association Setup procedure is used to setup an association between
the CP function and the UP function which enables the CP function to
subsequently interact with the UP function, e.g. to establish Sx Sessions.

The setup of an Sx association may be initiated by the CP function or the
UP function as described TS 29.244 [12], clause 6.2.6. The CP function and
the UP function shall support the Sx association setup initiated by the CP
function. The CP function and the UP function may additionally support the
Sx association setup initiated by the UP function.


6.5.4  Sx Association Update Procedure

The Sx Association Update procedure is used to modify an existing Sx
association between the CP function and the UP function. It may be
initiated by the UP function or by the CP function, as described
TS 29.244 [12], clause 6.2.7.


6.5.5  Sx Association Release Procedure

The Sx Association Release procedure is used to terminate the Sx
association between the CP function and the UP function due to e.g. OAM
reasons. The Sx Association Release procedure can be only initiated by the
CP function, as described TS 29.244 [12], clause 6.2.8.


7  Parameters


7.1  Parameters for Sx session management

These parameters are used to control the functionality of the UP function
related to an individual PDN connection, IP-CAN session, TDF session or TDF
in unsolicited reporting mode as well as to inform about events occurring
at the UP function. As the functionality of the respective UP functions
differs, most parameters are specific to one or two of the reference points
Sxa (between SGW-C and SGW-U), Sxb (PGW-C and PGW-U) and Sxc (TDF-C and TDF-
U).

The Sx session management procedures however will use the relevant
parameters in the same way for all Sx reference points: the Sx session
establishment procedure as well as the Sx session modification procedure
provide the control parameters to the UP function, the Sx session
termination procedure removes all control parameters related to an Sx
session and the Sx session level reporting procedure informs the CP
function about events related to the Sx session that are detected by the UP
function.

The parameters over Sx provided from CP function to UP function are grouped
into session related parameters and four different rules, one "detection"
rule and three different "enforcement" rules:

  -  Packet Detection Rule (PDR), with information describing what packets
    should receive a certain treatment (e.g. forwarding and other types of
    enforcement).

  -  Forwarding Action Rule (FAR), contains information on whether
    forwarding, dropping or buffering is to be applied to a packet.

  -  Usage Reporting Rule (URR), contains information that defines a
    certain measurement and how it shall be reported.

  -  QoS Enforcement Rule (QER), contains information related to QoS
    enforcement of traffic.

The UP function provides parameters over Sx to the CP function sending a
Usage Report.


7.2  Session context

The session context comprises the session related parameters and all PDRs,
URRs, QERs and FARs with the same Session ID.

The following table describes the session related parameters provided over
Sx.

                   Table 7.2-1: Session related parameters

|Attribute         |Description        |Comment               |Applicability |
|                  |                   |                      |SGW |PDN |TDF |
|                  |                   |                      |    |GW  |    |
|Session ID        |Uniquely identifies|This session          |X   |X   |X   |
|                  |a session.         |corresponds to a PDN  |    |    |    |
|                  |                   |connection for SGW, a |    |    |    |
|                  |                   |PDN connection and an |    |    |    |
|                  |                   |IP-CAN session for    |    |    |    |
|                  |                   |PGW, TDF session for  |    |    |    |
|                  |                   |TDF or a TDF in       |    |    |    |
|                  |                   |unsolicited reporting |    |    |    |
|                  |                   |mode.                 |    |    |    |



7.3  Packet Detection Rule

The following table describes the Packet Detection Rule (PDR) containing
information required to classify a packet arriving at the UP function.
There is at least one PDR per direction, e.g. UL direction or DL direction.

            Table 7.3-1: Attributes within Packet Detection Rule

|Attribute         |Description     |Comment                  |Applicability |
|                  |                |                         |SGW |PDN |TDF |
|                  |                |                         |    |GW  |    |
|Session ID        |Identifies the  |                         |X   |X   |X   |
|                  |session         |                         |    |    |    |
|                  |associated to   |                         |    |    |    |
|                  |this PDR        |                         |    |    |    |
|Rule ID           |Unique          |                         |X   |X   |X   |
|                  |identifier to   |                         |    |    |    |
|                  |identify this   |                         |    |    |    |
|                  |information.    |                         |    |    |    |
|Precedence        |Determines the  |                         |    |X   |X   |
|                  |order, in which |                         |    |    |    |
|                  |the detection   |                         |    |    |    |
|                  |information of  |                         |    |    |    |
|                  |all rules is    |                         |    |    |    |
|                  |applied         |                         |    |    |    |
|Packet   |Source   |Contains the    |Identifies whether the   |X   |X   |X   |
|detection|interface|values "access  |rule applies to incoming |    |    |    |
|informati|         |side", "core    |packets from the access  |    |    |    |
|on       |         |side", "CP      |side (i.e. up-link), the |    |    |    |
|         |         |function" or    |core side (i.e.          |    |    |    |
|         |         |"SGi-LAN".      |down-link), the CP       |    |    |    |
|         |         |                |function (the packet from|    |    |    |
|         |         |                |CP function) or the      |    |    |    |
|         |         |                |SGi-LAN side (the packet |    |    |    |
|         |         |                |has experienced SGi-LAN  |    |    |    |
|         |         |                |Service Functions).      |    |    |    |
|         |UE IP    |One IPv4 address|Combination of UE IP     |    |X   |X   |
|         |address  |and/or one IPv6 |address (together with   |    |    |    |
|         |         |prefix with     |Network instance, if     |    |    |    |
|         |         |prefix length   |necessary), F-TEID, SDF  |    |    |    |
|         |         |                |filters, application ID  |    |    |    |
|         |         |                |for traffic detection:   |    |    |    |
|         |         |                |SGW UL: Local F-TEID     |    |    |    |
|         |         |                |SGW DL: Local F-TEID     |    |    |    |
|         |         |                |                         |    |    |    |
|         |         |                |PGW UL: Local F-TEID + UE|    |    |    |
|         |         |                |IP address +             |    |    |    |
|         |         |                |SDF/applicat.ID          |    |    |    |
|         |         |                |PGW DL: UE IP address +  |    |    |    |
|         |         |                |SDF/application ID       |    |    |    |
|         |         |                |                         |    |    |    |
|         |         |                |TDF UL (solicited mode): |    |    |    |
|         |         |                |UE IP address +          |    |    |    |
|         |         |                |SDF/application ID       |    |    |    |
|         |         |                |TDF DL (solicited mode): |    |    |    |
|         |         |                |UE IP address +          |    |    |    |
|         |         |                |SDF/application ID       |    |    |    |
|         |         |                |TDF UL/DL (unsolicited   |    |    |    |
|         |         |                |mode): application ID    |    |    |    |
|         |Network  |Identifies the  |                         |X   |X   |X   |
|         |instance |Network instance|                         |    |    |    |
|         |         |associated with |                         |    |    |    |
|         |         |the incoming    |                         |    |    |    |
|         |         |packet.         |                         |    |    |    |
|         |         |(NOTE 1).       |                         |    |    |    |
|         |Local    |                |                         |X   |X   |    |
|         |F-TEID   |                |                         |    |    |    |
|         |List of  |                |                         |    |X   |X   |
|         |SDF      |                |                         |    |    |    |
|         |Filter(s)|                |                         |    |    |    |
|         |Applicati|                |                         |    |X   |X   |
|         |on ID    |                |                         |    |    |    |
|Outer header      |Instructs the UP|Any extension header     |X   |X   |    |
|removal           |function to     |shall be stored for this |    |    |    |
|                  |remove one or   |packet.                  |    |    |    |
|                  |more outer      |                         |    |    |    |
|                  |header(s) (e.g. |                         |    |    |    |
|                  |IP+UDP+GTP) from|                         |    |    |    |
|                  |the incoming    |                         |    |    |    |
|                  |packet.         |                         |    |    |    |
|Forwarding Action |The Forwarding  |                         |X   |X   |X   |
|Rule ID           |Action Rule ID  |                         |    |    |    |
|                  |identifies a    |                         |    |    |    |
|                  |forwarding      |                         |    |    |    |
|                  |action that has |                         |    |    |    |
|                  |to be applied.  |                         |    |    |    |
|List of Usage     |Every Usage     |                         |X   |X   |X   |
|Reporting Rule    |Reporting Rule  |                         |    |    |    |
|ID(s)             |ID identifies a |                         |    |    |    |
|                  |measurement     |                         |    |    |    |
|                  |action that has |                         |    |    |    |
|                  |to be applied.  |                         |    |    |    |
|List of QoS       |Every QoS       |                         |X   |X   |X   |
|Enforcement Rule  |Enforcement Rule|                         |    |    |    |
|ID(s)             |ID identifies a |                         |    |    |    |
|                  |QoS enforcement |                         |    |    |    |
|                  |action that has |                         |    |    |    |
|                  |to be applied.  |                         |    |    |    |
|NOTE 1: The Network instance is needed e.g. in the following cases:         |
|- PGW/TDF-U supports multiple APN with overlapping IP addresses;            |
|- PGW-U is connected to SGWs in different IP domains;                       |
|- SGW-U is connected to PGWs in different IP domains;                       |
|- SGW-U is connected to eNodeBs in different IP domains.                    |



7.4  Usage Reporting Rule

The following table describes the Usage Reporting Rule (URR) that defines
how a packet shall be accounted as well as when and how to report the
measurements.

             Table 7.4-1: Attributes within Usage Reporting Rule

|Attribute |Description         |Comment                     |Applicability |
|          |                    |                            |SGW  |PDN|TDF |
|          |                    |                            |     |GW |    |
|Session ID|Identifies the      |                            |X    |X  |X   |
|          |session associated  |                            |     |   |    |
|          |to this URR         |                            |     |   |    |
|Rule ID   |Unique identifier to|                            |X    |X  |X   |
|          |identify this       |                            |     |   |    |
|          |information.        |                            |     |   |    |
|Reporting |One or multiple of  |Applicable events include:  |X    |X  |X   |
|triggers  |the events can be   |Start/stop of traffic       |     |   |    |
|          |activated for the   |detection with/without      |     |   |    |
|          |generation and      |application instance        |     |   |    |
|          |reporting of the    |identifier and deduced SDF  |     |   |    |
|          |usage report.       |filter reporting; Deletion  |     |   |    |
|          |                    |of last PDR for a URR;      |     |   |    |
|          |                    |Periodic measurement        |     |   |    |
|          |                    |threshold reached;          |     |   |    |
|          |                    |Volume/Time/Event           |     |   |    |
|          |                    |measurement threshold       |     |   |    |
|          |                    |reached; Immediate report   |     |   |    |
|          |                    |requested; Measurement of   |     |   |    |
|          |                    |incoming UL traffic;        |     |   |    |
|          |                    |Measurement of discarded DL |     |   |    |
|          |                    |traffic.                    |     |   |    |
|Periodic  |Defines the point in|This allows generation of   |X    |X  |X   |
|measuremen|time for sending a  |periodic usage report for   |     |   |    |
|t         |periodic report for |e.g. offline charging.      |     |   |    |
|threshold |this URR key (e.g.  |It can also be used for     |     |   |    |
|          |timeofday)          |realizing the Monitoring    |     |   |    |
|          |                    |time of the usage monitoring|     |   |    |
|          |                    |feature.                    |     |   |    |
|          |                    |It can also be used for     |     |   |    |
|          |                    |realizing the               |     |   |    |
|          |                    |Quota-Idle-Timeout, i.e. to |     |   |    |
|          |                    |enable the CP function to   |     |   |    |
|          |                    |check whether any traffic   |     |   |    |
|          |                    |has passed during this time.|     |   |    |
|Volume    |Value in terms of   |                            |X    |X  |X   |
|measuremen|uplink and/or       |                            |     |   |    |
|t         |downlink and/or     |                            |     |   |    |
|threshold |total byte-count    |                            |     |   |    |
|          |when the measurement|                            |     |   |    |
|          |report is to be     |                            |     |   |    |
|          |generated.          |                            |     |   |    |
|Time      |Value in terms of   |                            |X    |X  |X   |
|measuremen|the time duration   |                            |     |   |    |
|t         |(e.g. in seconds)   |                            |     |   |    |
|threshold |when the measurement|                            |     |   |    |
|          |report is to be     |                            |     |   |    |
|          |generated.          |                            |     |   |    |
|Event     |Number of events    |                            |     |X  |X   |
|measuremen|(identified         |                            |     |   |    |
|t         |according to a      |                            |     |   |    |
|threshold |locally configured  |                            |     |   |    |
|          |policy) after which |                            |     |   |    |
|          |the measurement     |                            |     |   |    |
|          |report is to be     |                            |     |   |    |
|          |generated.          |                            |     |   |    |
|Inactivity|Defines the period  |Timer corresponding to this |     |X  |X   |
|detection |of time after which |duration is restarted at the|     |   |    |
|time      |the time measurement|end of each transmitted     |     |   |    |
|          |shall stop, if no   |packet.                     |     |   |    |
|          |packets are         |                            |     |   |    |
|          |received.           |                            |     |   |    |
|Event     |Points to a locally |                            |     |X  |X   |
|based     |configured policy   |                            |     |   |    |
|reporting |which is identifies |                            |     |   |    |
|          |event(s) trigger for|                            |     |   |    |
|          |generating usage    |                            |     |   |    |
|          |report.             |                            |     |   |    |
|Linked URR|Points to one or    |This enables the generation |     |X  |X   |
|ID        |more other URR ID.  |of a combined Usage Report  |     |   |    |
|          |                    |for this and other URRs by  |     |   |    |
|          |                    |triggering their reporting. |     |   |    |
|          |                    |See clause 5.2.2.4,         |     |   |    |
|          |                    |TS 29.244 [12].             |     |   |    |
|Measuremen|Indicates the method|                            |X    |X  |X   |
|t method  |for measuring the   |                            |     |   |    |
|          |network resources   |                            |     |   |    |
|          |usage, i.e. the data|                            |     |   |    |
|          |volume, duration,   |                            |     |   |    |
|          |combined            |                            |     |   |    |
|          |volume/duration, or |                            |     |   |    |
|          |event.              |                            |     |   |    |
|Measuremen|Indicates specific  |It is used to request:      |X    |X  |X   |
|t         |conditions to be    |- measurement before QoS    |     |   |    |
|informatio|applied for         |enforcement, and/or         |     |   |    |
|n         |measurements.       |- to pause or set to active |     |   |    |
|          |                    |a measurement as for the    |     |   |    |
|          |                    |Pause of charging, and/or   |     |   |    |
|          |                    |- to request reduced        |     |   |    |
|          |                    |reporting for application   |     |   |    |
|          |                    |start/stop events.          |     |   |    |


7.5  Forwarding Action Rule

The following table describes the Forwarding Action Rule (FAR) that defines
how a packet shall be forwarded, including packet
encapsulation/decapsulation and forwarding destination.

            Table 7.5-1: Attributes within Forwarding Action Rule

|Attribute      |Description        |Comment          |Applicability  |
|               |                   |                 |SGW  |PDN |TDF |
|               |                   |                 |     |GW  |    |
|Session ID     |Identifies the     |                 |X    |X   |X   |
|               |session associated |                 |     |    |    |
|               |to this FAR        |                 |     |    |    |
|Rule ID        |Unique identifier  |                 |X    |X   |X   |
|               |to identify this   |                 |     |    |    |
|               |information.       |                 |     |    |    |
|Network        |Identifies the     |                 |X    |X   |X   |
|instance       |Network instance   |                 |     |    |    |
|               |associated with the|                 |     |    |    |
|               |outgoing packet.   |                 |     |    |    |
|               |(NOTE 1).          |                 |     |    |    |
|Destination    |Contains the values|Identifies the   |X    |X   |X   |
|interface      |"access side",     |interface for    |     |    |    |
|               |"core side", "CP   |outgoing packets |     |    |    |
|               |function", or      |towards the      |     |    |    |
|               |"SGi-LAN".         |access side (i.e.|     |    |    |
|               |                   |down-link), the  |     |    |    |
|               |                   |core side (i.e.  |     |    |    |
|               |                   |up-link), the CP |     |    |    |
|               |                   |function side    |     |    |    |
|               |                   |(i.e. towards CP |     |    |    |
|               |                   |function) or the |     |    |    |
|               |                   |SGi-LAN side     |     |    |    |
|               |                   |(i.e. towards    |     |    |    |
|               |                   |SGi-LAN).        |     |    |    |
|Outer header   |Instructs the UP   |Contains the     |X    |X   |    |
|creation       |function to add an |F-TEIDu of peer  |     |    |    |
|               |outer header       |entity (e.g. eNB,|     |    |    |
|               |(IP+UDP+GTP) to the|SGW, PGW, CP     |     |    |    |
|               |outgoing packet    |function).       |     |    |    |
|               |                   |Any extension    |     |    |    |
|               |                   |header stored for|     |    |    |
|               |                   |this packet shall|     |    |    |
|               |                   |be added.        |     |    |    |
|Send end marker|Instructs the UP   |This parameter   |X    |X   |    |
|packet(s)      |function to        |should be sent   |     |    |    |
|               |construct end      |together with the|     |    |    |
|               |marker packet(s)   |"out header      |     |    |    |
|               |and send them out  |creation"        |     |    |    |
|               |as described in    |parameter of the |     |    |    |
|               |clause 5.8.1.      |new F-TEID-u.    |     |    |    |
|Transport level|Transport level    |                 |X    |X   |    |
|marking        |packet marking in  |                 |     |    |    |
|               |the uplink and     |                 |     |    |    |
|               |downlink, e.g.     |                 |     |    |    |
|               |setting the        |                 |     |    |    |
|               |DiffServ Code      |                 |     |    |    |
|               |Point.             |                 |     |    |    |
|Forwarding     |Reference to a     |Contains TSP ID  |     |X   |X   |
|policy         |preconfigured      |or Redirect      |     |    |    |
|               |traffic forwarding |Destination and  |     |    |    |
|               |treatment for FMSS |values for the   |     |    |    |
|               |or http redirection|forwarding       |     |    |    |
|               |(NOTE 2)           |behaviour        |     |    |    |
|               |                   |(always, after   |     |    |    |
|               |                   |measurement      |     |    |    |
|               |                   |report (for      |     |    |    |
|               |                   |termination      |     |    |    |
|               |                   |action           |     |    |    |
|               |                   |"redirect"))     |     |    |    |
|Container for  |Contains           |Only relevant for|     |X   |X   |
|header         |information to be  |the uplink       |     |    |    |
|enrichment     |used by the UP     |direction        |     |    |    |
|               |function for header|                 |     |    |    |
|               |enrichment         |                 |     |    |    |
|Buffer Control |Instructs the UP   |See clause 5.2.4 |X    |    |    |
|Information    |function on how to |in               |     |    |    |
|               |perform buffering  |TS 29.244 [12].  |     |    |    |
|Delay Downlink |D parameter        |See clause 5.9.3 |X    |    |    |
|Packet         |                   |                 |     |    |    |
|Notification   |                   |                 |     |    |    |
|Information    |                   |                 |     |    |    |
|Extended       |DL Data Buffer     |See clause 5.9.3 |X    |    |    |
|buffering      |Expiration Time    |                 |     |    |    |
|Information    |                   |                 |     |    |    |
|               |DL Suggested Packet|See clause 5.9.3 |     |    |    |
|               |Count              |                 |     |    |    |
|NOTE 1: Needed e.g. in case:                                         |
|- PGW/TDF-U supports multiple APN with overlapping IP addresses;     |
|- PGW-U is connected to SGWs in different IP domains;                |
|- SGW-U is connected to PGWs in different IP domains;                |
|- SGW UP-U is connected to eNodeBs in different IP domains.          |
|NOTE 2: The TSP ID action is enforced before the Outer header        |
|creation actions.                                                    |


7.6  QoS Enforcement Rule

The following table describes the QoS Enforcement Rule (QER) that defines
how a packet shall be treated in terms of bit rate limitation and packet
marking for QoS purposes. All Packet Detection Rules that refer to the same
QER share the same QoS resources, e.g. MBR.

             Table 7.6-1: Attributes within QoS Enforcement Rule

|Attribute |Description   |Comment                    |Applicability |
|          |              |                           |SGW  |PDN |TDF |
|          |              |                           |     |GW  |    |
|Session ID|Identifies the|                           |X    |X   |X   |
|          |session       |                           |     |    |    |
|          |associated to |                           |     |    |    |
|          |this QER      |                           |     |    |    |
|Rule ID   |Unique        |                           |X    |X   |X   |
|          |identifier to |                           |     |    |    |
|          |identify this |                           |     |    |    |
|          |information.  |                           |     |    |    |
|QoS       |An identity   |Is used to correlate QoS   |     |X   |    |
|Enforcemen|allowing the  |Enforcement Rules for      |     |    |    |
|t Rule    |UP function to|APN-AMBR enforcement       |     |    |    |
|correlatio|correlate     |                           |     |    |    |
|n ID      |multiple      |                           |     |    |    |
|          |Sessions for  |                           |     |    |    |
|          |the same UE   |                           |     |    |    |
|          |and APN.      |                           |     |    |    |
|Gate      |Instructs the |Values are: open, close,   |     |X   |X   |
|status    |UP function to|close after measurement    |     |    |    |
|UL/DL     |let the flow  |report (for termination    |     |    |    |
|          |pass or to    |action "discard")          |     |    |    |
|          |block the flow|                           |     |    |    |
|Maximum   |The           |This field may e.g. contain|     |X   |X   |
|bitrate   |uplink/downlin|any one of:                |     |    |    |
|          |k maximum     |- APN-AMBR (for a QER that |     |    |    |
|          |bitrate to be |is referenced by all       |     |    |    |
|          |enforced for  |relevant Packet Detection  |     |    |    |
|          |the packets.  |Rules of all PDN           |     |    |    |
|          |              |Connections to an APN)     |     |    |    |
|          |              |- TDF session MBR (for a   |     |    |    |
|          |              |QER that is referenced by  |     |    |    |
|          |              |all Packet Detection Rules |     |    |    |
|          |              |of a TDF Session)          |     |    |    |
|          |              |- bearer MBR (for a QER    |     |    |    |
|          |              |that is referenced by all  |     |    |    |
|          |              |Packet Detection Rules of a|     |    |    |
|          |              |bearer)                    |     |    |    |
|          |              |- SDF MBR (for a QER that  |     |    |    |
|          |              |is referenced by the       |     |    |    |
|          |              |uplink/downlink Packet     |     |    |    |
|          |              |Detection Rule of a SDF)   |     |    |    |
|Guaranteed|The           |This field contains:       |X    |X   |    |
|bitrate   |uplink/downlin|- bearer GBR (for a QER    |     |    |    |
|          |k guaranteed  |that is referenced by all  |     |    |    |
|          |bitrate       |Packet Detection Rules of a|     |    |    |
|          |authorized for|bearer)                    |     |    |    |
|          |the packets.  |                           |     |    |    |
|Down-link |Flow level    |For PGW, this is for       |     |X   |X   |
|flow level|packet marking|controlling the SCI marking|     |    |    |
|marking   |in the        |in the GTP extension header|     |    |    |
|          |downlink.     |(for service indication    |     |    |    |
|          |              |towards GERAN as described |     |    |    |
|          |              |in TS 23.060 [5]).         |     |    |    |
|          |              |For TDF, this is for       |     |    |    |
|          |              |controlling the DSCP       |     |    |    |
|          |              |marking for application    |     |    |    |
|          |              |indication.                |     |    |    |
|Packet    |Number of     |This field contains any one|     |X   |    |
|rate      |packets per   |of:                        |     |    |    |
|          |time interval |- downlink packet rate for |     |    |    |
|          |to be         |Serving PLMN Rate Control  |     |    |    |
|          |enforced.     |(the QER is referenced by  |     |    |    |
|          |              |all PDRs of the UE         |     |    |    |
|          |              |belonging to PDN           |     |    |    |
|          |              |connections using CIoT EPS |     |    |    |
|          |              |Optimizations as described |     |    |    |
|          |              |in TS 23.401 [2])          |     |    |    |
|          |              |- uplink/downlink packet   |     |    |    |
|          |              |rate for APN Rate Control  |     |    |    |
|          |              |(the QER is referenced by  |     |    |    |
|          |              |all PDRs of the UE         |     |    |    |
|          |              |belonging to PDN           |     |    |    |
|          |              |connections to the same APN|     |    |    |
|          |              |using CIoT EPS             |     |    |    |
|          |              |Optimizations as described |     |    |    |
|          |              |in TS 23.401 [2]).         |     |    |    |


7.7  Usage Report generated by UP function

The UP function sends the usage report to inform the CP function about the
measurement of an active URR or about the detection of application traffic
of an active Packet Detection Rule. For each URR, the usage report may be
generated repeatedly, i.e. as long as any one of the valid event triggers
applies. A final usage report is sent for a URR when it is no longer
active, i.e. either the URR is removed or all the references to this URR in
any of the Packet Detection Rules belonging to the Sx session.

Following attributes can be included in the usage report:

                 Table 7.7-1: Attributes within Usage Report

|Attribut|Description     |Comment                     |Applicability |
|e       |                |                            |              |
|        |                |                            |SGW  |PDN |TDF |
|        |                |                            |     |GW  |    |
|Session |Uniquely        |This corresponds to a PDN   |X    |X   |X   |
|ID      |identifies a    |connection for SGW and PGW  |     |    |    |
|        |session.        |or a TDF session for TDF    |     |    |    |
|Rule ID |Uniquely        |Packet Detection Rule is    |X    |X   |X   |
|        |identifies the  |only indicated when         |     |    |    |
|        |Packet Detection|Reporting trigger is        |     |    |    |
|        |Rule or Usage   |Detection of 1st DL packet  |     |    |    |
|        |Reporting Rule  |on bearer (SGW) or          |     |    |    |
|        |within a session|Start/stop of traffic       |     |    |    |
|        |which triggered |detection (PGW/TDF).        |     |    |    |
|        |the report      |Usage Reporting Rule is     |     |    |    |
|        |                |indicated for all other     |     |    |    |
|        |                |Reporting triggers.         |     |    |    |
|Reportin|Identifies the  |Applicable values are:      |X    |X   |X   |
|g       |trigger for the |Detection of 1st DL packet  |     |    |    |
|trigger |usage report.   |on bearer (only for SGW);   |     |    |    |
|        |                |Start/stop of traffic       |     |    |    |
|        |                |detection with/without      |     |    |    |
|        |                |application instance        |     |    |    |
|        |                |identifier and deduced SDF  |     |    |    |
|        |                |filter reporting (only for  |     |    |    |
|        |                |PGW and TDF); Deletion of   |     |    |    |
|        |                |last PDR for a URR; Periodic|     |    |    |
|        |                |measurement threshold       |     |    |    |
|        |                |reached; Volume/Time/Event  |     |    |    |
|        |                |measurement threshold       |     |    |    |
|        |                |reached; Immediate report   |     |    |    |
|        |                |requested; Measurement of   |     |    |    |
|        |                |incoming UL traffic (only   |     |    |    |
|        |                |for PGW); Measurement of    |     |    |    |
|        |                |discarded DL traffic (only  |     |    |    |
|        |                |for SGW).                   |     |    |    |
|Start   |Provides the    |Not sent when Reporting     |X    |X   |X   |
|time    |timestamp, in   |trigger is Start/stop of    |     |    |    |
|        |terms of        |traffic detection           |     |    |    |
|        |absolute time,  |                            |     |    |    |
|        |when the        |                            |     |    |    |
|        |collection of   |                            |     |    |    |
|        |the information |                            |     |    |    |
|        |provided within |                            |     |    |    |
|        |Usage-Informatio|                            |     |    |    |
|        |n is started.   |                            |     |    |    |
|End time|Provides the    |Not sent when Reporting     |X    |X   |X   |
|        |timestamp, in   |trigger is Start/stop of    |     |    |    |
|        |terms of        |traffic detection           |     |    |    |
|        |absolute time,  |                            |     |    |    |
|        |when the        |                            |     |    |    |
|        |information     |                            |     |    |    |
|        |provided within |                            |     |    |    |
|        |Usage-Informatio|                            |     |    |    |
|        |n is generated. |                            |     |    |    |
|Measurem|Defines the     |Contains DSCP of received   |X    |X   |X   |
|ent     |measured        |packet when Reporting       |     |    |    |
|informat|volume/time/even|trigger is Detection of 1st |     |    |    |
|ion     |ts for this URR.|DL packet on bearer (as     |     |    |    |
|        |                |described in TS 23.401 [2]) |     |    |    |
|        |                |Contains application        |     |    |    |
|        |                |instance identifier and     |     |    |    |
|        |                |deduced SDF filter when     |     |    |    |
|        |                |Reporting trigger is        |     |    |    |
|        |                |Start/stop of traffic       |     |    |    |
|        |                |detection with application  |     |    |    |
|        |                |instance identifier and     |     |    |    |
|        |                |deduced SDF filter reporting|     |    |    |
|        |                |(including deduced UE IP    |     |    |    |
|        |                |address for TDF in          |     |    |    |
|        |                |unsolicited mode)           |     |    |    |
|        |                |Not sent when Reporting     |     |    |    |
|        |                |trigger is Start/stop of    |     |    |    |
|        |                |traffic detection without   |     |    |    |
|        |                |application instance        |     |    |    |
|        |                |identifier and deduced SDF  |     |    |    |
|        |                |filter reporting            |     |    |    |


7.8  Functional description


7.8.1  General

This clause describes how the CP function provides information over Sx to
realize forwarding, reporting etc on different aggregation levels.


7.8.2  PDN connection and TDF session level context

The PDN connection or TDF session level context is realized over Sx by
generating a Usage Reporting Rule and a QoS Enforcement Rule.

To apply PDN Connection or TDF session level reporting and MBR enforcement,
the CP function provides over Sx:

  -  A URR that describes the reporting requirement for the PDN Connection
    or TDF session.

  -  A QER that describes the QoS enforcement actions that apply, i.e. a
    QER with APN-AMBR value (in case of PGW) or a QER with TDF session MBR
    (in case of TDF).

For session level reporting, the CP function includes references to the URR
(i.e. URR Rule ID) in each Packet Detection Rule activated for the PDN
Connection or TDF session. In case of PDN Connection or TDF session level
usage monitoring where some SDF(s) are excluded, the CP function only
includes a reference to the URR in those Packet Detection Rules that shall
be included in the report.

For APN-AMBR policing, the CP function includes references (Rule ID) to the
QER containing the APN-AMBR value in each Packet Detection Rule for non GBR
traffic activated for the PDN Connection. The CP function shall apply the
same QER for all Packet Detection Rules for non GBR traffic associated with
any of the active PDN Connections of the same APN.

For TDF session MBR policing, the CP function includes references (Rule ID)
to the QER containing the TDF session MBR value in each Packet Detection
Rule activated for the TDF session.


7.8.3  Bearer related context

The bearer context is realized over Sx by generating one or two Forwarding
Action Rules, a Usage Reporting Rule and a QoS Enforcement Rule that
correspond to the bearer. In particular, the CP function may provide to the
UP function for each active bearer:

  -  A Usage Reporting Rule that describes the reporting requirement for
    the bearer, including reporting events, measurement type etc for the
    bearer reports

  -  A QoS Enforcement Rule that describe the QoS enforcement actions that
    apply to the bearer, including the bearer MBR.

  -  Forwarding Action Rules describe the forwarding behaviour for the
    bearer. One Forwarding Action Rule is required for the downlink
    direction (in case of PGW or SGW) and one for the uplink direction (in
    case of SGW).

  NOTE:  The CP function maintains the association between the EPS Bearer
         ID and the rules on Sx corresponding to bearer level enforcement
         and reports. There is no need to provide a Bearer ID to the UP
         function.

The CP function associates, based on the bearer binding decisions, every
Packet Detection Rule that is activated for a bearer with the URR, QER and
FARs applicable for the this bearer by including references (Rule IDs) in
the PDR:

  -  For bearer level reporting, the CP function includes a reference (Rule
    ID) to the URR for the bearer.

  -  For bearer level policing, the CP function includes a reference (Rule
    ID) to the QER for the bearer.

  -  For forwarding of packets over a bearer (GTP-U encapsulation), the CP
    function includes a reference (Rule ID) to the FAR the bearer. This is
    done per direction (UL and DL).


7.8.4  Measurement key related context

The CP function provides a Usage Reporting Rule for each usage report that
needs to be provided by the UP function. The CP function maintains a
mapping between the Charging Key and/or Monitoring Key applicable for a SDF
and the Measurement Key of the URR provided over Sx. For example, the CP
function may provide one URR for each Charging Key and one URR for each
Monitoring Key or may decide to provide a single URR for a Charging Key and
a Monitoring Key in case there is complete overlap in the measurement
requirements. Other mappings are also possible as determined by the CP
function and is not limited by the standard as long as the reporting
requirements from the CP function towards the OFCS/OCS and PCRF are
fulfilled.

To associate traffic covered by a Packet Detection Rule with one or more
measurement keys on Sx, the CP function includes in the Packet Detection
Rule a reference to each URR (Rule ID) that is applicable for the traffic
covered by the PDR.


7.9  Parameters for Sx management


7.9.1  Parameters for PFD management

The PGW-C/TDF-C can manage PFD sets in the applicable PGW-U/TDF-U
independent of the Sx session. The management (provision or remove) of
multiple PFD sets belonging to different Application IDs can be done with
the same PFD management request message.

        Table 7.9-1: Attributes within PFD management request message

|Attribute         |Description     |Comment                  |Applicability |
|                  |                |                         |SGW |PDN |TDF |
|                  |                |                         |    |GW  |    |
|PFD(s)            |Extension to the|The provisioning of      |    |X   |X   |
|                  |application     |PFD(s) for an Application|    |    |    |
|                  |detection filter|ID results in the removal|    |    |    |
|                  |                |of all PFD(s) stored in  |    |    |    |
|                  |                |the PGW-U/TDF-U for this |    |    |    |
|                  |                |Application ID and the   |    |    |    |
|                  |                |usage of all newly       |    |    |    |
|                  |                |provided PFD(s) for this |    |    |    |
|                  |                |Application ID           |    |    |    |
|Application ID    |Application     |The provisioning of an   |    |X   |X   |
|                  |identifier which|Application ID without   |    |    |    |
|                  |the PFD(s) is   |PFD(s) results in the    |    |    |    |
|                  |associated with |removal of all stored    |    |    |    |
|                  |                |PFD(s) corresponding to  |    |    |    |
|                  |                |this Application ID      |    |    |    |




Annex A (informative):
Change history

|Change history                                                            |


Date |Meeting |TDoc |CR |Rev |Cat |Subject/Comment |New version | |2016-09
|SP-73 |SP-160665 |- |- |- |MCC Editorial update for presentation to TSG
SA#73 for information and approval |1.0.0 | |2016-09 |SP-73 |- |- |- |-
|MCC Editorial update for publication after TSG SA#73 approval |14.0.0 |
|2016-12 |SP-74 |SP-160815 |0002 |2 |F |Corrections to User Plane selection
function |14.1.0 | |2016-12 |SP-74 |SP-160815 |0003 |5 |F |Corrections to
buffering in the user plane |14.1.0 | |2016-12 |SP-74 |SP-160815 |0004 |8
|F |Sx parameter corrections |14.1.0 | |2016-12 |SP-74 |SP-160815 |0005 |4
|B |SDCI support |14.1.0 | |2016-12 |SP-74 |SP-160815 |0006 |3 |F |Update
to PCC/ADC related functions |14.1.0 | |2016-12 |SP-74 |SP-160815 |0007 |2
|F |Update to UP Selection Section |14.1.0 | |2016-12 |SP-74 |SP-160815
|0008 |2 |F |Text updates for 3GPP TS 23.401 call flows |14.1.0 | |2016-12
|SP-74 |SP-160815 |0009 |2 |F |Text updates for 3GPP TS 23.402 call flows
|14.1.0 | |2016-12 |SP-74 |SP-160815 |0010 |2 |B |Buffering and F-TEIDu
Allocation |14.1.0 | |2016-12 |SP-74 |SP-160815 |0012 |3 |F |Support of PGW
Pause of Charging |14.1.0 | |2016-12 |SP-74 |SP-160815 |0013 |3 |F |Sx
Session Level Reporting Procedure update |14.1.0 | |2016-12 |SP-74 |SP-
160815 |0014 |3 |F |TDF-U selection in case of unsolicited reporting
|14.1.0 | |2016-12 |SP-74 |SP-160815 |0017 |4 |F |Corrections of Sx
parameters |14.1.0 | |2016-12 |SP-74 |SP-160815 |0019 |- |F |Parameter
alignment and corrections for traffic detection clause  |14.1.0 | |2016-12
|SP-74 |SP-160815 |0020 |2 |F |Parameter alignment and corrections for
forwarding section |14.1.0 | |2016-12 |SP-74 |SP-160815 |0021 |2 |F
|Alignment of function split clause  |14.1.0 | |2016-12 |SP-74 |SP-160815
|0022 |3 |F |Clarification on the SGW-C partitions for a given UE |14.1.0 |
|2017-03 |SP-75 |SP-170046 |0026 |2 |F |Correction to enforcement of
dynamic PCC/ADC rule |14.2.0 | |2017-03 |SP-75 |SP-170046 |0027 |2 |F
|Corrections to Sx parameters |14.2.0 | |2017-03 |SP-75 |SP-170046 |0028 |4
|F |Session management procedure for TDF in unsolicited mode |14.2.0 |
|2017-03 |SP-75 |SP-170052 |0029 |1 |C |TS 23.214 support for transport
level packet marking |14.2.0 | |2017-03 |SP-75 |SP-170046 |0032 |1 |F
|Updates Procedures in TS 23.060. |14.2.0 | |2017-06 |SP-76 |SP-170366
|0033 |1 |F |Clean up and stage 3 alignment |14.3.0 | |2017-06 |SP-76 |SP-
170366 |0034 |2 |F |Corrections and clean up for 23.401 related message
flows |14.3.0 | |2017-06 |SP-76 |SP-170366 |0035 |1 |F |Addition of Sx node
level procedures |14.3.0 | |2017-06 |SP-76 |SP-170366 |0036 |- |F
|Clarification on pre-defined PCC rules |14.3.0 | |2017-06 |SP-76 |SP-
170366 |0038 |- |F |Corrections and clean up for 23.203 related message
flows |14.3.0 | |2017-06 |SP-76 |SP-170366 |0039 |1 |F |Corrections and
clean up for 23.060 related message flows |14.3.0 | |2017-06 |SP-76 |SP-
170366 |0040 |- |F |Corrections and clean up for 23.402 related message
flows |14.3.0 | |2017-09 |SP-77 |SP-170717 |0041 |2 |F |Sx PDN Instance
|14.4.0 | |2017-09 |SP-77 |SP-170717 |0042 |2 |F |Update on activation of
predefined PCC/ADC rules  |14.4.0 | |2017-09 |SP-77 |SP-170717 |0043 |- |F
|Description on Sx-u tunnel |14.4.0 | |2017-09 |SP-77 |SP-170717 |0044 |1
|F |Corrections on PFD management |14.4.0 | |2017-09 |SP-77 |SP-170717
|0045 |- |F |Correlation of Sx Session and UE Context |14.4.0 | |2017-09
|SP-77 |SP-170717 |0046 |2 |F |Update of the Procedures Specified in
TS 23.401. |14.4.0 | |2017-09 |SP-77 |SP-170717 |0048 |3 |F |Clarification
of Procedures Specified in TS 23.060. |14.4.0 | |2017-09 |SP-77 |SP-170728
|0047 |2 |B |Enable SGW-C & PGW-C selection of UPF to take UE's NR
capabilities into account |15.0.0 | |2017-12 |SP-78 |SP-170913 |0050 |1 |A
|Interface between MME and SGW-U for IoT data transmission |15.1.0 | |2017-
12 |SP-78 |SP-170913 |0052 |2 |A |Removal of PMIP-based procedures
specified |15.1.0 | |2017-12 |SP-78 |SP-170920 |0055 |1 |F |Correcting the
condition for selection of SGW-U for NR as secondary RAT |15.1.0 | |2017-12
|SP-78 |SP-170940 |0057 |2 |A |Update of the Procedures Specified in
TS 23.060. |15.1.0 | |2018-03 |SP-79 |SP-180086 |0060 |1 |A |Update of the
Procedures Specified in TS 23.060. |15.2.0 | |2018-03 |SP-79 |SP-180086
|0062 |- |A |Update to Procedures Specified in TS 23.401 |15.2.0 | |2018-03
|SP-79 |SP-180086 |0064 |1 |A |Correction of SDF Filter Description in PDR
Table |15.2.0 | |2018-06 |SP-80 |SP-180472 |0066 |1 |A |Update of Sx
parameter tables |15.3.0 | |

